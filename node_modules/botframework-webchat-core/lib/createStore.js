"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = createStore;
exports.withDevTools = withDevTools;
exports.withOptions = withOptions;

var _redux = require("redux");

var _reduxDevtoolsExtension = require("redux-devtools-extension");

var _reduxSaga = _interopRequireDefault(require("redux-saga"));

var _createReducer = _interopRequireDefault(require("./createReducer"));

var _createSagas = _interopRequireDefault(require("./createSagas"));

var _sagaError = _interopRequireDefault(require("./actions/sagaError"));

function createEnhancerAndSagaMiddleware(getStore) {
  var sagaMiddleware = (0, _reduxSaga["default"])({
    onError: function onError() {
      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        args[_key2] = arguments[_key2];
      }

      var err = args[0];
      console.error(err);
      var store = getStore();
      store && store.dispatch((0, _sagaError["default"])());
    }
  });

  for (var _len = arguments.length, middlewares = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    middlewares[_key - 1] = arguments[_key];
  }

  return {
    enhancer: _redux.applyMiddleware.apply(void 0, middlewares.concat([sagaMiddleware])),
    sagaMiddleware: sagaMiddleware
  };
}
/**
 * Creates a Redux store internally used by Web Chat.
 *
 * This store is critical for Web Chat business logics to operate, please use with cautions.
 */
// The complexity is introduced by the check of ponyfill.
// eslint-disable-next-line complexity


function withOptions(options, initialState) {
  // IE Mode does not have `globalThis`.
  var globalThisOrWindow = typeof globalThis === 'undefined' ? window : globalThis;
  var ponyfillFromOptions = options.ponyfill || {}; // TODO: [P2] Dedupe: when we have an utility package, move this code there and mark it as internal use.

  var ponyfill = {
    cancelAnimationFrame: ponyfillFromOptions.cancelAnimationFrame || ( // Using clock functions from global if not provided.
    // eslint-disable-next-line no-restricted-globals
    typeof cancelAnimationFrame === 'function' ? cancelAnimationFrame.bind(globalThisOrWindow) : undefined),
    cancelIdleCallback: ponyfillFromOptions.cancelIdleCallback || ( // eslint-disable-next-line no-restricted-globals
    typeof cancelIdleCallback === 'function' ? cancelIdleCallback.bind(globalThisOrWindow) : undefined),
    clearImmediate: ponyfillFromOptions.clearImmediate || ( // eslint-disable-next-line no-restricted-globals
    typeof clearImmediate === 'function' ? clearImmediate.bind(globalThisOrWindow) : undefined),
    clearInterval: ponyfillFromOptions.clearInterval || ( // eslint-disable-next-line no-restricted-globals
    typeof clearInterval === 'function' ? clearInterval.bind(globalThisOrWindow) : undefined),
    clearTimeout: ponyfillFromOptions.clearTimeout || ( // eslint-disable-next-line no-restricted-globals
    typeof clearTimeout === 'function' ? clearTimeout.bind(globalThisOrWindow) : undefined),
    // eslint-disable-next-line no-restricted-globals
    Date: ponyfillFromOptions.Date || Date,
    requestAnimationFrame: ponyfillFromOptions.requestAnimationFrame || ( // eslint-disable-next-line no-restricted-globals
    typeof requestAnimationFrame === 'function' ? requestAnimationFrame.bind(globalThisOrWindow) : undefined),
    requestIdleCallback: ponyfillFromOptions.requestIdleCallback || ( // eslint-disable-next-line no-restricted-globals
    typeof requestIdleCallback === 'function' ? requestIdleCallback.bind(globalThisOrWindow) : undefined),
    setImmediate: ponyfillFromOptions.setImmediate || ( // eslint-disable-next-line no-restricted-globals
    typeof setImmediate === 'function' ? setImmediate.bind(globalThisOrWindow) : undefined),
    setInterval: ponyfillFromOptions.setInterval || ( // eslint-disable-next-line no-restricted-globals
    typeof setInterval === 'function' ? setInterval.bind(globalThisOrWindow) : undefined),
    setTimeout: ponyfillFromOptions.setTimeout || ( // eslint-disable-next-line no-restricted-globals
    typeof setTimeout === 'function' ? setTimeout.bind(globalThisOrWindow) : undefined)
  }; // We are sure the "getStore" (first argument) is not called on "createEnhancerAndSagaMiddleware()".
  // eslint-disable-next-line @typescript-eslint/no-use-before-define

  for (var _len3 = arguments.length, middlewares = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {
    middlewares[_key3 - 2] = arguments[_key3];
  }

  var _createEnhancerAndSag = createEnhancerAndSagaMiddleware.apply(void 0, [function () {
    return store;
  }].concat(middlewares)),
      enhancer = _createEnhancerAndSag.enhancer,
      sagaMiddleware = _createEnhancerAndSag.sagaMiddleware;

  var store = (0, _redux.createStore)((0, _createReducer["default"])(ponyfill), initialState || {}, options.devTools ? (0, _reduxDevtoolsExtension.composeWithDevTools)(enhancer) : enhancer);
  sagaMiddleware.run((0, _createSagas["default"])({
    ponyfill: ponyfill
  }));
  return store;
}
/**
 * Creates a Redux store internally used by Web Chat.
 *
 * This store is critical for Web Chat business logics to operate, please use with cautions.
 */


function createStore(initialState) {
  for (var _len4 = arguments.length, middlewares = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {
    middlewares[_key4 - 1] = arguments[_key4];
  }

  return withOptions.apply(void 0, [{}, initialState].concat(middlewares));
}
/**
 * Creates a Redux store internally used by Web Chat, with Redux development tools.
 *
 * This store is critical for Web Chat business logics to operate, please use with cautions.
 *
 * @deprecated Use `withOptions` instead and pass `{ devTools: true }`
 */


function withDevTools(initialState) {
  for (var _len5 = arguments.length, middlewares = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {
    middlewares[_key5 - 1] = arguments[_key5];
  }

  return withOptions.apply(void 0, [{
    devTools: true
  }, initialState].concat(middlewares));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVFbmhhbmNlckFuZFNhZ2FNaWRkbGV3YXJlIiwiZ2V0U3RvcmUiLCJzYWdhTWlkZGxld2FyZSIsImNyZWF0ZVNhZ2FNaWRkbGV3YXJlIiwib25FcnJvciIsImFyZ3MiLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJzdG9yZSIsImRpc3BhdGNoIiwic2FnYUVycm9yIiwibWlkZGxld2FyZXMiLCJlbmhhbmNlciIsImFwcGx5TWlkZGxld2FyZSIsIndpdGhPcHRpb25zIiwib3B0aW9ucyIsImluaXRpYWxTdGF0ZSIsImdsb2JhbFRoaXNPcldpbmRvdyIsImdsb2JhbFRoaXMiLCJ3aW5kb3ciLCJwb255ZmlsbEZyb21PcHRpb25zIiwicG9ueWZpbGwiLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsImJpbmQiLCJ1bmRlZmluZWQiLCJjYW5jZWxJZGxlQ2FsbGJhY2siLCJjbGVhckltbWVkaWF0ZSIsImNsZWFySW50ZXJ2YWwiLCJjbGVhclRpbWVvdXQiLCJEYXRlIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicmVxdWVzdElkbGVDYWxsYmFjayIsInNldEltbWVkaWF0ZSIsInNldEludGVydmFsIiwic2V0VGltZW91dCIsImNyZWF0ZVJlZHV4U3RvcmUiLCJjcmVhdGVSZWR1Y2VyIiwiZGV2VG9vbHMiLCJjb21wb3NlV2l0aERldlRvb2xzIiwicnVuIiwiY3JlYXRlU2FnYXMiLCJjcmVhdGVTdG9yZSIsIndpdGhEZXZUb29scyJdLCJzb3VyY2VSb290IjoiY29yZTovLy8iLCJzb3VyY2VzIjpbIi4uL3NyYy9jcmVhdGVTdG9yZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhcHBseU1pZGRsZXdhcmUsIGNyZWF0ZVN0b3JlIGFzIGNyZWF0ZVJlZHV4U3RvcmUsIFN0b3JlIH0gZnJvbSAncmVkdXgnO1xuaW1wb3J0IHsgY29tcG9zZVdpdGhEZXZUb29scyB9IGZyb20gJ3JlZHV4LWRldnRvb2xzLWV4dGVuc2lvbic7XG5pbXBvcnQgY3JlYXRlU2FnYU1pZGRsZXdhcmUgZnJvbSAncmVkdXgtc2FnYSc7XG5cbmltcG9ydCBjcmVhdGVSZWR1Y2VyIGZyb20gJy4vY3JlYXRlUmVkdWNlcic7XG5pbXBvcnQgY3JlYXRlU2FnYXMgZnJvbSAnLi9jcmVhdGVTYWdhcyc7XG5pbXBvcnQgc2FnYUVycm9yIGZyb20gJy4vYWN0aW9ucy9zYWdhRXJyb3InO1xuXG5pbXBvcnQgdHlwZSB7IEdsb2JhbFNjb3BlUG9ueWZpbGwgfSBmcm9tICcuL3R5cGVzL0dsb2JhbFNjb3BlUG9ueWZpbGwnO1xuXG50eXBlIENyZWF0ZVN0b3JlT3B0aW9ucyA9IHtcbiAgLyoqXG4gICAqIFRydWUsIHRvIGVuYWJsZSBSZWR1eCBkZXZlbG9wbWVudCB0b29scywgb3RoZXJ3aXNlLCBmYWxzZS5cbiAgICpcbiAgICogQmVjYXVzZSBXZWIgQ2hhdCB1c2Ugc2FnYXMgZm9yIGJ1c2luZXNzIGxvZ2ljcywgc29tZSBzdG9yZSBzdGF0ZSBhcmUga2VlcCBhdCBKYXZhU2NyaXB0IGhlYXBzLlxuICAgKiBUaW1lLXRyYXZlbGxpbmcgYW5kIHNhdmluZy9yZXN0b3Jpbmcgc3RvcmUgc3RhdGUgYXJlIG5vdCBzdXBwb3J0ZWQuXG4gICAqL1xuICBkZXZUb29scz86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFBvbnlmaWxsIHRvIG92ZXJyaWRlcyBzcGVjaWZpYyBnbG9iYWwgc2NvcGUgbWVtYmVycy5cbiAgICpcbiAgICogVGhpcyBvcHRpb24gaXMgZm9yIGRldmVsb3BtZW50IHVzZSBvbmx5LiBOb3QgYWxsIGZlYXR1cmVzIGluIFdlYiBDaGF0IGFyZSBwb255ZmlsbGVkLlxuICAgKlxuICAgKiBUbyBmYWtlIHRpbWVycywgYHNldFRpbWVvdXRgIGFuZCByZWxhdGVkIGZ1bmN0aW9ucyBjYW4gYmUgcGFzc2VkIHRvIG92ZXJyaWRlcyB0aGUgb3JpZ2luYWwgZ2xvYmFsIHNjb3BlIG1lbWJlcnMuXG4gICAqXG4gICAqIFBsZWFzZSBzZWUgWyM0NjYyXShodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L0JvdEZyYW1ld29yay1XZWJDaGF0L3B1bGwvNDY2MikgZm9yIGRldGFpbHMuXG4gICAqL1xuICBwb255ZmlsbD86IFBhcnRpYWw8R2xvYmFsU2NvcGVQb255ZmlsbD47XG59O1xuXG5mdW5jdGlvbiBjcmVhdGVFbmhhbmNlckFuZFNhZ2FNaWRkbGV3YXJlKGdldFN0b3JlLCAuLi5taWRkbGV3YXJlcykge1xuICBjb25zdCBzYWdhTWlkZGxld2FyZSA9IGNyZWF0ZVNhZ2FNaWRkbGV3YXJlKHtcbiAgICBvbkVycm9yOiAoLi4uYXJncykgPT4ge1xuICAgICAgY29uc3QgW2Vycl0gPSBhcmdzO1xuXG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG5cbiAgICAgIGNvbnN0IHN0b3JlID0gZ2V0U3RvcmUoKTtcblxuICAgICAgc3RvcmUgJiYgc3RvcmUuZGlzcGF0Y2goc2FnYUVycm9yKCkpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBlbmhhbmNlcjogYXBwbHlNaWRkbGV3YXJlKC4uLm1pZGRsZXdhcmVzLCBzYWdhTWlkZGxld2FyZSksXG4gICAgc2FnYU1pZGRsZXdhcmVcbiAgfTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgUmVkdXggc3RvcmUgaW50ZXJuYWxseSB1c2VkIGJ5IFdlYiBDaGF0LlxuICpcbiAqIFRoaXMgc3RvcmUgaXMgY3JpdGljYWwgZm9yIFdlYiBDaGF0IGJ1c2luZXNzIGxvZ2ljcyB0byBvcGVyYXRlLCBwbGVhc2UgdXNlIHdpdGggY2F1dGlvbnMuXG4gKi9cblxuLy8gVGhlIGNvbXBsZXhpdHkgaXMgaW50cm9kdWNlZCBieSB0aGUgY2hlY2sgb2YgcG9ueWZpbGwuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGxleGl0eVxuZXhwb3J0IGZ1bmN0aW9uIHdpdGhPcHRpb25zKG9wdGlvbnM6IENyZWF0ZVN0b3JlT3B0aW9ucywgaW5pdGlhbFN0YXRlPywgLi4ubWlkZGxld2FyZXMpOiBTdG9yZSB7XG4gIC8vIElFIE1vZGUgZG9lcyBub3QgaGF2ZSBgZ2xvYmFsVGhpc2AuXG4gIGNvbnN0IGdsb2JhbFRoaXNPcldpbmRvdyA9IHR5cGVvZiBnbG9iYWxUaGlzID09PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IGdsb2JhbFRoaXM7XG4gIGNvbnN0IHBvbnlmaWxsRnJvbU9wdGlvbnM6IFBhcnRpYWw8R2xvYmFsU2NvcGVQb255ZmlsbD4gPSBvcHRpb25zLnBvbnlmaWxsIHx8IHt9O1xuXG4gIC8vIFRPRE86IFtQMl0gRGVkdXBlOiB3aGVuIHdlIGhhdmUgYW4gdXRpbGl0eSBwYWNrYWdlLCBtb3ZlIHRoaXMgY29kZSB0aGVyZSBhbmQgbWFyayBpdCBhcyBpbnRlcm5hbCB1c2UuXG4gIGNvbnN0IHBvbnlmaWxsOiBHbG9iYWxTY29wZVBvbnlmaWxsID0ge1xuICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lOlxuICAgICAgcG9ueWZpbGxGcm9tT3B0aW9ucy5jYW5jZWxBbmltYXRpb25GcmFtZSB8fFxuICAgICAgLy8gVXNpbmcgY2xvY2sgZnVuY3Rpb25zIGZyb20gZ2xvYmFsIGlmIG5vdCBwcm92aWRlZC5cbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHNcbiAgICAgICh0eXBlb2YgY2FuY2VsQW5pbWF0aW9uRnJhbWUgPT09ICdmdW5jdGlvbicgPyBjYW5jZWxBbmltYXRpb25GcmFtZS5iaW5kKGdsb2JhbFRoaXNPcldpbmRvdykgOiB1bmRlZmluZWQpLFxuICAgIGNhbmNlbElkbGVDYWxsYmFjazpcbiAgICAgIHBvbnlmaWxsRnJvbU9wdGlvbnMuY2FuY2VsSWRsZUNhbGxiYWNrIHx8XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXG4gICAgICAodHlwZW9mIGNhbmNlbElkbGVDYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJyA/IGNhbmNlbElkbGVDYWxsYmFjay5iaW5kKGdsb2JhbFRoaXNPcldpbmRvdykgOiB1bmRlZmluZWQpLFxuICAgIGNsZWFySW1tZWRpYXRlOlxuICAgICAgcG9ueWZpbGxGcm9tT3B0aW9ucy5jbGVhckltbWVkaWF0ZSB8fFxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtZ2xvYmFsc1xuICAgICAgKHR5cGVvZiBjbGVhckltbWVkaWF0ZSA9PT0gJ2Z1bmN0aW9uJyA/IGNsZWFySW1tZWRpYXRlLmJpbmQoZ2xvYmFsVGhpc09yV2luZG93KSA6IHVuZGVmaW5lZCksXG4gICAgY2xlYXJJbnRlcnZhbDpcbiAgICAgIHBvbnlmaWxsRnJvbU9wdGlvbnMuY2xlYXJJbnRlcnZhbCB8fFxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtZ2xvYmFsc1xuICAgICAgKHR5cGVvZiBjbGVhckludGVydmFsID09PSAnZnVuY3Rpb24nID8gY2xlYXJJbnRlcnZhbC5iaW5kKGdsb2JhbFRoaXNPcldpbmRvdykgOiB1bmRlZmluZWQpLFxuICAgIGNsZWFyVGltZW91dDpcbiAgICAgIHBvbnlmaWxsRnJvbU9wdGlvbnMuY2xlYXJUaW1lb3V0IHx8XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXG4gICAgICAodHlwZW9mIGNsZWFyVGltZW91dCA9PT0gJ2Z1bmN0aW9uJyA/IGNsZWFyVGltZW91dC5iaW5kKGdsb2JhbFRoaXNPcldpbmRvdykgOiB1bmRlZmluZWQpLFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHNcbiAgICBEYXRlOiBwb255ZmlsbEZyb21PcHRpb25zLkRhdGUgfHwgRGF0ZSxcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWU6XG4gICAgICBwb255ZmlsbEZyb21PcHRpb25zLnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtZ2xvYmFsc1xuICAgICAgKHR5cGVvZiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPT09ICdmdW5jdGlvbicgPyByZXF1ZXN0QW5pbWF0aW9uRnJhbWUuYmluZChnbG9iYWxUaGlzT3JXaW5kb3cpIDogdW5kZWZpbmVkKSxcbiAgICByZXF1ZXN0SWRsZUNhbGxiYWNrOlxuICAgICAgcG9ueWZpbGxGcm9tT3B0aW9ucy5yZXF1ZXN0SWRsZUNhbGxiYWNrIHx8XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXG4gICAgICAodHlwZW9mIHJlcXVlc3RJZGxlQ2FsbGJhY2sgPT09ICdmdW5jdGlvbicgPyByZXF1ZXN0SWRsZUNhbGxiYWNrLmJpbmQoZ2xvYmFsVGhpc09yV2luZG93KSA6IHVuZGVmaW5lZCksXG4gICAgc2V0SW1tZWRpYXRlOlxuICAgICAgcG9ueWZpbGxGcm9tT3B0aW9ucy5zZXRJbW1lZGlhdGUgfHxcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHNcbiAgICAgICh0eXBlb2Ygc2V0SW1tZWRpYXRlID09PSAnZnVuY3Rpb24nID8gc2V0SW1tZWRpYXRlLmJpbmQoZ2xvYmFsVGhpc09yV2luZG93KSA6IHVuZGVmaW5lZCksXG4gICAgc2V0SW50ZXJ2YWw6XG4gICAgICBwb255ZmlsbEZyb21PcHRpb25zLnNldEludGVydmFsIHx8XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXG4gICAgICAodHlwZW9mIHNldEludGVydmFsID09PSAnZnVuY3Rpb24nID8gc2V0SW50ZXJ2YWwuYmluZChnbG9iYWxUaGlzT3JXaW5kb3cpIDogdW5kZWZpbmVkKSxcbiAgICBzZXRUaW1lb3V0OlxuICAgICAgcG9ueWZpbGxGcm9tT3B0aW9ucy5zZXRUaW1lb3V0IHx8XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXG4gICAgICAodHlwZW9mIHNldFRpbWVvdXQgPT09ICdmdW5jdGlvbicgPyBzZXRUaW1lb3V0LmJpbmQoZ2xvYmFsVGhpc09yV2luZG93KSA6IHVuZGVmaW5lZClcbiAgfTtcblxuICAvLyBXZSBhcmUgc3VyZSB0aGUgXCJnZXRTdG9yZVwiIChmaXJzdCBhcmd1bWVudCkgaXMgbm90IGNhbGxlZCBvbiBcImNyZWF0ZUVuaGFuY2VyQW5kU2FnYU1pZGRsZXdhcmUoKVwiLlxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVzZS1iZWZvcmUtZGVmaW5lXG4gIGNvbnN0IHsgZW5oYW5jZXIsIHNhZ2FNaWRkbGV3YXJlIH0gPSBjcmVhdGVFbmhhbmNlckFuZFNhZ2FNaWRkbGV3YXJlKCgpID0+IHN0b3JlLCAuLi5taWRkbGV3YXJlcyk7XG4gIGNvbnN0IHN0b3JlID0gY3JlYXRlUmVkdXhTdG9yZShcbiAgICBjcmVhdGVSZWR1Y2VyKHBvbnlmaWxsKSxcbiAgICBpbml0aWFsU3RhdGUgfHwge30sXG4gICAgb3B0aW9ucy5kZXZUb29scyA/IGNvbXBvc2VXaXRoRGV2VG9vbHMoZW5oYW5jZXIpIDogZW5oYW5jZXJcbiAgKTtcblxuICBzYWdhTWlkZGxld2FyZS5ydW4oY3JlYXRlU2FnYXMoeyBwb255ZmlsbCB9KSk7XG5cbiAgcmV0dXJuIHN0b3JlO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBSZWR1eCBzdG9yZSBpbnRlcm5hbGx5IHVzZWQgYnkgV2ViIENoYXQuXG4gKlxuICogVGhpcyBzdG9yZSBpcyBjcml0aWNhbCBmb3IgV2ViIENoYXQgYnVzaW5lc3MgbG9naWNzIHRvIG9wZXJhdGUsIHBsZWFzZSB1c2Ugd2l0aCBjYXV0aW9ucy5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY3JlYXRlU3RvcmUoaW5pdGlhbFN0YXRlPywgLi4ubWlkZGxld2FyZXMpOiBTdG9yZSB7XG4gIHJldHVybiB3aXRoT3B0aW9ucyh7fSwgaW5pdGlhbFN0YXRlLCAuLi5taWRkbGV3YXJlcyk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIFJlZHV4IHN0b3JlIGludGVybmFsbHkgdXNlZCBieSBXZWIgQ2hhdCwgd2l0aCBSZWR1eCBkZXZlbG9wbWVudCB0b29scy5cbiAqXG4gKiBUaGlzIHN0b3JlIGlzIGNyaXRpY2FsIGZvciBXZWIgQ2hhdCBidXNpbmVzcyBsb2dpY3MgdG8gb3BlcmF0ZSwgcGxlYXNlIHVzZSB3aXRoIGNhdXRpb25zLlxuICpcbiAqIEBkZXByZWNhdGVkIFVzZSBgd2l0aE9wdGlvbnNgIGluc3RlYWQgYW5kIHBhc3MgYHsgZGV2VG9vbHM6IHRydWUgfWBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhEZXZUb29scyhpbml0aWFsU3RhdGU/LCAuLi5taWRkbGV3YXJlcyk6IFN0b3JlIHtcbiAgcmV0dXJuIHdpdGhPcHRpb25zKHsgZGV2VG9vbHM6IHRydWUgfSwgaW5pdGlhbFN0YXRlLCAuLi5taWRkbGV3YXJlcyk7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBeUJBLFNBQVNBLCtCQUFULENBQXlDQyxRQUF6QyxFQUFtRTtFQUNqRSxJQUFNQyxjQUFjLEdBQUcsSUFBQUMscUJBQUEsRUFBcUI7SUFDMUNDLE9BQU8sRUFBRSxtQkFBYTtNQUFBLG1DQUFUQyxJQUFTO1FBQVRBLElBQVM7TUFBQTs7TUFDcEIsSUFBT0MsR0FBUCxHQUFjRCxJQUFkO01BRUFFLE9BQU8sQ0FBQ0MsS0FBUixDQUFjRixHQUFkO01BRUEsSUFBTUcsS0FBSyxHQUFHUixRQUFRLEVBQXRCO01BRUFRLEtBQUssSUFBSUEsS0FBSyxDQUFDQyxRQUFOLENBQWUsSUFBQUMscUJBQUEsR0FBZixDQUFUO0lBQ0Q7RUFUeUMsQ0FBckIsQ0FBdkI7O0VBRGlFLGtDQUFiQyxXQUFhO0lBQWJBLFdBQWE7RUFBQTs7RUFhakUsT0FBTztJQUNMQyxRQUFRLEVBQUVDLHNCQUFBLGVBQW1CRixXQUFuQixTQUFnQ1YsY0FBaEMsR0FETDtJQUVMQSxjQUFjLEVBQWRBO0VBRkssQ0FBUDtBQUlEO0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7OztBQUNPLFNBQVNhLFdBQVQsQ0FBcUJDLE9BQXJCLEVBQWtEQyxZQUFsRCxFQUF3RjtFQUM3RjtFQUNBLElBQU1DLGtCQUFrQixHQUFHLE9BQU9DLFVBQVAsS0FBc0IsV0FBdEIsR0FBb0NDLE1BQXBDLEdBQTZDRCxVQUF4RTtFQUNBLElBQU1FLG1CQUFpRCxHQUFHTCxPQUFPLENBQUNNLFFBQVIsSUFBb0IsRUFBOUUsQ0FINkYsQ0FLN0Y7O0VBQ0EsSUFBTUEsUUFBNkIsR0FBRztJQUNwQ0Msb0JBQW9CLEVBQ2xCRixtQkFBbUIsQ0FBQ0Usb0JBQXBCLE1BQ0E7SUFDQTtJQUNDLE9BQU9BLG9CQUFQLEtBQWdDLFVBQWhDLEdBQTZDQSxvQkFBb0IsQ0FBQ0MsSUFBckIsQ0FBMEJOLGtCQUExQixDQUE3QyxHQUE2Rk8sU0FIOUYsQ0FGa0M7SUFNcENDLGtCQUFrQixFQUNoQkwsbUJBQW1CLENBQUNLLGtCQUFwQixNQUNBO0lBQ0MsT0FBT0Esa0JBQVAsS0FBOEIsVUFBOUIsR0FBMkNBLGtCQUFrQixDQUFDRixJQUFuQixDQUF3Qk4sa0JBQXhCLENBQTNDLEdBQXlGTyxTQUYxRixDQVBrQztJQVVwQ0UsY0FBYyxFQUNaTixtQkFBbUIsQ0FBQ00sY0FBcEIsTUFDQTtJQUNDLE9BQU9BLGNBQVAsS0FBMEIsVUFBMUIsR0FBdUNBLGNBQWMsQ0FBQ0gsSUFBZixDQUFvQk4sa0JBQXBCLENBQXZDLEdBQWlGTyxTQUZsRixDQVhrQztJQWNwQ0csYUFBYSxFQUNYUCxtQkFBbUIsQ0FBQ08sYUFBcEIsTUFDQTtJQUNDLE9BQU9BLGFBQVAsS0FBeUIsVUFBekIsR0FBc0NBLGFBQWEsQ0FBQ0osSUFBZCxDQUFtQk4sa0JBQW5CLENBQXRDLEdBQStFTyxTQUZoRixDQWZrQztJQWtCcENJLFlBQVksRUFDVlIsbUJBQW1CLENBQUNRLFlBQXBCLE1BQ0E7SUFDQyxPQUFPQSxZQUFQLEtBQXdCLFVBQXhCLEdBQXFDQSxZQUFZLENBQUNMLElBQWIsQ0FBa0JOLGtCQUFsQixDQUFyQyxHQUE2RU8sU0FGOUUsQ0FuQmtDO0lBc0JwQztJQUNBSyxJQUFJLEVBQUVULG1CQUFtQixDQUFDUyxJQUFwQixJQUE0QkEsSUF2QkU7SUF3QnBDQyxxQkFBcUIsRUFDbkJWLG1CQUFtQixDQUFDVSxxQkFBcEIsTUFDQTtJQUNDLE9BQU9BLHFCQUFQLEtBQWlDLFVBQWpDLEdBQThDQSxxQkFBcUIsQ0FBQ1AsSUFBdEIsQ0FBMkJOLGtCQUEzQixDQUE5QyxHQUErRk8sU0FGaEcsQ0F6QmtDO0lBNEJwQ08sbUJBQW1CLEVBQ2pCWCxtQkFBbUIsQ0FBQ1csbUJBQXBCLE1BQ0E7SUFDQyxPQUFPQSxtQkFBUCxLQUErQixVQUEvQixHQUE0Q0EsbUJBQW1CLENBQUNSLElBQXBCLENBQXlCTixrQkFBekIsQ0FBNUMsR0FBMkZPLFNBRjVGLENBN0JrQztJQWdDcENRLFlBQVksRUFDVlosbUJBQW1CLENBQUNZLFlBQXBCLE1BQ0E7SUFDQyxPQUFPQSxZQUFQLEtBQXdCLFVBQXhCLEdBQXFDQSxZQUFZLENBQUNULElBQWIsQ0FBa0JOLGtCQUFsQixDQUFyQyxHQUE2RU8sU0FGOUUsQ0FqQ2tDO0lBb0NwQ1MsV0FBVyxFQUNUYixtQkFBbUIsQ0FBQ2EsV0FBcEIsTUFDQTtJQUNDLE9BQU9BLFdBQVAsS0FBdUIsVUFBdkIsR0FBb0NBLFdBQVcsQ0FBQ1YsSUFBWixDQUFpQk4sa0JBQWpCLENBQXBDLEdBQTJFTyxTQUY1RSxDQXJDa0M7SUF3Q3BDVSxVQUFVLEVBQ1JkLG1CQUFtQixDQUFDYyxVQUFwQixNQUNBO0lBQ0MsT0FBT0EsVUFBUCxLQUFzQixVQUF0QixHQUFtQ0EsVUFBVSxDQUFDWCxJQUFYLENBQWdCTixrQkFBaEIsQ0FBbkMsR0FBeUVPLFNBRjFFO0VBekNrQyxDQUF0QyxDQU42RixDQW9EN0Y7RUFDQTs7RUFyRDZGLG1DQUFwQmIsV0FBb0I7SUFBcEJBLFdBQW9CO0VBQUE7O0VBc0Q3Riw0QkFBcUNaLCtCQUErQixNQUEvQixVQUFnQztJQUFBLE9BQU1TLEtBQU47RUFBQSxDQUFoQyxTQUFnREcsV0FBaEQsRUFBckM7RUFBQSxJQUFRQyxRQUFSLHlCQUFRQSxRQUFSO0VBQUEsSUFBa0JYLGNBQWxCLHlCQUFrQkEsY0FBbEI7O0VBQ0EsSUFBTU8sS0FBSyxHQUFHLElBQUEyQixrQkFBQSxFQUNaLElBQUFDLHlCQUFBLEVBQWNmLFFBQWQsQ0FEWSxFQUVaTCxZQUFZLElBQUksRUFGSixFQUdaRCxPQUFPLENBQUNzQixRQUFSLEdBQW1CLElBQUFDLDJDQUFBLEVBQW9CMUIsUUFBcEIsQ0FBbkIsR0FBbURBLFFBSHZDLENBQWQ7RUFNQVgsY0FBYyxDQUFDc0MsR0FBZixDQUFtQixJQUFBQyx1QkFBQSxFQUFZO0lBQUVuQixRQUFRLEVBQVJBO0VBQUYsQ0FBWixDQUFuQjtFQUVBLE9BQU9iLEtBQVA7QUFDRDtBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNlLFNBQVNpQyxXQUFULENBQXFCekIsWUFBckIsRUFBMkQ7RUFBQSxtQ0FBcEJMLFdBQW9CO0lBQXBCQSxXQUFvQjtFQUFBOztFQUN4RSxPQUFPRyxXQUFXLE1BQVgsVUFBWSxFQUFaLEVBQWdCRSxZQUFoQixTQUFpQ0wsV0FBakMsRUFBUDtBQUNEO0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNPLFNBQVMrQixZQUFULENBQXNCMUIsWUFBdEIsRUFBNEQ7RUFBQSxtQ0FBcEJMLFdBQW9CO0lBQXBCQSxXQUFvQjtFQUFBOztFQUNqRSxPQUFPRyxXQUFXLE1BQVgsVUFBWTtJQUFFdUIsUUFBUSxFQUFFO0VBQVosQ0FBWixFQUFnQ3JCLFlBQWhDLFNBQWlETCxXQUFqRCxFQUFQO0FBQ0QifQ==