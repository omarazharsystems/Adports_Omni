"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = queueIncomingActivitySaga;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _effects = require("redux-saga/effects");

var _queueIncomingActivity = require("../actions/queueIncomingActivity");

var _activities = _interopRequireWildcard(require("../selectors/activities"));

var _activityFromBot = _interopRequireDefault(require("../definitions/activityFromBot"));

var _incomingActivity = _interopRequireWildcard(require("../actions/incomingActivity"));

var _setSuggestedActions = _interopRequireDefault(require("../actions/setSuggestedActions"));

var _sleep = _interopRequireDefault(require("../utils/sleep"));

var _whileConnected = _interopRequireDefault(require("./effects/whileConnected"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

var _marked = /*#__PURE__*/_regenerator["default"].mark(takeEveryAndSelect),
    _marked2 = /*#__PURE__*/_regenerator["default"].mark(waitForActivityId),
    _marked3 = /*#__PURE__*/_regenerator["default"].mark(queueIncomingActivity),
    _marked4 = /*#__PURE__*/_regenerator["default"].mark(queueIncomingActivitySaga);

// We will hold up the replying activity if the originating activity did not arrive, up to 5 seconds.
var REPLY_TIMEOUT = 5000;

function takeEveryAndSelect(actionType, selector, fn) {
  var action, state;
  return _regenerator["default"].wrap(function takeEveryAndSelect$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          _context.next = 2;
          return (0, _effects.cancelled)();

        case 2:
          if (_context.sent) {
            _context.next = 13;
            break;
          }

          _context.next = 5;
          return (0, _effects.take)(actionType);

        case 5:
          action = _context.sent;
          _context.next = 8;
          return (0, _effects.select)(selector);

        case 8:
          state = _context.sent;
          _context.next = 11;
          return (0, _effects.fork)(fn, action, state);

        case 11:
          _context.next = 0;
          break;

        case 13:
        case "end":
          return _context.stop();
      }
    }
  }, _marked);
} // Wait for specific activity to arrive in the transcript.
// We will use the initial set of activities to close time gaps between select() and take().
// If another activity with the same "replyToId" is already rendered (in the "activities" array),
// we will skip the wait as we already waited long enough for the missing activity to show up.


function waitForActivityId(replyToId, initialActivities) {
  var activities, replied, _yield$take, activity;

  return _regenerator["default"].wrap(function waitForActivityId$(_context2) {
    while (1) {
      switch (_context2.prev = _context2.next) {
        case 0:
          activities = initialActivities;

        case 1:
          replied = activities.find(function (activity) {
            return activity.id === replyToId || activity.replyToId === replyToId;
          });

          if (!replied) {
            _context2.next = 4;
            break;
          }

          return _context2.abrupt("break", 15);

        case 4:
          _context2.next = 6;
          return (0, _effects.take)(_incomingActivity.INCOMING_ACTIVITY);

        case 6:
          _yield$take = _context2.sent;
          activity = _yield$take.payload.activity;

          if (!(activity.id === replyToId)) {
            _context2.next = 10;
            break;
          }

          return _context2.abrupt("break", 15);

        case 10:
          _context2.next = 12;
          return (0, _effects.select)(_activities["default"]);

        case 12:
          activities = _context2.sent;

        case 13:
          _context2.next = 1;
          break;

        case 15:
        case "end":
          return _context2.stop();
      }
    }
  }, _marked2);
}

function queueIncomingActivity(_ref, ponyfill) {
  var userID;
  return _regenerator["default"].wrap(function queueIncomingActivity$(_context4) {
    while (1) {
      switch (_context4.prev = _context4.next) {
        case 0:
          userID = _ref.userID;
          _context4.next = 3;
          return takeEveryAndSelect(_queueIncomingActivity.QUEUE_INCOMING_ACTIVITY, _activities["default"], /*#__PURE__*/_regenerator["default"].mark(function queueIncomingActivity(_ref2, initialActivities) {
            var activity, replyToId, initialBotActivities, result, messageActivities, lastMessageActivity, _lastMessageActivity$, actions, to;

            return _regenerator["default"].wrap(function queueIncomingActivity$(_context3) {
              while (1) {
                switch (_context3.prev = _context3.next) {
                  case 0:
                    activity = _ref2.payload.activity;
                    // This is for resolving an accessibility issue.
                    // If the incoming activity has "replyToId" field, hold on it until the activity replied to is in the transcript, then release this one.
                    replyToId = activity.replyToId;
                    initialBotActivities = initialActivities.filter(function (_ref3) {
                      var role = _ref3.from.role;
                      return role === 'bot';
                    }); // To speed up the first activity render time, we do not delay the first activity from the bot.
                    // Even if it is the first activity from the bot, the bot might be "replying" to the "conversationUpdate" event.
                    // Thus, the "replyToId" will always be there even it is the first activity in the conversation.

                    if (!(replyToId && initialBotActivities.length)) {
                      _context3.next = 8;
                      break;
                    }

                    _context3.next = 6;
                    return (0, _effects.race)({
                      _: waitForActivityId(replyToId, initialActivities),
                      timeout: (0, _effects.call)(_sleep["default"], REPLY_TIMEOUT, ponyfill)
                    });

                  case 6:
                    result = _context3.sent;

                    if ('timeout' in result) {
                      console.warn("botframework-webchat: Timed out while waiting for activity \"".concat(replyToId, "\" which activity \"").concat(activity.id, "\" is replying to."), {
                        activity: activity,
                        replyToId: replyToId
                      });
                    }

                  case 8:
                    _context3.next = 10;
                    return (0, _effects.put)((0, _incomingActivity["default"])(activity));

                  case 10:
                    _context3.next = 12;
                    return (0, _effects.select)((0, _activities.ofType)('message'));

                  case 12:
                    messageActivities = _context3.sent;
                    lastMessageActivity = messageActivities[messageActivities.length - 1];

                    if (!(0, _activityFromBot["default"])(lastMessageActivity)) {
                      _context3.next = 20;
                      break;
                    }

                    _lastMessageActivity$ = lastMessageActivity.suggestedActions;
                    _lastMessageActivity$ = _lastMessageActivity$ === void 0 ? {
                      actions: undefined,
                      to: undefined
                    } : _lastMessageActivity$;
                    actions = _lastMessageActivity$.actions, to = _lastMessageActivity$.to; // If suggested actions is not destined to anyone, or is destined to the user, show it.
                    // In other words, if suggested actions is destined to someone else, don't show it.

                    _context3.next = 20;
                    return (0, _effects.put)((0, _setSuggestedActions["default"])(to !== null && to !== void 0 && to.length && !to.includes(userID) ? null : actions));

                  case 20:
                  case "end":
                    return _context3.stop();
                }
              }
            }, queueIncomingActivity);
          }));

        case 3:
        case "end":
          return _context4.stop();
      }
    }
  }, _marked3);
}

function queueIncomingActivitySaga(ponyfill) {
  return _regenerator["default"].wrap(function queueIncomingActivitySaga$(_context5) {
    while (1) {
      switch (_context5.prev = _context5.next) {
        case 0:
          _context5.next = 2;
          return (0, _whileConnected["default"])(queueIncomingActivity, ponyfill);

        case 2:
        case "end":
          return _context5.stop();
      }
    }
  }, _marked4);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ0YWtlRXZlcnlBbmRTZWxlY3QiLCJ3YWl0Rm9yQWN0aXZpdHlJZCIsInF1ZXVlSW5jb21pbmdBY3Rpdml0eSIsInF1ZXVlSW5jb21pbmdBY3Rpdml0eVNhZ2EiLCJSRVBMWV9USU1FT1VUIiwiYWN0aW9uVHlwZSIsInNlbGVjdG9yIiwiZm4iLCJjYW5jZWxsZWQiLCJ0YWtlIiwiYWN0aW9uIiwic2VsZWN0Iiwic3RhdGUiLCJmb3JrIiwicmVwbHlUb0lkIiwiaW5pdGlhbEFjdGl2aXRpZXMiLCJhY3Rpdml0aWVzIiwicmVwbGllZCIsImZpbmQiLCJhY3Rpdml0eSIsImlkIiwiSU5DT01JTkdfQUNUSVZJVFkiLCJwYXlsb2FkIiwiYWN0aXZpdGllc1NlbGVjdG9yIiwicG9ueWZpbGwiLCJ1c2VySUQiLCJRVUVVRV9JTkNPTUlOR19BQ1RJVklUWSIsImluaXRpYWxCb3RBY3Rpdml0aWVzIiwiZmlsdGVyIiwicm9sZSIsImZyb20iLCJsZW5ndGgiLCJyYWNlIiwiXyIsInRpbWVvdXQiLCJjYWxsIiwic2xlZXAiLCJyZXN1bHQiLCJjb25zb2xlIiwid2FybiIsInB1dCIsImluY29taW5nQWN0aXZpdHkiLCJhY3Rpdml0aWVzT2ZUeXBlIiwibWVzc2FnZUFjdGl2aXRpZXMiLCJsYXN0TWVzc2FnZUFjdGl2aXR5IiwiYWN0aXZpdHlGcm9tQm90Iiwic3VnZ2VzdGVkQWN0aW9ucyIsImFjdGlvbnMiLCJ1bmRlZmluZWQiLCJ0byIsInNldFN1Z2dlc3RlZEFjdGlvbnMiLCJpbmNsdWRlcyIsIndoaWxlQ29ubmVjdGVkIl0sInNvdXJjZVJvb3QiOiJjb3JlOi8vLyIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NhZ2FzL3F1ZXVlSW5jb21pbmdBY3Rpdml0eVNhZ2EudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY2FsbCwgY2FuY2VsbGVkLCBmb3JrLCBwdXQsIHJhY2UsIHNlbGVjdCwgdGFrZSB9IGZyb20gJ3JlZHV4LXNhZ2EvZWZmZWN0cyc7XG5cbmltcG9ydCB7IFFVRVVFX0lOQ09NSU5HX0FDVElWSVRZIH0gZnJvbSAnLi4vYWN0aW9ucy9xdWV1ZUluY29taW5nQWN0aXZpdHknO1xuaW1wb3J0IGFjdGl2aXRpZXNTZWxlY3RvciwgeyBvZlR5cGUgYXMgYWN0aXZpdGllc09mVHlwZSB9IGZyb20gJy4uL3NlbGVjdG9ycy9hY3Rpdml0aWVzJztcbmltcG9ydCBhY3Rpdml0eUZyb21Cb3QgZnJvbSAnLi4vZGVmaW5pdGlvbnMvYWN0aXZpdHlGcm9tQm90JztcbmltcG9ydCBpbmNvbWluZ0FjdGl2aXR5LCB7IElOQ09NSU5HX0FDVElWSVRZIH0gZnJvbSAnLi4vYWN0aW9ucy9pbmNvbWluZ0FjdGl2aXR5JztcbmltcG9ydCBzZXRTdWdnZXN0ZWRBY3Rpb25zIGZyb20gJy4uL2FjdGlvbnMvc2V0U3VnZ2VzdGVkQWN0aW9ucyc7XG5pbXBvcnQgc2xlZXAgZnJvbSAnLi4vdXRpbHMvc2xlZXAnO1xuaW1wb3J0IHdoaWxlQ29ubmVjdGVkIGZyb20gJy4vZWZmZWN0cy93aGlsZUNvbm5lY3RlZCc7XG5cbmltcG9ydCB0eXBlIHsgR2xvYmFsU2NvcGVQb255ZmlsbCB9IGZyb20gJy4uL3R5cGVzL0dsb2JhbFNjb3BlUG9ueWZpbGwnO1xuXG4vLyBXZSB3aWxsIGhvbGQgdXAgdGhlIHJlcGx5aW5nIGFjdGl2aXR5IGlmIHRoZSBvcmlnaW5hdGluZyBhY3Rpdml0eSBkaWQgbm90IGFycml2ZSwgdXAgdG8gNSBzZWNvbmRzLlxuY29uc3QgUkVQTFlfVElNRU9VVCA9IDUwMDA7XG5cbmZ1bmN0aW9uKiB0YWtlRXZlcnlBbmRTZWxlY3QoYWN0aW9uVHlwZSwgc2VsZWN0b3IsIGZuKSB7XG4gIC8vIHNlbGVjdCgpIHdpbGwgZnJlZSB1cCB0aGUgY29kZSBleGVjdXRpb24uXG4gIC8vIElmIHdlIHBhaXIgdXAgd2l0aCB0YWtlRXZlcnkoKSwgaXQgd2lsbCBhbGxvdyBhY3Rpb25zIHRvIHNsaXAgdGhyb3VnaC5cbiAgLy8gVGh1cywgd2UgYXJlIHdyaXRpbmcgb25lIHRoYXQgZG9uJ3QgdXNlIHRha2VFdmVyeSgpLlxuICB3aGlsZSAoISh5aWVsZCBjYW5jZWxsZWQoKSkpIHtcbiAgICBjb25zdCBhY3Rpb24gPSB5aWVsZCB0YWtlKGFjdGlvblR5cGUpO1xuICAgIGNvbnN0IHN0YXRlID0geWllbGQgc2VsZWN0KHNlbGVjdG9yKTtcblxuICAgIHlpZWxkIGZvcmsoZm4sIGFjdGlvbiwgc3RhdGUpO1xuICB9XG59XG5cbi8vIFdhaXQgZm9yIHNwZWNpZmljIGFjdGl2aXR5IHRvIGFycml2ZSBpbiB0aGUgdHJhbnNjcmlwdC5cbi8vIFdlIHdpbGwgdXNlIHRoZSBpbml0aWFsIHNldCBvZiBhY3Rpdml0aWVzIHRvIGNsb3NlIHRpbWUgZ2FwcyBiZXR3ZWVuIHNlbGVjdCgpIGFuZCB0YWtlKCkuXG4vLyBJZiBhbm90aGVyIGFjdGl2aXR5IHdpdGggdGhlIHNhbWUgXCJyZXBseVRvSWRcIiBpcyBhbHJlYWR5IHJlbmRlcmVkIChpbiB0aGUgXCJhY3Rpdml0aWVzXCIgYXJyYXkpLFxuLy8gd2Ugd2lsbCBza2lwIHRoZSB3YWl0IGFzIHdlIGFscmVhZHkgd2FpdGVkIGxvbmcgZW5vdWdoIGZvciB0aGUgbWlzc2luZyBhY3Rpdml0eSB0byBzaG93IHVwLlxuZnVuY3Rpb24qIHdhaXRGb3JBY3Rpdml0eUlkKHJlcGx5VG9JZCwgaW5pdGlhbEFjdGl2aXRpZXMpIHtcbiAgbGV0IGFjdGl2aXRpZXMgPSBpbml0aWFsQWN0aXZpdGllcztcblxuICBmb3IgKDs7KSB7XG4gICAgY29uc3QgcmVwbGllZCA9IGFjdGl2aXRpZXMuZmluZChhY3Rpdml0eSA9PiBhY3Rpdml0eS5pZCA9PT0gcmVwbHlUb0lkIHx8IGFjdGl2aXR5LnJlcGx5VG9JZCA9PT0gcmVwbHlUb0lkKTtcblxuICAgIGlmIChyZXBsaWVkKSB7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICBjb25zdCB7XG4gICAgICBwYXlsb2FkOiB7IGFjdGl2aXR5IH1cbiAgICB9ID0geWllbGQgdGFrZShJTkNPTUlOR19BQ1RJVklUWSk7XG5cbiAgICBpZiAoYWN0aXZpdHkuaWQgPT09IHJlcGx5VG9JZCkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgYWN0aXZpdGllcyA9IHlpZWxkIHNlbGVjdChhY3Rpdml0aWVzU2VsZWN0b3IpO1xuICB9XG59XG5cbmZ1bmN0aW9uKiBxdWV1ZUluY29taW5nQWN0aXZpdHkoeyB1c2VySUQgfTogeyB1c2VySUQ6IHN0cmluZyB9LCBwb255ZmlsbDogR2xvYmFsU2NvcGVQb255ZmlsbCkge1xuICB5aWVsZCB0YWtlRXZlcnlBbmRTZWxlY3QoXG4gICAgUVVFVUVfSU5DT01JTkdfQUNUSVZJVFksXG4gICAgYWN0aXZpdGllc1NlbGVjdG9yLFxuICAgIGZ1bmN0aW9uKiBxdWV1ZUluY29taW5nQWN0aXZpdHkoeyBwYXlsb2FkOiB7IGFjdGl2aXR5IH0gfSwgaW5pdGlhbEFjdGl2aXRpZXMpIHtcbiAgICAgIC8vIFRoaXMgaXMgZm9yIHJlc29sdmluZyBhbiBhY2Nlc3NpYmlsaXR5IGlzc3VlLlxuICAgICAgLy8gSWYgdGhlIGluY29taW5nIGFjdGl2aXR5IGhhcyBcInJlcGx5VG9JZFwiIGZpZWxkLCBob2xkIG9uIGl0IHVudGlsIHRoZSBhY3Rpdml0eSByZXBsaWVkIHRvIGlzIGluIHRoZSB0cmFuc2NyaXB0LCB0aGVuIHJlbGVhc2UgdGhpcyBvbmUuXG4gICAgICBjb25zdCB7IHJlcGx5VG9JZCB9ID0gYWN0aXZpdHk7XG4gICAgICBjb25zdCBpbml0aWFsQm90QWN0aXZpdGllcyA9IGluaXRpYWxBY3Rpdml0aWVzLmZpbHRlcigoeyBmcm9tOiB7IHJvbGUgfSB9KSA9PiByb2xlID09PSAnYm90Jyk7XG5cbiAgICAgIC8vIFRvIHNwZWVkIHVwIHRoZSBmaXJzdCBhY3Rpdml0eSByZW5kZXIgdGltZSwgd2UgZG8gbm90IGRlbGF5IHRoZSBmaXJzdCBhY3Rpdml0eSBmcm9tIHRoZSBib3QuXG4gICAgICAvLyBFdmVuIGlmIGl0IGlzIHRoZSBmaXJzdCBhY3Rpdml0eSBmcm9tIHRoZSBib3QsIHRoZSBib3QgbWlnaHQgYmUgXCJyZXBseWluZ1wiIHRvIHRoZSBcImNvbnZlcnNhdGlvblVwZGF0ZVwiIGV2ZW50LlxuICAgICAgLy8gVGh1cywgdGhlIFwicmVwbHlUb0lkXCIgd2lsbCBhbHdheXMgYmUgdGhlcmUgZXZlbiBpdCBpcyB0aGUgZmlyc3QgYWN0aXZpdHkgaW4gdGhlIGNvbnZlcnNhdGlvbi5cbiAgICAgIGlmIChyZXBseVRvSWQgJiYgaW5pdGlhbEJvdEFjdGl2aXRpZXMubGVuZ3RoKSB7XG4gICAgICAgIC8vIEVpdGhlciB0aGUgYWN0aXZpdHkgcmVwbGllZCB0byBpcyBpbiB0aGUgdHJhbnNjcmlwdCBvciBhZnRlciB0aW1lb3V0LlxuICAgICAgICBjb25zdCByZXN1bHQgPSB5aWVsZCByYWNlKHtcbiAgICAgICAgICBfOiB3YWl0Rm9yQWN0aXZpdHlJZChyZXBseVRvSWQsIGluaXRpYWxBY3Rpdml0aWVzKSxcbiAgICAgICAgICB0aW1lb3V0OiBjYWxsKHNsZWVwLCBSRVBMWV9USU1FT1VULCBwb255ZmlsbClcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCd0aW1lb3V0JyBpbiByZXN1bHQpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICBgYm90ZnJhbWV3b3JrLXdlYmNoYXQ6IFRpbWVkIG91dCB3aGlsZSB3YWl0aW5nIGZvciBhY3Rpdml0eSBcIiR7cmVwbHlUb0lkfVwiIHdoaWNoIGFjdGl2aXR5IFwiJHthY3Rpdml0eS5pZH1cIiBpcyByZXBseWluZyB0by5gLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBhY3Rpdml0eSxcbiAgICAgICAgICAgICAgcmVwbHlUb0lkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB5aWVsZCBwdXQoaW5jb21pbmdBY3Rpdml0eShhY3Rpdml0eSkpO1xuXG4gICAgICAvLyBVcGRhdGUgc3VnZ2VzdGVkIGFjdGlvbnNcbiAgICAgIC8vIFRPRE86IFtQM10gV2UgY291bGQgcHV0IHRoaXMgbG9naWMgaW5zaWRlIHJlZHVjZXIgdG8gbWluaW1pemUgbnVtYmVyIG9mIGFjdGlvbnMgZGlzcGF0Y2hlZC5cbiAgICAgIGNvbnN0IG1lc3NhZ2VBY3Rpdml0aWVzID0geWllbGQgc2VsZWN0KGFjdGl2aXRpZXNPZlR5cGUoJ21lc3NhZ2UnKSk7XG4gICAgICBjb25zdCBsYXN0TWVzc2FnZUFjdGl2aXR5ID0gbWVzc2FnZUFjdGl2aXRpZXNbbWVzc2FnZUFjdGl2aXRpZXMubGVuZ3RoIC0gMV07XG5cbiAgICAgIGlmIChhY3Rpdml0eUZyb21Cb3QobGFzdE1lc3NhZ2VBY3Rpdml0eSkpIHtcbiAgICAgICAgY29uc3QgeyBzdWdnZXN0ZWRBY3Rpb25zOiB7IGFjdGlvbnMsIHRvIH0gPSB7IGFjdGlvbnM6IHVuZGVmaW5lZCwgdG86IHVuZGVmaW5lZCB9IH0gPSBsYXN0TWVzc2FnZUFjdGl2aXR5O1xuXG4gICAgICAgIC8vIElmIHN1Z2dlc3RlZCBhY3Rpb25zIGlzIG5vdCBkZXN0aW5lZCB0byBhbnlvbmUsIG9yIGlzIGRlc3RpbmVkIHRvIHRoZSB1c2VyLCBzaG93IGl0LlxuICAgICAgICAvLyBJbiBvdGhlciB3b3JkcywgaWYgc3VnZ2VzdGVkIGFjdGlvbnMgaXMgZGVzdGluZWQgdG8gc29tZW9uZSBlbHNlLCBkb24ndCBzaG93IGl0LlxuICAgICAgICB5aWVsZCBwdXQoc2V0U3VnZ2VzdGVkQWN0aW9ucyh0bz8ubGVuZ3RoICYmICF0by5pbmNsdWRlcyh1c2VySUQpID8gbnVsbCA6IGFjdGlvbnMpKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uKiBxdWV1ZUluY29taW5nQWN0aXZpdHlTYWdhKHBvbnlmaWxsOiBHbG9iYWxTY29wZVBvbnlmaWxsKSB7XG4gIHlpZWxkIHdoaWxlQ29ubmVjdGVkKHF1ZXVlSW5jb21pbmdBY3Rpdml0eSwgcG9ueWZpbGwpO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7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