"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = normalizeStyleOptions;

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _defaultStyleOptions = _interopRequireDefault(require("./defaultStyleOptions"));

var _excluded = ["hideScrollToEndButton", "newMessagesButtonFontSize"];

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }

function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }

var hideScrollToEndButtonDeprecation = (0, _botframeworkWebchatCore.warnOnce)('"styleOptions.hideScrollToEndButton" has been deprecated. To hide scroll to end button, set "scrollToEndBehavior" to false. This deprecation migration will be removed on or after 2023-06-02.');
var newMessagesButtonFontSizeDeprecation = (0, _botframeworkWebchatCore.warnOnce)('"styleOptions.newMessagesButtonFontSize" has been renamed to "styleOptions.scrollToEndButtonFontSize". This deprecation migration will be removed on or after 2023-06-02.');
var suggestedActionBackgroundDeprecation = (0, _botframeworkWebchatCore.warnOnce)('"styleOptions.suggestedActionBackground" has been deprecated. Please use "styleOptions.suggestedActionBackgroundColor" instead. This deprecation migration will be removed on or after 2021-09-16.');
var suggestedActionXXXBackgroundDeprecation = (0, _botframeworkWebchatCore.warnOnce)('"styleOptions.suggestedActionXXXBackground" has been deprecated. Please use "styleOptions.suggestedActionBackgroundColorOnXXX" instead. This deprecation migration will be removed on or after 2021-09-16.');
var suggestedActionDisabledDeprecation = (0, _botframeworkWebchatCore.warnOnce)('"styleOptions.suggestedActionDisabledXXX" has been renamed to "styleOptions.suggestedActionXXXOnDisabled". This deprecation migration will be removed on or after 2021-09-16.'); // TODO: [P4] We should add a notice for people who want to use "styleSet" instead of "styleOptions".
//       "styleSet" is actually CSS stylesheet and it is based on the DOM tree.
//       DOM tree may change from time to time, thus, maintaining "styleSet" becomes a constant effort.
// eslint-disable-next-line complexity

function normalizeStyleOptions() {
  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      hideScrollToEndButton = _ref.hideScrollToEndButton,
      newMessagesButtonFontSize = _ref.newMessagesButtonFontSize,
      options = _objectWithoutProperties(_ref, _excluded);

  var filledOptions = _objectSpread(_objectSpread({}, _defaultStyleOptions.default), options); // Keep this list flat (no nested style) and serializable (no functions)


  var bubbleFromUserNubOffset = filledOptions.bubbleFromUserNubOffset,
      bubbleNubOffset = filledOptions.bubbleNubOffset,
      emojiSet = filledOptions.emojiSet;
  var normalizedBubbleFromUserNubOffset;
  var normalizedBubbleNubOffset;
  var normalizedEmojiSet;

  if (bubbleFromUserNubOffset === 'top') {
    normalizedBubbleFromUserNubOffset = 0;
  } else if (typeof bubbleFromUserNubOffset !== 'number') {
    normalizedBubbleFromUserNubOffset = -0;
  } else {
    normalizedBubbleFromUserNubOffset = bubbleFromUserNubOffset;
  }

  if (bubbleNubOffset === 'top') {
    normalizedBubbleNubOffset = 0;
  } else if (typeof bubbleNubOffset !== 'number') {
    normalizedBubbleNubOffset = -0;
  } else {
    normalizedBubbleNubOffset = bubbleNubOffset;
  }

  if (emojiSet === true) {
    normalizedEmojiSet = {
      ':)': 'ğŸ˜Š',
      ':-)': 'ğŸ˜Š',
      '(:': 'ğŸ˜Š',
      '(-:': 'ğŸ˜Š',
      ':-|': 'ğŸ˜',
      ':|': 'ğŸ˜',
      ':-(': 'â˜¹ï¸',
      ':(': 'â˜¹ï¸',
      ':-D': 'ğŸ˜€',
      ':D': 'ğŸ˜€',
      ':-p': 'ğŸ˜›',
      ':p': 'ğŸ˜›',
      ':-P': 'ğŸ˜›',
      ':P': 'ğŸ˜›',
      ':-o': 'ğŸ˜²',
      ':o': 'ğŸ˜²',
      ':O': 'ğŸ˜²',
      ':-O': 'ğŸ˜²',
      ':-0': 'ğŸ˜²',
      ':0': 'ğŸ˜²',
      ';-)': 'ğŸ˜‰',
      ';)': 'ğŸ˜‰',
      '<3': 'â¤ï¸',
      '</3': 'ğŸ’”',
      '<\\3': 'ğŸ’”'
    };
  } else if (Object.prototype.toString.call(emojiSet) !== '[object Object]') {
    console.warn('botframework-webchat: emojiSet must be a boolean or an object with emoticon: emojiValues');
    normalizedEmojiSet = false;
  } else {
    normalizedEmojiSet = emojiSet;
  }

  if (hideScrollToEndButton) {
    hideScrollToEndButtonDeprecation(); // Only set if the "scrollToEndButtonBehavior" is not set.
    // If it has been set, the developer should know the older "hideScrollToEndButton" option is deprecated.

    filledOptions.scrollToEndButtonBehavior = options.scrollToEndButtonBehavior || false;
  }

  var patchedScrollToEndButtonBehavior = filledOptions.scrollToEndButtonBehavior;

  if (patchedScrollToEndButtonBehavior !== 'any' && patchedScrollToEndButtonBehavior !== false) {
    patchedScrollToEndButtonBehavior === 'unread' || console.warn('Web Chat: "scrollToEndButtonBehavior" must be either "unread", "any", or false, will set to "unread".');
    patchedScrollToEndButtonBehavior = 'unread';
  }

  if (newMessagesButtonFontSize) {
    newMessagesButtonFontSizeDeprecation(); // Only set if the "scrollToEndButtonFontSize" is not set.

    filledOptions.scrollToEndButtonFontSize = options.scrollToEndButtonFontSize || newMessagesButtonFontSize;
  }

  options.suggestedActionBackground && suggestedActionBackgroundDeprecation();

  if (options.suggestedActionActiveBackground) {
    suggestedActionXXXBackgroundDeprecation();
    filledOptions.suggestedActionBackgroundColorOnActive = options.suggestedActionBackgroundColorOnActive || options.suggestedActionActiveBackground;
  }

  if (options.suggestedActionFocusBackground) {
    suggestedActionXXXBackgroundDeprecation();
    filledOptions.suggestedActionBackgroundColorOnFocus = options.suggestedActionBackgroundColorOnFocus || options.suggestedActionFocusBackground;
  }

  if (options.suggestedActionHoverBackground) {
    suggestedActionXXXBackgroundDeprecation();
    filledOptions.suggestedActionBackgroundColorOnHover = options.suggestedActionBackgroundColorOnHover || options.suggestedActionHoverBackground;
  }

  if (options.suggestedActionDisabledBackground) {
    suggestedActionXXXBackgroundDeprecation();
    filledOptions.suggestedActionBackgroundColorOnDisabled = options.suggestedActionBackgroundColorOnDisabled || options.suggestedActionDisabledBackground;
  }

  if (options.suggestedActionDisabledBorderColor) {
    suggestedActionDisabledDeprecation();
    filledOptions.suggestedActionBorderColorOnDisabled = options.suggestedActionBorderColorOnDisabled || options.suggestedActionDisabledBorderColor;
  }

  if (options.suggestedActionDisabledBorderStyle) {
    suggestedActionDisabledDeprecation();
    filledOptions.suggestedActionBorderStyleOnDisabled = options.suggestedActionBorderStyleOnDisabled || options.suggestedActionDisabledBorderStyle;
  }

  if (options.suggestedActionDisabledBorderWidth) {
    suggestedActionDisabledDeprecation();
    filledOptions.suggestedActionBorderWidthOnDisabled = options.suggestedActionBorderWidthOnDisabled || options.suggestedActionDisabledBorderWidth;
  }

  if (options.suggestedActionDisabledTextColor) {
    suggestedActionDisabledDeprecation();
    filledOptions.suggestedActionTextColorOnDisabled = options.suggestedActionTextColorOnDisabled || options.suggestedActionDisabledTextColor;
  }

  return _objectSpread(_objectSpread({}, filledOptions), {}, {
    bubbleFromUserNubOffset: normalizedBubbleFromUserNubOffset,
    bubbleNubOffset: normalizedBubbleNubOffset,
    emojiSet: normalizedEmojiSet,
    scrollToEndButtonBehavior: patchedScrollToEndButtonBehavior
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoaWRlU2Nyb2xsVG9FbmRCdXR0b25EZXByZWNhdGlvbiIsIndhcm5PbmNlIiwibmV3TWVzc2FnZXNCdXR0b25Gb250U2l6ZURlcHJlY2F0aW9uIiwic3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZERlcHJlY2F0aW9uIiwic3VnZ2VzdGVkQWN0aW9uWFhYQmFja2dyb3VuZERlcHJlY2F0aW9uIiwic3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWREZXByZWNhdGlvbiIsIm5vcm1hbGl6ZVN0eWxlT3B0aW9ucyIsImhpZGVTY3JvbGxUb0VuZEJ1dHRvbiIsIm5ld01lc3NhZ2VzQnV0dG9uRm9udFNpemUiLCJvcHRpb25zIiwiZmlsbGVkT3B0aW9ucyIsImRlZmF1bHRTdHlsZU9wdGlvbnMiLCJidWJibGVGcm9tVXNlck51Yk9mZnNldCIsImJ1YmJsZU51Yk9mZnNldCIsImVtb2ppU2V0Iiwibm9ybWFsaXplZEJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0Iiwibm9ybWFsaXplZEJ1YmJsZU51Yk9mZnNldCIsIm5vcm1hbGl6ZWRFbW9qaVNldCIsIk9iamVjdCIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwiY2FsbCIsImNvbnNvbGUiLCJ3YXJuIiwic2Nyb2xsVG9FbmRCdXR0b25CZWhhdmlvciIsInBhdGNoZWRTY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yIiwic2Nyb2xsVG9FbmRCdXR0b25Gb250U2l6ZSIsInN1Z2dlc3RlZEFjdGlvbkJhY2tncm91bmQiLCJzdWdnZXN0ZWRBY3Rpb25BY3RpdmVCYWNrZ3JvdW5kIiwic3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZENvbG9yT25BY3RpdmUiLCJzdWdnZXN0ZWRBY3Rpb25Gb2N1c0JhY2tncm91bmQiLCJzdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kQ29sb3JPbkZvY3VzIiwic3VnZ2VzdGVkQWN0aW9uSG92ZXJCYWNrZ3JvdW5kIiwic3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZENvbG9yT25Ib3ZlciIsInN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkQmFja2dyb3VuZCIsInN1Z2dlc3RlZEFjdGlvbkJhY2tncm91bmRDb2xvck9uRGlzYWJsZWQiLCJzdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZEJvcmRlckNvbG9yIiwic3VnZ2VzdGVkQWN0aW9uQm9yZGVyQ29sb3JPbkRpc2FibGVkIiwic3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWRCb3JkZXJTdHlsZSIsInN1Z2dlc3RlZEFjdGlvbkJvcmRlclN0eWxlT25EaXNhYmxlZCIsInN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkQm9yZGVyV2lkdGgiLCJzdWdnZXN0ZWRBY3Rpb25Cb3JkZXJXaWR0aE9uRGlzYWJsZWQiLCJzdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZFRleHRDb2xvciIsInN1Z2dlc3RlZEFjdGlvblRleHRDb2xvck9uRGlzYWJsZWQiXSwic291cmNlUm9vdCI6ImNvbXBvbmVudDovLy8iLCJzb3VyY2VzIjpbIi4uL3NyYy9ub3JtYWxpemVTdHlsZU9wdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgd2Fybk9uY2UgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1jb3JlJztcblxuaW1wb3J0IGRlZmF1bHRTdHlsZU9wdGlvbnMgZnJvbSAnLi9kZWZhdWx0U3R5bGVPcHRpb25zJztcbmltcG9ydCBTdHlsZU9wdGlvbnMsIHsgU3RyaWN0U3R5bGVPcHRpb25zIH0gZnJvbSAnLi9TdHlsZU9wdGlvbnMnO1xuXG5jb25zdCBoaWRlU2Nyb2xsVG9FbmRCdXR0b25EZXByZWNhdGlvbiA9IHdhcm5PbmNlKFxuICAnXCJzdHlsZU9wdGlvbnMuaGlkZVNjcm9sbFRvRW5kQnV0dG9uXCIgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVG8gaGlkZSBzY3JvbGwgdG8gZW5kIGJ1dHRvbiwgc2V0IFwic2Nyb2xsVG9FbmRCZWhhdmlvclwiIHRvIGZhbHNlLiBUaGlzIGRlcHJlY2F0aW9uIG1pZ3JhdGlvbiB3aWxsIGJlIHJlbW92ZWQgb24gb3IgYWZ0ZXIgMjAyMy0wNi0wMi4nXG4pO1xuXG5jb25zdCBuZXdNZXNzYWdlc0J1dHRvbkZvbnRTaXplRGVwcmVjYXRpb24gPSB3YXJuT25jZShcbiAgJ1wic3R5bGVPcHRpb25zLm5ld01lc3NhZ2VzQnV0dG9uRm9udFNpemVcIiBoYXMgYmVlbiByZW5hbWVkIHRvIFwic3R5bGVPcHRpb25zLnNjcm9sbFRvRW5kQnV0dG9uRm9udFNpemVcIi4gVGhpcyBkZXByZWNhdGlvbiBtaWdyYXRpb24gd2lsbCBiZSByZW1vdmVkIG9uIG9yIGFmdGVyIDIwMjMtMDYtMDIuJ1xuKTtcblxuY29uc3Qgc3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZERlcHJlY2F0aW9uID0gd2Fybk9uY2UoXG4gICdcInN0eWxlT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kXCIgaGFzIGJlZW4gZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSBcInN0eWxlT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kQ29sb3JcIiBpbnN0ZWFkLiBUaGlzIGRlcHJlY2F0aW9uIG1pZ3JhdGlvbiB3aWxsIGJlIHJlbW92ZWQgb24gb3IgYWZ0ZXIgMjAyMS0wOS0xNi4nXG4pO1xuXG5jb25zdCBzdWdnZXN0ZWRBY3Rpb25YWFhCYWNrZ3JvdW5kRGVwcmVjYXRpb24gPSB3YXJuT25jZShcbiAgJ1wic3R5bGVPcHRpb25zLnN1Z2dlc3RlZEFjdGlvblhYWEJhY2tncm91bmRcIiBoYXMgYmVlbiBkZXByZWNhdGVkLiBQbGVhc2UgdXNlIFwic3R5bGVPcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkJhY2tncm91bmRDb2xvck9uWFhYXCIgaW5zdGVhZC4gVGhpcyBkZXByZWNhdGlvbiBtaWdyYXRpb24gd2lsbCBiZSByZW1vdmVkIG9uIG9yIGFmdGVyIDIwMjEtMDktMTYuJ1xuKTtcblxuY29uc3Qgc3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWREZXByZWNhdGlvbiA9IHdhcm5PbmNlKFxuICAnXCJzdHlsZU9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWRYWFhcIiBoYXMgYmVlbiByZW5hbWVkIHRvIFwic3R5bGVPcHRpb25zLnN1Z2dlc3RlZEFjdGlvblhYWE9uRGlzYWJsZWRcIi4gVGhpcyBkZXByZWNhdGlvbiBtaWdyYXRpb24gd2lsbCBiZSByZW1vdmVkIG9uIG9yIGFmdGVyIDIwMjEtMDktMTYuJ1xuKTtcblxuLy8gVE9ETzogW1A0XSBXZSBzaG91bGQgYWRkIGEgbm90aWNlIGZvciBwZW9wbGUgd2hvIHdhbnQgdG8gdXNlIFwic3R5bGVTZXRcIiBpbnN0ZWFkIG9mIFwic3R5bGVPcHRpb25zXCIuXG4vLyAgICAgICBcInN0eWxlU2V0XCIgaXMgYWN0dWFsbHkgQ1NTIHN0eWxlc2hlZXQgYW5kIGl0IGlzIGJhc2VkIG9uIHRoZSBET00gdHJlZS5cbi8vICAgICAgIERPTSB0cmVlIG1heSBjaGFuZ2UgZnJvbSB0aW1lIHRvIHRpbWUsIHRodXMsIG1haW50YWluaW5nIFwic3R5bGVTZXRcIiBiZWNvbWVzIGEgY29uc3RhbnQgZWZmb3J0LlxuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGxleGl0eVxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gbm9ybWFsaXplU3R5bGVPcHRpb25zKHtcbiAgaGlkZVNjcm9sbFRvRW5kQnV0dG9uLFxuICBuZXdNZXNzYWdlc0J1dHRvbkZvbnRTaXplLFxuICAuLi5vcHRpb25zXG59OiBTdHlsZU9wdGlvbnMgPSB7fSk6IFN0cmljdFN0eWxlT3B0aW9ucyB7XG4gIGNvbnN0IGZpbGxlZE9wdGlvbnM6IFJlcXVpcmVkPFN0eWxlT3B0aW9ucz4gPSB7IC4uLmRlZmF1bHRTdHlsZU9wdGlvbnMsIC4uLm9wdGlvbnMgfTtcblxuICAvLyBLZWVwIHRoaXMgbGlzdCBmbGF0IChubyBuZXN0ZWQgc3R5bGUpIGFuZCBzZXJpYWxpemFibGUgKG5vIGZ1bmN0aW9ucylcbiAgY29uc3QgeyBidWJibGVGcm9tVXNlck51Yk9mZnNldCwgYnViYmxlTnViT2Zmc2V0LCBlbW9qaVNldCB9ID0gZmlsbGVkT3B0aW9ucztcblxuICBsZXQgbm9ybWFsaXplZEJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0OiBudW1iZXI7XG4gIGxldCBub3JtYWxpemVkQnViYmxlTnViT2Zmc2V0OiBudW1iZXI7XG4gIGxldCBub3JtYWxpemVkRW1vamlTZXQ6IGZhbHNlIHwgUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcblxuICBpZiAoYnViYmxlRnJvbVVzZXJOdWJPZmZzZXQgPT09ICd0b3AnKSB7XG4gICAgbm9ybWFsaXplZEJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0ID0gMDtcbiAgfSBlbHNlIGlmICh0eXBlb2YgYnViYmxlRnJvbVVzZXJOdWJPZmZzZXQgIT09ICdudW1iZXInKSB7XG4gICAgbm9ybWFsaXplZEJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0ID0gLTA7XG4gIH0gZWxzZSB7XG4gICAgbm9ybWFsaXplZEJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0ID0gYnViYmxlRnJvbVVzZXJOdWJPZmZzZXQ7XG4gIH1cblxuICBpZiAoYnViYmxlTnViT2Zmc2V0ID09PSAndG9wJykge1xuICAgIG5vcm1hbGl6ZWRCdWJibGVOdWJPZmZzZXQgPSAwO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBidWJibGVOdWJPZmZzZXQgIT09ICdudW1iZXInKSB7XG4gICAgbm9ybWFsaXplZEJ1YmJsZU51Yk9mZnNldCA9IC0wO1xuICB9IGVsc2Uge1xuICAgIG5vcm1hbGl6ZWRCdWJibGVOdWJPZmZzZXQgPSBidWJibGVOdWJPZmZzZXQ7XG4gIH1cblxuICBpZiAoZW1vamlTZXQgPT09IHRydWUpIHtcbiAgICBub3JtYWxpemVkRW1vamlTZXQgPSB7XG4gICAgICAnOiknOiAn8J+YiicsXG4gICAgICAnOi0pJzogJ/CfmIonLFxuICAgICAgJyg6JzogJ/CfmIonLFxuICAgICAgJygtOic6ICfwn5iKJyxcbiAgICAgICc6LXwnOiAn8J+YkCcsXG4gICAgICAnOnwnOiAn8J+YkCcsXG4gICAgICAnOi0oJzogJ+KYue+4jycsXG4gICAgICAnOignOiAn4pi577iPJyxcbiAgICAgICc6LUQnOiAn8J+YgCcsXG4gICAgICAnOkQnOiAn8J+YgCcsXG4gICAgICAnOi1wJzogJ/CfmJsnLFxuICAgICAgJzpwJzogJ/CfmJsnLFxuICAgICAgJzotUCc6ICfwn5ibJyxcbiAgICAgICc6UCc6ICfwn5ibJyxcbiAgICAgICc6LW8nOiAn8J+YsicsXG4gICAgICAnOm8nOiAn8J+YsicsXG4gICAgICAnOk8nOiAn8J+YsicsXG4gICAgICAnOi1PJzogJ/CfmLInLFxuICAgICAgJzotMCc6ICfwn5iyJyxcbiAgICAgICc6MCc6ICfwn5iyJyxcbiAgICAgICc7LSknOiAn8J+YiScsXG4gICAgICAnOyknOiAn8J+YiScsXG4gICAgICAnPDMnOiAn4p2k77iPJyxcbiAgICAgICc8LzMnOiAn8J+SlCcsXG4gICAgICAnPFxcXFwzJzogJ/CfkpQnXG4gICAgfTtcbiAgfSBlbHNlIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZW1vamlTZXQpICE9PSAnW29iamVjdCBPYmplY3RdJykge1xuICAgIGNvbnNvbGUud2FybignYm90ZnJhbWV3b3JrLXdlYmNoYXQ6IGVtb2ppU2V0IG11c3QgYmUgYSBib29sZWFuIG9yIGFuIG9iamVjdCB3aXRoIGVtb3RpY29uOiBlbW9qaVZhbHVlcycpO1xuICAgIG5vcm1hbGl6ZWRFbW9qaVNldCA9IGZhbHNlO1xuICB9IGVsc2Uge1xuICAgIG5vcm1hbGl6ZWRFbW9qaVNldCA9IGVtb2ppU2V0O1xuICB9XG5cbiAgaWYgKGhpZGVTY3JvbGxUb0VuZEJ1dHRvbikge1xuICAgIGhpZGVTY3JvbGxUb0VuZEJ1dHRvbkRlcHJlY2F0aW9uKCk7XG5cbiAgICAvLyBPbmx5IHNldCBpZiB0aGUgXCJzY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yXCIgaXMgbm90IHNldC5cbiAgICAvLyBJZiBpdCBoYXMgYmVlbiBzZXQsIHRoZSBkZXZlbG9wZXIgc2hvdWxkIGtub3cgdGhlIG9sZGVyIFwiaGlkZVNjcm9sbFRvRW5kQnV0dG9uXCIgb3B0aW9uIGlzIGRlcHJlY2F0ZWQuXG4gICAgZmlsbGVkT3B0aW9ucy5zY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yID0gb3B0aW9ucy5zY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yIHx8IGZhbHNlO1xuICB9XG5cbiAgbGV0IHBhdGNoZWRTY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yID0gZmlsbGVkT3B0aW9ucy5zY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yO1xuXG4gIGlmIChwYXRjaGVkU2Nyb2xsVG9FbmRCdXR0b25CZWhhdmlvciAhPT0gJ2FueScgJiYgcGF0Y2hlZFNjcm9sbFRvRW5kQnV0dG9uQmVoYXZpb3IgIT09IGZhbHNlKSB7XG4gICAgcGF0Y2hlZFNjcm9sbFRvRW5kQnV0dG9uQmVoYXZpb3IgPT09ICd1bnJlYWQnIHx8XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdXZWIgQ2hhdDogXCJzY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yXCIgbXVzdCBiZSBlaXRoZXIgXCJ1bnJlYWRcIiwgXCJhbnlcIiwgb3IgZmFsc2UsIHdpbGwgc2V0IHRvIFwidW5yZWFkXCIuJ1xuICAgICAgKTtcblxuICAgIHBhdGNoZWRTY3JvbGxUb0VuZEJ1dHRvbkJlaGF2aW9yID0gJ3VucmVhZCc7XG4gIH1cblxuICBpZiAobmV3TWVzc2FnZXNCdXR0b25Gb250U2l6ZSkge1xuICAgIG5ld01lc3NhZ2VzQnV0dG9uRm9udFNpemVEZXByZWNhdGlvbigpO1xuXG4gICAgLy8gT25seSBzZXQgaWYgdGhlIFwic2Nyb2xsVG9FbmRCdXR0b25Gb250U2l6ZVwiIGlzIG5vdCBzZXQuXG4gICAgZmlsbGVkT3B0aW9ucy5zY3JvbGxUb0VuZEJ1dHRvbkZvbnRTaXplID0gb3B0aW9ucy5zY3JvbGxUb0VuZEJ1dHRvbkZvbnRTaXplIHx8IG5ld01lc3NhZ2VzQnV0dG9uRm9udFNpemU7XG4gIH1cblxuICBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkJhY2tncm91bmQgJiYgc3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZERlcHJlY2F0aW9uKCk7XG5cbiAgaWYgKG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQWN0aXZlQmFja2dyb3VuZCkge1xuICAgIHN1Z2dlc3RlZEFjdGlvblhYWEJhY2tncm91bmREZXByZWNhdGlvbigpO1xuXG4gICAgZmlsbGVkT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kQ29sb3JPbkFjdGl2ZSA9XG4gICAgICBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkJhY2tncm91bmRDb2xvck9uQWN0aXZlIHx8IG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQWN0aXZlQmFja2dyb3VuZDtcbiAgfVxuXG4gIGlmIChvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkZvY3VzQmFja2dyb3VuZCkge1xuICAgIHN1Z2dlc3RlZEFjdGlvblhYWEJhY2tncm91bmREZXByZWNhdGlvbigpO1xuXG4gICAgZmlsbGVkT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kQ29sb3JPbkZvY3VzID1cbiAgICAgIG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZENvbG9yT25Gb2N1cyB8fCBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkZvY3VzQmFja2dyb3VuZDtcbiAgfVxuXG4gIGlmIChvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkhvdmVyQmFja2dyb3VuZCkge1xuICAgIHN1Z2dlc3RlZEFjdGlvblhYWEJhY2tncm91bmREZXByZWNhdGlvbigpO1xuXG4gICAgZmlsbGVkT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kQ29sb3JPbkhvdmVyID1cbiAgICAgIG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZENvbG9yT25Ib3ZlciB8fCBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkhvdmVyQmFja2dyb3VuZDtcbiAgfVxuXG4gIGlmIChvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkQmFja2dyb3VuZCkge1xuICAgIHN1Z2dlc3RlZEFjdGlvblhYWEJhY2tncm91bmREZXByZWNhdGlvbigpO1xuXG4gICAgZmlsbGVkT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25CYWNrZ3JvdW5kQ29sb3JPbkRpc2FibGVkID1cbiAgICAgIG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQmFja2dyb3VuZENvbG9yT25EaXNhYmxlZCB8fCBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkQmFja2dyb3VuZDtcbiAgfVxuXG4gIGlmIChvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkQm9yZGVyQ29sb3IpIHtcbiAgICBzdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZERlcHJlY2F0aW9uKCk7XG5cbiAgICBmaWxsZWRPcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkJvcmRlckNvbG9yT25EaXNhYmxlZCA9XG4gICAgICBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkJvcmRlckNvbG9yT25EaXNhYmxlZCB8fCBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkQm9yZGVyQ29sb3I7XG4gIH1cblxuICBpZiAob3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZEJvcmRlclN0eWxlKSB7XG4gICAgc3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWREZXByZWNhdGlvbigpO1xuXG4gICAgZmlsbGVkT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25Cb3JkZXJTdHlsZU9uRGlzYWJsZWQgPVxuICAgICAgb3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25Cb3JkZXJTdHlsZU9uRGlzYWJsZWQgfHwgb3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25EaXNhYmxlZEJvcmRlclN0eWxlO1xuICB9XG5cbiAgaWYgKG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWRCb3JkZXJXaWR0aCkge1xuICAgIHN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkRGVwcmVjYXRpb24oKTtcblxuICAgIGZpbGxlZE9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQm9yZGVyV2lkdGhPbkRpc2FibGVkID1cbiAgICAgIG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uQm9yZGVyV2lkdGhPbkRpc2FibGVkIHx8IG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWRCb3JkZXJXaWR0aDtcbiAgfVxuXG4gIGlmIChvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkVGV4dENvbG9yKSB7XG4gICAgc3VnZ2VzdGVkQWN0aW9uRGlzYWJsZWREZXByZWNhdGlvbigpO1xuXG4gICAgZmlsbGVkT3B0aW9ucy5zdWdnZXN0ZWRBY3Rpb25UZXh0Q29sb3JPbkRpc2FibGVkID1cbiAgICAgIG9wdGlvbnMuc3VnZ2VzdGVkQWN0aW9uVGV4dENvbG9yT25EaXNhYmxlZCB8fCBvcHRpb25zLnN1Z2dlc3RlZEFjdGlvbkRpc2FibGVkVGV4dENvbG9yO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5maWxsZWRPcHRpb25zLFxuICAgIGJ1YmJsZUZyb21Vc2VyTnViT2Zmc2V0OiBub3JtYWxpemVkQnViYmxlRnJvbVVzZXJOdWJPZmZzZXQsXG4gICAgYnViYmxlTnViT2Zmc2V0OiBub3JtYWxpemVkQnViYmxlTnViT2Zmc2V0LFxuICAgIGVtb2ppU2V0OiBub3JtYWxpemVkRW1vamlTZXQsXG4gICAgc2Nyb2xsVG9FbmRCdXR0b25CZWhhdmlvcjogcGF0Y2hlZFNjcm9sbFRvRW5kQnV0dG9uQmVoYXZpb3JcbiAgfTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOzs7Ozs7Ozs7Ozs7Ozs7O0FBR0EsSUFBTUEsZ0NBQWdDLEdBQUcsSUFBQUMsaUNBQUEsRUFDdkMsZ01BRHVDLENBQXpDO0FBSUEsSUFBTUMsb0NBQW9DLEdBQUcsSUFBQUQsaUNBQUEsRUFDM0MsMktBRDJDLENBQTdDO0FBSUEsSUFBTUUsb0NBQW9DLEdBQUcsSUFBQUYsaUNBQUEsRUFDM0Msb01BRDJDLENBQTdDO0FBSUEsSUFBTUcsdUNBQXVDLEdBQUcsSUFBQUgsaUNBQUEsRUFDOUMsNE1BRDhDLENBQWhEO0FBSUEsSUFBTUksa0NBQWtDLEdBQUcsSUFBQUosaUNBQUEsRUFDekMsK0tBRHlDLENBQTNDLEMsQ0FJQTtBQUNBO0FBQ0E7QUFFQTs7QUFDZSxTQUFTSyxxQkFBVCxH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