"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.removeAuthTokenProvider = exports.handleAuthentication = exports.getAuthClientFunction = void 0;
var _TelemetryConstants = require("../../../common/telemetry/TelemetryConstants");
var _TelemetryHelper = require("../../../common/telemetry/TelemetryHelper");
var _utils = require("../../../common/utils");
const getAuthClientFunction = chatConfig => {
  let authClientFunction = undefined;
  if (chatConfig !== null && chatConfig !== void 0 && chatConfig.LiveChatConfigAuthSettings) {
    var _chatConfig$LiveChatC;
    authClientFunction = (chatConfig === null || chatConfig === void 0 ? void 0 : (_chatConfig$LiveChatC = chatConfig.LiveChatConfigAuthSettings) === null || _chatConfig$LiveChatC === void 0 ? void 0 : _chatConfig$LiveChatC.msdyn_javascriptclientfunction) ?? undefined;
  }
  return authClientFunction;
};

// eslint-disable-next-line @typescript-eslint/no-explicit-any
exports.getAuthClientFunction = getAuthClientFunction;
const handleAuthentication = async (chatSDK, chatConfig, getAuthToken) => {
  const authClientFunction = getAuthClientFunction(chatConfig);
  if (getAuthToken && authClientFunction) {
    _TelemetryHelper.TelemetryHelper.logActionEvent(_TelemetryConstants.LogLevel.INFO, {
      Event: _TelemetryConstants.TelemetryEvent.GetAuthTokenCalled
    });
    const token = await getAuthToken(authClientFunction);
    if (!(0, _utils.isNullOrEmptyString)(token)) {
      // eslint-disable-next-line @typescript-eslint/no-explicit-any
      chatSDK.setAuthTokenProvider(async () => {
        return token;
      });
      return true;
    } else {
      _TelemetryHelper.TelemetryHelper.logActionEvent(_TelemetryConstants.LogLevel.ERROR, {
        Event: _TelemetryConstants.TelemetryEvent.ReceivedNullOrEmptyToken
      });
      return false;
    }
  }
  return false;
};

// eslint-disable-next-line @typescript-eslint/no-explicit-any
exports.handleAuthentication = handleAuthentication;
const removeAuthTokenProvider = chatSDK => {
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  chatSDK.authenticatedUserToken = null;
};
exports.removeAuthTokenProvider = removeAuthTokenProvider;