"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.BrowserInfo = exports.UNKNOWN_VERSION = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _Enums = require("../Common/Enums");

// Ported from https://dev.azure.com/dynamicscrm/OneCRM/_git/CRM.OmniChannel.LiveChatWidget?path=/src/LiveChatLoader/Utility/BrowserInfo.ts
var REGEX_VERSION = "([\\d,.]+)";
var UNKNOWN_VERSION = "U";
exports.UNKNOWN_VERSION = UNKNOWN_VERSION;

var BrowserInfo = /*#__PURE__*/function () {
  function BrowserInfo() {
    (0, _classCallCheck2["default"])(this, BrowserInfo);
  }

  (0, _createClass2["default"])(BrowserInfo, null, [{
    key: "getUserAgent",
    value: function getUserAgent() {
      return this.userAgent();
    }
  }, {
    key: "userAgentContainsString",
    value: function userAgentContainsString(searchString) {
      return this.getUserAgent().indexOf(searchString) > -1;
    }
  }, {
    key: "isChrome",
    value: function isChrome() {
      return this.userAgentContainsString(_Enums.BrowserVendor.CHROME) && !this.userAgentContainsString(_Enums.BrowserVendor.EDGE) && !this.userAgentContainsString(_Enums.BrowserVendor.EDGE_CHROMIUM);
    }
  }, {
    key: "isIe",
    value: function isIe() {
      return this.userAgentContainsString("Trident");
    }
  }, {
    key: "isEdge",
    value: function isEdge() {
      return this.userAgentContainsString(_Enums.BrowserVendor.EDGE) || this.userAgentContainsString(_Enums.BrowserVendor.EDGE_CHROMIUM);
    }
  }, {
    key: "isOpera",
    value: function isOpera() {
      return this.userAgentContainsString("OPR/");
    }
  }, {
    key: "getBrowserName",
    value: function getBrowserName() {
      if (this.isOpera()) {
        return _Enums.BrowserVendor.OPERA;
      }

      if (this.isEdge()) {
        return _Enums.BrowserVendor.EDGE;
      }

      if (this.isChrome()) {
        return _Enums.BrowserVendor.CHROME;
      }

      if (this.userAgentContainsString(_Enums.BrowserVendor.FIREFOX)) {
        return _Enums.BrowserVendor.FIREFOX;
      }

      if (this.userAgentContainsString(_Enums.BrowserVendor.SAFARI)) {
        return _Enums.BrowserVendor.SAFARI;
      }

      if (this.isIe()) {
        return _Enums.BrowserVendor.IE;
      }

      return _Enums.BrowserVendor.UNKNOWN;
    }
  }, {
    key: "getBrowserVersion",
    value: function getBrowserVersion() {
      var _this = this;

      var getIeVersion = function getIeVersion() {
        var userAgent = _this.getUserAgent();

        var classicIeVersionMatches = userAgent.match(new RegExp(_Enums.BrowserVendor.IE + " " + REGEX_VERSION)); // eslint-disable-line security/detect-non-literal-regexp

        if (classicIeVersionMatches) {
          return classicIeVersionMatches[1];
        }

        var ieVersionMatches = userAgent.match(new RegExp("rv:" + REGEX_VERSION)); // eslint-disable-line security/detect-non-literal-regexp

        if (ieVersionMatches) {
          return ieVersionMatches[1];
        }

        return undefined;
      };

      var getOtherVersion = function getOtherVersion(browserString) {
        if (browserString === _Enums.BrowserVendor.SAFARI) {
          browserString = "Version";
        }

        if (browserString === _Enums.BrowserVendor.OPERA) {
          browserString = "OPR";
        }

        if (browserString === _Enums.BrowserVendor.EDGE) {
          browserString = "Edge?";
        }

        var matches = _this.getUserAgent().match(new RegExp(browserString + "/" + REGEX_VERSION)); // eslint-disable-line security/detect-non-literal-regexp


        if (matches) {
          return matches[1];
        }

        return UNKNOWN_VERSION;
      };

      if (this.isIe()) {
        return getIeVersion();
      }

      return getOtherVersion(this.getBrowserName());
    }
  }]);
  return BrowserInfo;
}();

exports.BrowserInfo = BrowserInfo;
(0, _defineProperty2["default"])(BrowserInfo, "userAgent", function () {
  return window.navigator.userAgent;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9VdGlscy9Ccm93c2VySW5mby50cyJdLCJuYW1lcyI6WyJSRUdFWF9WRVJTSU9OIiwiVU5LTk9XTl9WRVJTSU9OIiwiQnJvd3NlckluZm8iLCJ1c2VyQWdlbnQiLCJzZWFyY2hTdHJpbmciLCJnZXRVc2VyQWdlbnQiLCJpbmRleE9mIiwidXNlckFnZW50Q29udGFpbnNTdHJpbmciLCJCcm93c2VyVmVuZG9yIiwiQ0hST01FIiwiRURHRSIsIkVER0VfQ0hST01JVU0iLCJpc09wZXJhIiwiT1BFUkEiLCJpc0VkZ2UiLCJpc0Nocm9tZSIsIkZJUkVGT1giLCJTQUZBUkkiLCJpc0llIiwiSUUiLCJVTktOT1dOIiwiZ2V0SWVWZXJzaW9uIiwiY2xhc3NpY0llVmVyc2lvbk1hdGNoZXMiLCJtYXRjaCIsIlJlZ0V4cCIsImllVmVyc2lvbk1hdGNoZXMiLCJ1bmRlZmluZWQiLCJnZXRPdGhlclZlcnNpb24iLCJicm93c2VyU3RyaW5nIiwibWF0Y2hlcyIsImdldEJyb3dzZXJOYW1lIiwid2luZG93IiwibmF2aWdhdG9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFFQTtBQUVBLElBQU1BLGFBQWEsR0FBRyxZQUF0QjtBQUVPLElBQU1DLGVBQWUsR0FBRyxHQUF4Qjs7O0lBRU1DLFc7Ozs7Ozs7V0FJWCx3QkFBc0M7QUFDcEMsYUFBTyxLQUFLQyxTQUFMLEVBQVA7QUFDRDs7O1dBQ0QsaUNBQXVDQyxZQUF2QyxFQUFzRTtBQUNwRSxhQUFPLEtBQUtDLFlBQUwsR0FBb0JDLE9BQXBCLENBQTRCRixZQUE1QixJQUE0QyxDQUFDLENBQXBEO0FBQ0Q7OztXQUVELG9CQUFrQztBQUNoQyxhQUFPLEtBQUtHLHVCQUFMLENBQTZCQyxxQkFBY0MsTUFBM0MsS0FDTCxDQUFDLEtBQUtGLHVCQUFMLENBQTZCQyxxQkFBY0UsSUFBM0MsQ0FESSxJQUVMLENBQUMsS0FBS0gsdUJBQUwsQ0FBNkJDLHFCQUFjRyxhQUEzQyxDQUZIO0FBR0Q7OztX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O2lDQXRHVTVCLFcsZUFFOEI7QUFBQSxTQUFNNkIsTUFBTSxDQUFDQyxTQUFQLENBQWlCN0IsU0FBdkI7QUFBQSxDIiwic291cmNlUm9vdCI6Im9jc2RrOi8vLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJyb3dzZXJWZW5kb3IgfSBmcm9tIFwiLi4vQ29tbW9uL0VudW1zXCI7XG5cbi8vIFBvcnRlZCBmcm9tIGh0dHBzOi8vZGV2LmF6dXJlLmNvbS9keW5hbWljc2NybS9PbmVDUk0vX2dpdC9DUk0uT21uaUNoYW5uZWwuTGl2ZUNoYXRXaWRnZXQ/cGF0aD0vc3JjL0xpdmVDaGF0TG9hZGVyL1V0aWxpdHkvQnJvd3NlckluZm8udHNcblxuY29uc3QgUkVHRVhfVkVSU0lPTiA9IFwiKFtcXFxcZCwuXSspXCI7XG5cbmV4cG9ydCBjb25zdCBVTktOT1dOX1ZFUlNJT04gPSBcIlVcIjtcblxuZXhwb3J0IGNsYXNzIEJyb3dzZXJJbmZvIHtcblxuICBwcml2YXRlIHN0YXRpYyB1c2VyQWdlbnQ6ICgpID0+IHN0cmluZyA9ICgpID0+IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50O1xuXG4gIHByaXZhdGUgc3RhdGljIGdldFVzZXJBZ2VudCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnVzZXJBZ2VudCgpO1xuICB9XG4gIHByaXZhdGUgc3RhdGljIHVzZXJBZ2VudENvbnRhaW5zU3RyaW5nKHNlYXJjaFN0cmluZzogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0VXNlckFnZW50KCkuaW5kZXhPZihzZWFyY2hTdHJpbmcpID4gLTE7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGlzQ2hyb21lKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnVzZXJBZ2VudENvbnRhaW5zU3RyaW5nKEJyb3dzZXJWZW5kb3IuQ0hST01FKSAmJlxuICAgICAgIXRoaXMudXNlckFnZW50Q29udGFpbnNTdHJpbmcoQnJvd3NlclZlbmRvci5FREdFKSAmJlxuICAgICAgIXRoaXMudXNlckFnZW50Q29udGFpbnNTdHJpbmcoQnJvd3NlclZlbmRvci5FREdFX0NIUk9NSVVNKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgaXNJZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy51c2VyQWdlbnRDb250YWluc1N0cmluZyhcIlRyaWRlbnRcIik7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGlzRWRnZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy51c2VyQWdlbnRDb250YWluc1N0cmluZyhCcm93c2VyVmVuZG9yLkVER0UpIHx8XG4gICAgICB0aGlzLnVzZXJBZ2VudENvbnRhaW5zU3RyaW5nKEJyb3dzZXJWZW5kb3IuRURHRV9DSFJPTUlVTSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGlzT3BlcmEoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudXNlckFnZW50Q29udGFpbnNTdHJpbmcoXCJPUFIvXCIpO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBnZXRCcm93c2VyTmFtZSgpOiBCcm93c2VyVmVuZG9yIHtcbiAgICBpZiAodGhpcy5pc09wZXJhKCkpIHtcbiAgICAgIHJldHVybiBCcm93c2VyVmVuZG9yLk9QRVJBO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzRWRnZSgpKSB7XG4gICAgICByZXR1cm4gQnJvd3NlclZlbmRvci5FREdFO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzQ2hyb21lKCkpIHtcbiAgICAgIHJldHVybiBCcm93c2VyVmVuZG9yLkNIUk9NRTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy51c2VyQWdlbnRDb250YWluc1N0cmluZyhCcm93c2VyVmVuZG9yLkZJUkVGT1gpKSB7XG4gICAgICByZXR1cm4gQnJvd3NlclZlbmRvci5GSVJFRk9YO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnVzZXJBZ2VudENvbnRhaW5zU3RyaW5nKEJyb3dzZXJWZW5kb3IuU0FGQVJJKSkge1xuICAgICAgcmV0dXJuIEJyb3dzZXJWZW5kb3IuU0FGQVJJO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzSWUoKSkge1xuICAgICAgcmV0dXJuIEJyb3dzZXJWZW5kb3IuSUU7XG4gICAgfVxuXG4gICAgcmV0dXJuIEJyb3dzZXJWZW5kb3IuVU5LTk9XTjtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0QnJvd3NlclZlcnNpb24oKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBnZXRJZVZlcnNpb24gPSAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VyQWdlbnQgPSB0aGlzLmdldFVzZXJBZ2VudCgpO1xuICAgICAgY29uc3QgY2xhc3NpY0llVmVyc2lvbk1hdGNoZXMgPSB1c2VyQWdlbnQubWF0Y2gobmV3IFJlZ0V4cChCcm93c2VyVmVuZG9yLklFICsgXCIgXCIgKyBSRUdFWF9WRVJTSU9OKSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgc2VjdXJpdHkvZGV0ZWN0LW5vbi1saXRlcmFsLXJlZ2V4cFxuXG4gICAgICBpZiAoY2xhc3NpY0llVmVyc2lvbk1hdGNoZXMpIHtcbiAgICAgICAgcmV0dXJuIGNsYXNzaWNJZVZlcnNpb25NYXRjaGVzWzFdO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBpZVZlcnNpb25NYXRjaGVzOiBSZWdFeHBNYXRjaEFycmF5IHwgbnVsbCA9IHVzZXJBZ2VudC5tYXRjaChuZXcgUmVnRXhwKFwicnY6XCIgKyBSRUdFWF9WRVJTSU9OKSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgc2VjdXJpdHkvZGV0ZWN0LW5vbi1saXRlcmFsLXJlZ2V4cFxuICAgICAgaWYgKGllVmVyc2lvbk1hdGNoZXMpIHtcbiAgICAgICAgcmV0dXJuIGllVmVyc2lvbk1hdGNoZXNbMV07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfTtcblxuICAgIGNvbnN0IGdldE90aGVyVmVyc2lvbiA9IChicm93c2VyU3RyaW5nOiBzdHJpbmcpID0+IHtcbiAgICAgIGlmIChicm93c2VyU3RyaW5nID09PSBCcm93c2VyVmVuZG9yLlNBRkFSSSkge1xuICAgICAgICBicm93c2VyU3RyaW5nID0gXCJWZXJzaW9uXCI7XG4gICAgICB9XG5cbiAgICAgIGlmIChicm93c2VyU3RyaW5nID09PSBCcm93c2VyVmVuZG9yLk9QRVJBKSB7XG4gICAgICAgIGJyb3dzZXJTdHJpbmcgPSBcIk9QUlwiO1xuICAgICAgfVxuXG4gICAgICBpZiAoYnJvd3NlclN0cmluZyA9PT0gQnJvd3NlclZlbmRvci5FREdFKSB7XG4gICAgICAgIGJyb3dzZXJTdHJpbmcgPSBcIkVkZ2U/XCI7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1hdGNoZXM6IFJlZ0V4cE1hdGNoQXJyYXkgfCBudWxsID0gdGhpcy5nZXRVc2VyQWdlbnQoKS5tYXRjaChuZXcgUmVnRXhwKGJyb3dzZXJTdHJpbmcgKyBcIi9cIiArIFJFR0VYX1ZFUlNJT04pKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBzZWN1cml0eS9kZXRlY3Qtbm9uLWxpdGVyYWwtcmVnZXhwXG5cbiAgICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVzWzFdO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gVU5LTk9XTl9WRVJTSU9OO1xuICAgIH07XG5cbiAgICBpZiAodGhpcy5pc0llKCkpIHtcbiAgICAgIHJldHVybiBnZXRJZVZlcnNpb24oKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ2V0T3RoZXJWZXJzaW9uKHRoaXMuZ2V0QnJvd3Nlck5hbWUoKSk7XG4gIH1cbn1cbiJdfQ==