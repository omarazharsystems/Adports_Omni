"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = create;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _microsoftCognitiveservicesSpeechSdk = require("microsoft-cognitiveservices-speech-sdk");

var _createWebSpeechPonyfillFactory = _interopRequireDefault(require("./createWebSpeechPonyfillFactory"));

var _DirectLineSpeech = _interopRequireDefault(require("./DirectLineSpeech"));

var _patchDialogServiceConnectorInline = _interopRequireDefault(require("./patchDialogServiceConnectorInline"));

var _refreshDirectLineToken = _interopRequireDefault(require("./utils/refreshDirectLineToken"));

var _resolveFunctionOrReturnValue = _interopRequireDefault(require("./resolveFunctionOrReturnValue"));

/* eslint complexity: ["error", 33] */
var DIRECT_LINE_TOKEN_RENEWAL_INTERVAL = 900000; // 15 minutes

var TOKEN_RENEWAL_INTERVAL = 120000; // eslint-disable-next-line complexity

function create(_x) {
  return _create.apply(this, arguments);
}

function _create() {
  _create = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3(_ref) {
    var audioConfig, audioContext, audioInputDeviceId, enableInternalHTTPSupport, enableTelemetry, fetchCredentials, speechRecognitionEndpointId, _ref$speechRecognitio, speechRecognitionLanguage, speechSynthesisDeploymentId, speechSynthesisOutputFormat, textNormalization, userID, username, _yield$resolveFunctio, authorizationToken, directLineToken, directLineSpeechHostname, region, subscriptionKey, config, dialogServiceConnector, interval, _interval, directLine, webSpeechPonyfillFactory;

    return _regenerator.default.wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            audioConfig = _ref.audioConfig, audioContext = _ref.audioContext, audioInputDeviceId = _ref.audioInputDeviceId, enableInternalHTTPSupport = _ref.enableInternalHTTPSupport, enableTelemetry = _ref.enableTelemetry, fetchCredentials = _ref.fetchCredentials, speechRecognitionEndpointId = _ref.speechRecognitionEndpointId, _ref$speechRecognitio = _ref.speechRecognitionLanguage, speechRecognitionLanguage = _ref$speechRecognitio === void 0 ? typeof window !== 'undefined' && typeof window.navigator !== 'undefined' && window.navigator.language || 'en-US' : _ref$speechRecognitio, speechSynthesisDeploymentId = _ref.speechSynthesisDeploymentId, speechSynthesisOutputFormat = _ref.speechSynthesisOutputFormat, textNormalization = _ref.textNormalization, userID = _ref.userID, username = _ref.username;

            if (fetchCredentials) {
              _context3.next = 3;
              break;
            }

            throw new Error('"fetchCredentials" must be specified.');

          case 3:
            _context3.next = 5;
            return (0, _resolveFunctionOrReturnValue.default)(fetchCredentials);

          case 5:
            _yield$resolveFunctio = _context3.sent;
            authorizationToken = _yield$resolveFunctio.authorizationToken;
            directLineToken = _yield$resolveFunctio.directLineToken;
            directLineSpeechHostname = _yield$resolveFunctio.directLineSpeechHostname;
            region = _yield$resolveFunctio.region;
            subscriptionKey = _yield$resolveFunctio.subscriptionKey;

            if (!(!authorizationToken && !subscriptionKey || authorizationToken && subscriptionKey || authorizationToken && typeof authorizationToken !== 'string' || subscriptionKey && typeof subscriptionKey !== 'string' || enableInternalHTTPSupport && !directLineToken)) {
              _context3.next = 13;
              break;
            }

            throw new Error('"fetchCredentials" must return either "authorizationToken" or "subscriptionKey" as a non-empty string only. If enableInternalHTTPSupport is set to true, then it should also return a non-empty "directLineToken"');

          case 13:
            if (typeof enableTelemetry !== 'undefined') {
              console.warn('botframework-directlinespeech: Telemetry options are not yet supported. Please refer to Cognitive Services documentation for details.');
            }

            if (!(directLineSpeechHostname && region || !directLineSpeechHostname && !region)) {
              _context3.next = 16;
              break;
            }

            throw new Error('"fetchCredentials" must return either "directLineSpeechHostname" or "region" and it must not be an empty string.');

          case 16:
            if (!directLineSpeechHostname) {
              _context3.next = 23;
              break;
            }

            if (!(typeof directLineSpeechHostname !== 'string')) {
              _context3.next = 19;
              break;
            }

            throw new Error('"fetchCredentials" must return "directLineSpeechHostname" as a string.');

          case 19:
            if (!enableInternalHTTPSupport) {
              _context3.next = 21;
              break;
            }

            throw new Error('"fetchCredentials" must not return "directLineSpeechHostname" if "enableInternalHTTPSupport" is set.');

          case 21:
            _context3.next = 25;
            break;

          case 23:
            if (!(typeof region !== 'string')) {
              _context3.next = 25;
              break;
            }

            throw new Error('"fetchCredentials" must return "region" as a string.');

          case 25:
            if (audioConfig && audioInputDeviceId) {
              console.warn('botframework-directlinespeech-sdk: Only "audioConfig" or "audioInputDeviceId" can be specified, but not both; ignoring "audioInputDeviceId".');
            } else if (!audioConfig) {
              if (audioInputDeviceId) {
                audioConfig = _microsoftCognitiveservicesSpeechSdk.AudioConfig.fromMicrophoneInput(audioInputDeviceId);
              } else {
                audioConfig = _microsoftCognitiveservicesSpeechSdk.AudioConfig.fromDefaultMicrophoneInput();
              }
            }

            if (speechRecognitionEndpointId) {
              console.warn('botframework-directlinespeech: Custom Speech is currently not supported; ignoring "speechRecognitionEndpointId".');
            }

            if (speechSynthesisDeploymentId) {
              console.warn('botframework-directlinespeech: Custom Voice is currently not supported; ignoring "speechSynthesisDeploymentId".');
            }

            if (speechSynthesisOutputFormat) {
              console.warn('botframework-directlinespeech: Synthesis output format is currently not supported; ignoring "speechSynthesisOutputFormat".');
            }

            if (textNormalization) {
              console.warn('botframework-directlinespeech: Text normalization is currently not supported; ignoring "textNormalization".');
            }

            if (userID || username) {
              console.warn('botframework-directlinespeech: Custom "userId" and "username" are currently not supported and are ignored.');
            }

            if (directLineSpeechHostname) {
              if (authorizationToken) {
                config = _microsoftCognitiveservicesSpeechSdk.BotFrameworkConfig.fromHost(new URL("wss://".concat(directLineSpeechHostname)));
                config.setProperty(_microsoftCognitiveservicesSpeechSdk.PropertyId.SpeechServiceAuthorization_Token, authorizationToken);
              } else {
                config = _microsoftCognitiveservicesSpeechSdk.BotFrameworkConfig.fromHost(new URL("wss://".concat(directLineSpeechHostname)), subscriptionKey);
              }
            } else {
              if (authorizationToken) {
                config = _microsoftCognitiveservicesSpeechSdk.BotFrameworkConfig.fromAuthorizationToken(authorizationToken, region);
              } else {
                config = _microsoftCognitiveservicesSpeechSdk.BotFrameworkConfig.fromSubscription(subscriptionKey, region);
              } // If internal HTTP support is enabled, switch the endpoint to Direct Line on Direct Line Speech service.


              if (enableInternalHTTPSupport) {
                config.setProperty(_microsoftCognitiveservicesSpeechSdk.PropertyId.SpeechServiceConnection_Endpoint, "wss://".concat(encodeURI(region), ".convai.speech.microsoft.com/directline/api/v1"));
                config.setProperty(_microsoftCognitiveservicesSpeechSdk.PropertyId.Conversation_Agent_Connection_Id, directLineToken);
              }
            } // Supported options can be found in DialogConnectorFactory.js.
            // Set the language used for recognition.


            config.setProperty(_microsoftCognitiveservicesSpeechSdk.PropertyId.SpeechServiceConnection_RecoLanguage, speechRecognitionLanguage); // The following code sets the output format.
            // As advised by the Speech team, this API may be subject to future changes.
            // We are not enabling output format option because it does not send detailed output format to the bot, rendering this option useless.
            // config.setProperty(PropertyId.SpeechServiceResponse_OutputFormatOption, OutputFormat[OutputFormat.Detailed]);
            // Set the user ID for starting the conversation.

            userID && config.setProperty(_microsoftCognitiveservicesSpeechSdk.PropertyId.Conversation_From_Id, userID); // Set Custom Speech and Custom Voice.
            // The following code is copied from C#, and it is not working yet.
            // https://github.com/Azure-Samples/Cognitive-Services-Direct-Line-Speech-Client/blob/master/DLSpeechClient/MainWindow.xaml.cs
            // speechRecognitionEndpointId && config.setServiceProperty('cid', speechRecognitionEndpointId, ServicePropertyChannel.UriQueryParameter);
            // speechSynthesisDeploymentId && config.setProperty(PropertyId.conversation_Custom_Voice_Deployment_Ids, speechSynthesisDeploymentId);

            dialogServiceConnector = (0, _patchDialogServiceConnectorInline.default)(new _microsoftCognitiveservicesSpeechSdk.DialogServiceConnector(config, audioConfig)); // Renew token per interval.

            if (authorizationToken) {
              interval = setInterval( /*#__PURE__*/(0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {
                var _yield$resolveFunctio2, authorizationToken, nextDirectLineSpeechHostname, nextRegion;

                return _regenerator.default.wrap(function _callee$(_context) {
                  while (1) {
                    switch (_context.prev = _context.next) {
                      case 0:
                        // #2660 If the connector has been disposed, we should stop renewing the token.
                        // TODO: We should use a public implementation if Speech SDK has one related to "privIsDisposed".
                        if (dialogServiceConnector.privIsDisposed) {
                          clearInterval(interval);
                        }

                        _context.next = 3;
                        return (0, _resolveFunctionOrReturnValue.default)(fetchCredentials);

                      case 3:
                        _yield$resolveFunctio2 = _context.sent;
                        authorizationToken = _yield$resolveFunctio2.authorizationToken;
                        nextDirectLineSpeechHostname = _yield$resolveFunctio2.directLineSpeechHostname;
                        nextRegion = _yield$resolveFunctio2.region;

                        if (authorizationToken) {
                          _context.next = 9;
                          break;
                        }

                        return _context.abrupt("return", console.warn('botframework-directlinespeech-sdk: Renew token failed because "fetchCredentials" call returned no authorization token.'));

                      case 9:
                        if (!directLineSpeechHostname) {
                          _context.next = 14;
                          break;
                        }

                        if (!(directLineSpeechHostname !== nextDirectLineSpeechHostname)) {
                          _context.next = 12;
                          break;
                        }

                        return _context.abrupt("return", console.warn('botframework-directlinespeech-sdk: "directLineSpeechHostname" change is not supported for renewed token. Authorization token is not renewed.'));

                      case 12:
                        _context.next = 16;
                        break;

                      case 14:
                        if (!(region !== nextRegion)) {
                          _context.next = 16;
                          break;
                        }

                        return _context.abrupt("return", console.warn('botframework-directlinespeech-sdk: Region change is not supported for renewed token. Authorization token is not renewed.'));

                      case 16:
                        dialogServiceConnector.authorizationToken = authorizationToken; // eslint-disable-line require-atomic-updates

                      case 17:
                      case "end":
                        return _context.stop();
                    }
                  }
                }, _callee);
              })), TOKEN_RENEWAL_INTERVAL);
            } // Renew token per interval.


            if (enableInternalHTTPSupport) {
              _interval = setInterval( /*#__PURE__*/(0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2() {
                var refreshedDirectLineToken;
                return _regenerator.default.wrap(function _callee2$(_context2) {
                  while (1) {
                    switch (_context2.prev = _context2.next) {
                      case 0:
                        // #2660 If the connector has been disposed, we should stop renewing the token.
                        // TODO: We should use a public implementation if Speech SDK has one related to "privIsDisposed".
                        if (dialogServiceConnector.privIsDisposed) {
                          clearInterval(_interval);
                        }

                        _context2.next = 3;
                        return (0, _refreshDirectLineToken.default)(directLineToken);

                      case 3:
                        refreshedDirectLineToken = _context2.sent;

                        if (refreshedDirectLineToken) {
                          _context2.next = 6;
                          break;
                        }

                        return _context2.abrupt("return", console.warn('botframework-directlinespeech-sdk: Renew token failed because call to refresh token Direct Line API did not return a new token.'));

                      case 6:
                        config.setProperty(_microsoftCognitiveservicesSpeechSdk.PropertyId.Conversation_Agent_Connection_Id, refreshedDirectLineToken);
                        dialogServiceConnector.properties.setProperty(_microsoftCognitiveservicesSpeechSdk.PropertyId.Conversation_Agent_Connection_Id, refreshedDirectLineToken);
                        dialogServiceConnector.connect();

                      case 9:
                      case "end":
                        return _context2.stop();
                    }
                  }
                }, _callee2);
              })), DIRECT_LINE_TOKEN_RENEWAL_INTERVAL);
            }

            directLine = new _DirectLineSpeech.default({
              dialogServiceConnector: dialogServiceConnector
            });
            webSpeechPonyfillFactory = (0, _createWebSpeechPonyfillFactory.default)({
              audioContext: audioContext,
              enableTelemetry: enableTelemetry,
              recognizer: dialogServiceConnector,
              textNormalization: textNormalization
            });
            return _context3.abrupt("return", {
              directLine: directLine,
              webSpeechPonyfillFactory: webSpeechPonyfillFactory
            });

          case 40:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3);
  }));
  return _create.apply(this, arguments);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJESVJFQ1RfTElORV9UT0tFTl9SRU5FV0FMX0lOVEVSVkFMIiwiVE9LRU5fUkVORVdBTF9JTlRFUlZBTCIsImNyZWF0ZSIsImF1ZGlvQ29uZmlnIiwiYXVkaW9Db250ZXh0IiwiYXVkaW9JbnB1dERldmljZUlkIiwiZW5hYmxlSW50ZXJuYWxIVFRQU3VwcG9ydCIsImVuYWJsZVRlbGVtZXRyeSIsImZldGNoQ3JlZGVudGlhbHMiLCJzcGVlY2hSZWNvZ25pdGlvbkVuZHBvaW50SWQiLCJzcGVlY2hSZWNvZ25pdGlvbkxhbmd1YWdlIiwid2luZG93IiwibmF2aWdhdG9yIiwibGFuZ3VhZ2UiLCJzcGVlY2hTeW50aGVzaXNEZXBsb3ltZW50SWQiLCJzcGVlY2hTeW50aGVzaXNPdXRwdXRGb3JtYXQiLCJ0ZXh0Tm9ybWFsaXphdGlvbiIsInVzZXJJRCIsInVzZXJuYW1lIiwiRXJyb3IiLCJyZXNvbHZlRnVuY3Rpb25PclJldHVyblZhbHVlIiwiYXV0aG9yaXphdGlvblRva2VuIiwiZGlyZWN0TGluZVRva2VuIiwiZGlyZWN0TGluZVNwZWVjaEhvc3RuYW1lIiwicmVnaW9uIiwic3Vic2NyaXB0aW9uS2V5IiwiY29uc29sZSIsIndhcm4iLCJBdWRpb0NvbmZpZyIsImZyb21NaWNyb3Bob25lSW5wdXQiLCJmcm9tRGVmYXVsdE1pY3JvcGhvbmVJbnB1dCIsImNvbmZpZyIsIkJvdEZyYW1ld29ya0NvbmZpZyIsImZyb21Ib3N0IiwiVVJMIiwic2V0UHJvcGVydHkiLCJQcm9wZXJ0eUlkIiwiU3BlZWNoU2VydmljZUF1dGhvcml6YXRpb25fVG9rZW4iLCJmcm9tQXV0aG9yaXphdGlvblRva2VuIiwiZnJvbVN1YnNjcmlwdGlvbiIsIlNwZWVjaFNlcnZpY2VDb25uZWN0aW9uX0VuZHBvaW50IiwiZW5jb2RlVVJJIiwiQ29udmVyc2F0aW9uX0FnZW50X0Nvbm5lY3Rpb25fSWQiLCJTcGVlY2hTZXJ2aWNlQ29ubmVjdGlvbl9SZWNvTGFuZ3VhZ2UiLCJDb252ZXJzYXRpb25fRnJvbV9JZCIsImRpYWxvZ1NlcnZpY2VDb25uZWN0b3IiLCJwYXRjaERpYWxvZ1NlcnZpY2VDb25uZWN0b3JJbmxpbmUiLCJEaWFsb2dTZXJ2aWNlQ29ubmVjdG9yIiwiaW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsInByaXZJc0Rpc3Bvc2VkIiwiY2xlYXJJbnRlcnZhbCIsIm5leHREaXJlY3RMaW5lU3BlZWNoSG9zdG5hbWUiLCJuZXh0UmVnaW9uIiwicmVmcmVzaERpcmVjdExpbmVUb2tlbiIsInJlZnJlc2hlZERpcmVjdExpbmVUb2tlbiIsInByb3BlcnRpZXMiLCJjb25uZWN0IiwiZGlyZWN0TGluZSIsIkRpcmVjdExpbmVTcGVlY2giLCJ3ZWJTcGVlY2hQb255ZmlsbEZhY3RvcnkiLCJjcmVhdGVXZWJTcGVlY2hQb255ZmlsbEZhY3RvcnkiLCJyZWNvZ25pemVyIl0sInNvdXJjZVJvb3QiOiJkaXJlY3RsaW5lc3BlZWNoOi8vLyIsInNvdXJjZXMiOlsiLi4vc3JjL2NyZWF0ZUFkYXB0ZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludCBjb21wbGV4aXR5OiBbXCJlcnJvclwiLCAzM10gKi9cblxuaW1wb3J0IHtcbiAgQXVkaW9Db25maWcsXG4gIEJvdEZyYW1ld29ya0NvbmZpZyxcbiAgRGlhbG9nU2VydmljZUNvbm5lY3RvcixcbiAgUHJvcGVydHlJZFxufSBmcm9tICdtaWNyb3NvZnQtY29nbml0aXZlc2VydmljZXMtc3BlZWNoLXNkayc7XG5cbmltcG9ydCBjcmVhdGVXZWJTcGVlY2hQb255ZmlsbEZhY3RvcnkgZnJvbSAnLi9jcmVhdGVXZWJTcGVlY2hQb255ZmlsbEZhY3RvcnknO1xuaW1wb3J0IERpcmVjdExpbmVTcGVlY2ggZnJvbSAnLi9EaXJlY3RMaW5lU3BlZWNoJztcbmltcG9ydCBwYXRjaERpYWxvZ1NlcnZpY2VDb25uZWN0b3JJbmxpbmUgZnJvbSAnLi9wYXRjaERpYWxvZ1NlcnZpY2VDb25uZWN0b3JJbmxpbmUnO1xuaW1wb3J0IHJlZnJlc2hEaXJlY3RMaW5lVG9rZW4gZnJvbSAnLi91dGlscy9yZWZyZXNoRGlyZWN0TGluZVRva2VuJztcbmltcG9ydCByZXNvbHZlRnVuY3Rpb25PclJldHVyblZhbHVlIGZyb20gJy4vcmVzb2x2ZUZ1bmN0aW9uT3JSZXR1cm5WYWx1ZSc7XG5cbmNvbnN0IERJUkVDVF9MSU5FX1RPS0VOX1JFTkVXQUxfSU5URVJWQUwgPSA5MDAwMDA7IC8vIDE1IG1pbnV0ZXNcbmNvbnN0IFRPS0VOX1JFTkVXQUxfSU5URVJWQUwgPSAxMjAwMDA7XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wbGV4aXR5XG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBjcmVhdGUoe1xuICBhdWRpb0NvbmZpZyxcbiAgYXVkaW9Db250ZXh0LFxuICBhdWRpb0lucHV0RGV2aWNlSWQsXG4gIGVuYWJsZUludGVybmFsSFRUUFN1cHBvcnQsXG4gIGVuYWJsZVRlbGVtZXRyeSxcbiAgZmV0Y2hDcmVkZW50aWFscyxcbiAgc3BlZWNoUmVjb2duaXRpb25FbmRwb2ludElkLFxuICBzcGVlY2hSZWNvZ25pdGlvbkxhbmd1YWdlID0gKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmXG4gICAgdHlwZW9mIHdpbmRvdy5uYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmXG4gICAgd2luZG93Lm5hdmlnYXRvci5sYW5ndWFnZSkgfHxcbiAgICAnZW4tVVMnLFxuICBzcGVlY2hTeW50aGVzaXNEZXBsb3ltZW50SWQsXG4gIHNwZWVjaFN5bnRoZXNpc091dHB1dEZvcm1hdCxcbiAgdGV4dE5vcm1hbGl6YXRpb24sXG4gIHVzZXJJRCxcbiAgdXNlcm5hbWVcbn0pIHtcbiAgaWYgKCFmZXRjaENyZWRlbnRpYWxzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdcImZldGNoQ3JlZGVudGlhbHNcIiBtdXN0IGJlIHNwZWNpZmllZC4nKTtcbiAgfVxuXG4gIGNvbnN0IHsgYXV0aG9yaXphdGlvblRva2VuLCBkaXJlY3RMaW5lVG9rZW4sIGRpcmVjdExpbmVTcGVlY2hIb3N0bmFtZSwgcmVnaW9uLCBzdWJzY3JpcHRpb25LZXkgfSA9XG4gICAgYXdhaXQgcmVzb2x2ZUZ1bmN0aW9uT3JSZXR1cm5WYWx1ZShmZXRjaENyZWRlbnRpYWxzKTtcblxuICBpZiAoXG4gICAgKCFhdXRob3JpemF0aW9uVG9rZW4gJiYgIXN1YnNjcmlwdGlvbktleSkgfHxcbiAgICAoYXV0aG9yaXphdGlvblRva2VuICYmIHN1YnNjcmlwdGlvbktleSkgfHxcbiAgICAoYXV0aG9yaXphdGlvblRva2VuICYmIHR5cGVvZiBhdXRob3JpemF0aW9uVG9rZW4gIT09ICdzdHJpbmcnKSB8fFxuICAgIChzdWJzY3JpcHRpb25LZXkgJiYgdHlwZW9mIHN1YnNjcmlwdGlvbktleSAhPT0gJ3N0cmluZycpIHx8XG4gICAgKGVuYWJsZUludGVybmFsSFRUUFN1cHBvcnQgJiYgIWRpcmVjdExpbmVUb2tlbilcbiAgKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ1wiZmV0Y2hDcmVkZW50aWFsc1wiIG11c3QgcmV0dXJuIGVpdGhlciBcImF1dGhvcml6YXRpb25Ub2tlblwiIG9yIFwic3Vic2NyaXB0aW9uS2V5XCIgYXMgYSBub24tZW1wdHkgc3RyaW5nIG9ubHkuIElmIGVuYWJsZUludGVybmFsSFRUUFN1cHBvcnQgaXMgc2V0IHRvIHRydWUsIHRoZW4gaXQgc2hvdWxkIGFsc28gcmV0dXJuIGEgbm9uLWVtcHR5IFwiZGlyZWN0TGluZVRva2VuXCInXG4gICAgKTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgZW5hYmxlVGVsZW1ldHJ5ICE9PSAndW5kZWZpbmVkJykge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgICdib3RmcmFtZXdvcmstZGlyZWN0bGluZXNwZWVjaDogVGVsZW1ldHJ5IG9wdGlvbnMgYXJlIG5vdCB5ZXQgc3VwcG9ydGVkLiBQbGVhc2UgcmVmZXIgdG8gQ29nbml0aXZlIFNlcnZpY2VzIGRvY3VtZW50YXRpb24gZm9yIGRldGFpbHMuJ1xuICAgICk7XG4gIH1cblxuICBpZiAoKGRpcmVjdExpbmVTcGVlY2hIb3N0bmFtZSAmJiByZWdpb24pIHx8ICghZGlyZWN0TGluZVNwZWVjaEhvc3RuYW1lICYmICFyZWdpb24pKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ1wiZmV0Y2hDcmVkZW50aWFsc1wiIG11c3QgcmV0dXJuIGVpdGhlciBcImRpcmVjdExpbmVTcGVlY2hIb3N0bmFtZVwiIG9yIFwicmVnaW9uXCIgYW5kIGl0IG11c3Qgbm90IGJlIGFuIGVtcHR5IHN0cmluZy4nXG4gICAgKTtcbiAgfVxuXG4gIGlmIChkaXJlY3RMaW5lU3BlZWNoSG9zdG5hbWUpIHtcbiAgICBpZiAodHlwZW9mIGRpcmVjdExpbmVTcGVlY2hIb3N0bmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignXCJmZXRjaENyZWRlbnRpYWxzXCIgbXVzdCByZXR1cm4gXCJkaXJlY3RMaW5lU3BlZWNoSG9zdG5hbWVcIiBhcyBhIHN0cmluZy4nKTtcbiAgICB9XG5cbiAgICBpZiAoZW5hYmxlSW50ZXJuYWxIVFRQU3VwcG9ydCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnXCJmZXRjaENyZWRlbnRpYWxzXCIgbXVzdCBub3QgcmV0dXJuIFwiZGlyZWN0TGluZVNwZWVjaEhvc3RuYW1lXCIgaWYgXCJlbmFibGVJbnRlcm5hbEhUVFBTdXBwb3J0XCIgaXMgc2V0LidcbiAgICAgICk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGlmICh0eXBlb2YgcmVnaW9uICE9PSAnc3RyaW5nJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdcImZldGNoQ3JlZGVudGlhbHNcIiBtdXN0IHJldHVybiBcInJlZ2lvblwiIGFzIGEgc3RyaW5nLicpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChhdWRpb0NvbmZpZyAmJiBhdWRpb0lucHV0RGV2aWNlSWQpIHtcbiAgICBjb25zb2xlLndhcm4oXG4gICAgICAnYm90ZnJhbWV3b3JrLWRpcmVjdGxpbmVzcGVlY2gtc2RrOiBPbmx5IFwiYXVkaW9Db25maWdcIiBvciBcImF1ZGlvSW5wdXREZXZpY2VJZFwiIGNhbiBiZSBzcGVjaWZpZWQsIGJ1dCBub3QgYm90aDsgaWdub3JpbmcgXCJhdWRpb0lucHV0RGV2aWNlSWRcIi4nXG4gICAgKTtcbiAgfSBlbHNlIGlmICghYXVkaW9Db25maWcpIHtcbiAgICBpZiAoYXVkaW9JbnB1dERldmljZUlkKSB7XG4gICAgICBhdWRpb0NvbmZpZyA9IEF1ZGlvQ29uZmlnLmZyb21NaWNyb3Bob25lSW5wdXQoYXVkaW9JbnB1dERldmljZUlkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXVkaW9Db25maWcgPSBBdWRpb0NvbmZpZy5mcm9tRGVmYXVsdE1pY3JvcGhvbmVJbnB1dCgpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChzcGVlY2hSZWNvZ25pdGlvbkVuZHBvaW50SWQpIHtcbiAgICBjb25zb2xlLndhcm4oXG4gICAgICAnYm90ZnJhbWV3b3JrLWRpcmVjdGxpbmVzcGVlY2g6IEN1c3RvbSBTcGVlY2ggaXMgY3VycmVudGx5IG5vdCBzdXBwb3J0ZWQ7IGlnbm9yaW5nIFwic3BlZWNoUmVjb2duaXRpb25FbmRwb2ludElkXCIuJ1xuICAgICk7XG4gIH1cblxuICBpZiAoc3BlZWNoU3ludGhlc2lzRGVwbG95bWVudElkKSB7XG4gICAgY29uc29sZS53YXJuKFxuICAgICAgJ2JvdGZyYW1ld29yay1kaXJlY3RsaW5lc3BlZWNoOiBDdXN0b20gVm9pY2UgaXMgY3VycmVudGx5IG5vdCBzdXBwb3J0ZWQ7IGlnbm9yaW5nIFwic3BlZWNoU3ludGhlc2lzRGVwbG95bWVudElkXCIuJ1xuICAgICk7XG4gIH1cblxuICBpZiAoc3BlZWNoU3ludGhlc2lzT3V0cHV0Rm9ybWF0KSB7XG4gICAgY29uc29sZS53YXJuKFxuICAgICAgJ2JvdGZyYW1ld29yay1kaXJlY3RsaW5lc3BlZWNoOiBTeW50aGVzaXMgb3V0cHV0IGZvcm1hdCBpcyBjdXJyZW50bHkgbm90IHN1cHBvcnRlZDsgaWdub3JpbmcgXCJzcGVlY2hTeW50aGVzaXNPdXRwdXRGb3JtYXRcIi4nXG4gICAgKTtcbiAgfVxuXG4gIGlmICh0ZXh0Tm9ybWFsaXphdGlvbikge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgICdib3RmcmFtZXdvcmstZGlyZWN0bGluZXNwZWVjaDogVGV4dCBub3JtYWxpemF0aW9uIGlzIGN1cnJlbnRseSBub3Qgc3VwcG9ydGVkOyBpZ25vcmluZyBcInRleHROb3JtYWxpemF0aW9uXCIuJ1xuICAgICk7XG4gIH1cblxuICBpZiAodXNlcklEIHx8IHVzZXJuYW1lKSB7XG4gICAgY29uc29sZS53YXJuKFxuICAgICAgJ2JvdGZyYW1ld29yay1kaXJlY3RsaW5lc3BlZWNoOiBDdXN0b20gXCJ1c2VySWRcIiBhbmQgXCJ1c2VybmFtZVwiIGFyZSBjdXJyZW50bHkgbm90IHN1cHBvcnRlZCBhbmQgYXJlIGlnbm9yZWQuJ1xuICAgICk7XG4gIH1cblxuICBsZXQgY29uZmlnO1xuXG4gIGlmIChkaXJlY3RMaW5lU3BlZWNoSG9zdG5hbWUpIHtcbiAgICBpZiAoYXV0aG9yaXphdGlvblRva2VuKSB7XG4gICAgICBjb25maWcgPSBCb3RGcmFtZXdvcmtDb25maWcuZnJvbUhvc3QobmV3IFVSTChgd3NzOi8vJHtkaXJlY3RMaW5lU3BlZWNoSG9zdG5hbWV9YCkpO1xuXG4gICAgICBjb25maWcuc2V0UHJvcGVydHkoUHJvcGVydHlJZC5TcGVlY2hTZXJ2aWNlQXV0aG9yaXphdGlvbl9Ub2tlbiwgYXV0aG9yaXphdGlvblRva2VuKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uZmlnID0gQm90RnJhbWV3b3JrQ29uZmlnLmZyb21Ib3N0KG5ldyBVUkwoYHdzczovLyR7ZGlyZWN0TGluZVNwZWVjaEhvc3RuYW1lfWApLCBzdWJzY3JpcHRpb25LZXkpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoYXV0aG9yaXphdGlvblRva2VuKSB7XG4gICAgICBjb25maWcgPSBCb3RGcmFtZXdvcmtDb25maWcuZnJvbUF1dGhvcml6YXRpb25Ub2tlbihhdXRob3JpemF0aW9uVG9rZW4sIHJlZ2lvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbmZpZyA9IEJvdEZyYW1ld29ya0NvbmZpZy5mcm9tU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbktleSwgcmVnaW9uKTtcbiAgICB9XG5cbiAgICAvLyBJZiBpbnRlcm5hbCBIVFRQIHN1cHBvcnQgaXMgZW5hYmxlZCwgc3dpdGNoIHRoZSBlbmRwb2ludCB0byBEaXJlY3QgTGluZSBvbiBEaXJlY3QgTGluZSBTcGVlY2ggc2VydmljZS5cbiAgICBpZiAoZW5hYmxlSW50ZXJuYWxIVFRQU3VwcG9ydCkge1xuICAgICAgY29uZmlnLnNldFByb3BlcnR5KFxuICAgICAgICBQcm9wZXJ0eUlkLlNwZWVjaFNlcnZpY2VDb25uZWN0aW9uX0VuZHBvaW50LFxuICAgICAgICBgd3NzOi8vJHtlbmNvZGVVUkkocmVnaW9uKX0uY29udmFpLnNwZWVjaC5taWNyb3NvZnQuY29tL2RpcmVjdGxpbmUvYXBpL3YxYFxuICAgICAgKTtcblxuICAgICAgY29uZmlnLnNldFByb3BlcnR5KFByb3BlcnR5SWQuQ29udmVyc2F0aW9uX0FnZW50X0Nvbm5lY3Rpb25fSWQsIGRpcmVjdExpbmVUb2tlbik7XG4gICAgfVxuICB9XG5cbiAgLy8gU3VwcG9ydGVkIG9wdGlvbnMgY2FuIGJlIGZvdW5kIGluIERpYWxvZ0Nvbm5lY3RvckZhY3RvcnkuanMuXG5cbiAgLy8gU2V0IHRoZSBsYW5ndWFnZSB1c2VkIGZvciByZWNvZ25pdGlvbi5cbiAgY29uZmlnLnNldFByb3BlcnR5KFByb3BlcnR5SWQuU3BlZWNoU2VydmljZUNvbm5lY3Rpb25fUmVjb0xhbmd1YWdlLCBzcGVlY2hSZWNvZ25pdGlvbkxhbmd1YWdlKTtcblxuICAvLyBUaGUgZm9sbG93aW5nIGNvZGUgc2V0cyB0aGUgb3V0cHV0IGZvcm1hdC5cbiAgLy8gQXMgYWR2aXNlZCBieSB0aGUgU3BlZWNoIHRlYW0sIHRoaXMgQVBJIG1heSBiZSBzdWJqZWN0IHRvIGZ1dHVyZSBjaGFuZ2VzLlxuICAvLyBXZSBhcmUgbm90IGVuYWJsaW5nIG91dHB1dCBmb3JtYXQgb3B0aW9uIGJlY2F1c2UgaXQgZG9lcyBub3Qgc2VuZCBkZXRhaWxlZCBvdXRwdXQgZm9ybWF0IHRvIHRoZSBib3QsIHJlbmRlcmluZyB0aGlzIG9wdGlvbiB1c2VsZXNzLlxuICAvLyBjb25maWcuc2V0UHJvcGVydHkoUHJvcGVydHlJZC5TcGVlY2hTZXJ2aWNlUmVzcG9uc2VfT3V0cHV0Rm9ybWF0T3B0aW9uLCBPdXRwdXRGb3JtYXRbT3V0cHV0Rm9ybWF0LkRldGFpbGVkXSk7XG5cbiAgLy8gU2V0IHRoZSB1c2VyIElEIGZvciBzdGFydGluZyB0aGUgY29udmVyc2F0aW9uLlxuICB1c2VySUQgJiYgY29uZmlnLnNldFByb3BlcnR5KFByb3BlcnR5SWQuQ29udmVyc2F0aW9uX0Zyb21fSWQsIHVzZXJJRCk7XG5cbiAgLy8gU2V0IEN1c3RvbSBTcGVlY2ggYW5kIEN1c3RvbSBWb2ljZS5cbiAgLy8gVGhlIGZvbGxvd2luZyBjb2RlIGlzIGNvcGllZCBmcm9tIEMjLCBhbmQgaXQgaXMgbm90IHdvcmtpbmcgeWV0LlxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vQXp1cmUtU2FtcGxlcy9Db2duaXRpdmUtU2VydmljZXMtRGlyZWN0LUxpbmUtU3BlZWNoLUNsaWVudC9ibG9iL21hc3Rlci9ETFNwZWVjaENsaWVudC9NYWluV2luZG93LnhhbWwuY3NcbiAgLy8gc3BlZWNoUmVjb2duaXRpb25FbmRwb2ludElkICYmIGNvbmZpZy5zZXRTZXJ2aWNlUHJvcGVydHkoJ2NpZCcsIHNwZWVjaFJlY29nbml0aW9uRW5kcG9pbnRJZCwgU2VydmljZVByb3BlcnR5Q2hhbm5lbC5VcmlRdWVyeVBhcmFtZXRlcik7XG4gIC8vIHNwZWVjaFN5bnRoZXNpc0RlcGxveW1lbnRJZCAmJiBjb25maWcuc2V0UHJvcGVydHkoUHJvcGVydHlJZC5jb252ZXJzYXRpb25fQ3VzdG9tX1ZvaWNlX0RlcGxveW1lbnRfSWRzLCBzcGVlY2hTeW50aGVzaXNEZXBsb3ltZW50SWQpO1xuXG4gIGNvbnN0IGRpYWxvZ1NlcnZpY2VDb25uZWN0b3IgPSBwYXRjaERpYWxvZ1NlcnZpY2VDb25uZWN0b3JJbmxpbmUobmV3IERpYWxvZ1NlcnZpY2VDb25uZWN0b3IoY29uZmlnLCBhdWRpb0NvbmZpZykpO1xuXG4gIC8vIFJlbmV3IHRva2VuIHBlciBpbnRlcnZhbC5cbiAgaWYgKGF1dGhvcml6YXRpb25Ub2tlbikge1xuICAgIGNvbnN0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gIzI2NjAgSWYgdGhlIGNvbm5lY3RvciBoYXMgYmVlbiBkaXNwb3NlZCwgd2Ugc2hvdWxkIHN0b3AgcmVuZXdpbmcgdGhlIHRva2VuLlxuXG4gICAgICAvLyBUT0RPOiBXZSBzaG91bGQgdXNlIGEgcHVibGljIGltcGxlbWVudGF0aW9uIGlmIFNwZWVjaCBTREsgaGFzIG9uZSByZWxhdGVkIHRvIFwicHJpdklzRGlzcG9zZWRcIi5cbiAgICAgIGlmIChkaWFsb2dTZXJ2aWNlQ29ubmVjdG9yLnByaXZJc0Rpc3Bvc2VkKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7XG4gICAgICAgIGF1dGhvcml6YXRpb25Ub2tlbixcbiAgICAgICAgZGlyZWN0TGluZVNwZWVjaEhvc3RuYW1lOiBuZXh0RGlyZWN0TGluZVNwZWVjaEhvc3RuYW1lLFxuICAgICAgICByZWdpb246IG5leHRSZWdpb25cbiAgICAgIH0gPSBhd2FpdCByZXNvbHZlRnVuY3Rpb25PclJldHVyblZhbHVlKGZldGNoQ3JlZGVudGlhbHMpO1xuXG4gICAgICBpZiAoIWF1dGhvcml6YXRpb25Ub2tlbikge1xuICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKFxuICAgICAgICAgICdib3RmcmFtZXdvcmstZGlyZWN0bGluZXNwZWVjaC1zZGs6IFJlbmV3IHRva2VuIGZhaWxlZCBiZWNhdXNlIFwiZmV0Y2hDcmVkZW50aWFsc1wiIGNhbGwgcmV0dXJuZWQgbm8gYXV0aG9yaXphdGlvbiB0b2tlbi4nXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmIChkaXJlY3RMaW5lU3BlZWNoSG9zdG5hbWUpIHtcbiAgICAgICAgaWYgKGRpcmVjdExpbmVTcGVlY2hIb3N0bmFtZSAhPT0gbmV4dERpcmVjdExpbmVTcGVlY2hIb3N0bmFtZSkge1xuICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAnYm90ZnJhbWV3b3JrLWRpcmVjdGxpbmVzcGVlY2gtc2RrOiBcImRpcmVjdExpbmVTcGVlY2hIb3N0bmFtZVwiIGNoYW5nZSBpcyBub3Qgc3VwcG9ydGVkIGZvciByZW5ld2VkIHRva2VuLiBBdXRob3JpemF0aW9uIHRva2VuIGlzIG5vdCByZW5ld2VkLidcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAocmVnaW9uICE9PSBuZXh0UmVnaW9uKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgICdib3RmcmFtZXdvcmstZGlyZWN0bGluZXNwZWVjaC1zZGs6IFJlZ2lvbiBjaGFuZ2UgaXMgbm90IHN1cHBvcnRlZCBmb3IgcmVuZXdlZCB0b2tlbi4gQXV0aG9yaXphdGlvbiB0b2tlbiBpcyBub3QgcmVuZXdlZC4nXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBkaWFsb2dTZXJ2aWNlQ29ubmVjdG9yLmF1dGhvcml6YXRpb25Ub2tlbiA9IGF1dGhvcml6YXRpb25Ub2tlbjsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF0b21pYy11cGRhdGVzXG4gICAgfSwgVE9LRU5fUkVORVdBTF9JTlRFUlZBTCk7XG4gIH1cblxuICAvLyBSZW5ldyB0b2tlbiBwZXIgaW50ZXJ2YWwuXG4gIGlmIChlbmFibGVJbnRlcm5hbEhUVFBTdXBwb3J0KSB7XG4gICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICAvLyAjMjY2MCBJZiB0aGUgY29ubmVjdG9yIGhhcyBiZWVuIGRpc3Bvc2VkLCB3ZSBzaG91bGQgc3RvcCByZW5ld2luZyB0aGUgdG9rZW4uXG5cbiAgICAgIC8vIFRPRE86IFdlIHNob3VsZCB1c2UgYSBwdWJsaWMgaW1wbGVtZW50YXRpb24gaWYgU3BlZWNoIFNESyBoYXMgb25lIHJlbGF0ZWQgdG8gXCJwcml2SXNEaXNwb3NlZFwiLlxuICAgICAgaWYgKGRpYWxvZ1NlcnZpY2VDb25uZWN0b3IucHJpdklzRGlzcG9zZWQpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlZnJlc2hlZERpcmVjdExpbmVUb2tlbiA9IGF3YWl0IHJlZnJlc2hEaXJlY3RMaW5lVG9rZW4oZGlyZWN0TGluZVRva2VuKTtcblxuICAgICAgaWYgKCFyZWZyZXNoZWREaXJlY3RMaW5lVG9rZW4pIHtcbiAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybihcbiAgICAgICAgICAnYm90ZnJhbWV3b3JrLWRpcmVjdGxpbmVzcGVlY2gtc2RrOiBSZW5ldyB0b2tlbiBmYWlsZWQgYmVjYXVzZSBjYWxsIHRvIHJlZnJlc2ggdG9rZW4gRGlyZWN0IExpbmUgQVBJIGRpZCBub3QgcmV0dXJuIGEgbmV3IHRva2VuLidcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgY29uZmlnLnNldFByb3BlcnR5KFByb3BlcnR5SWQuQ29udmVyc2F0aW9uX0FnZW50X0Nvbm5lY3Rpb25fSWQsIHJlZnJlc2hlZERpcmVjdExpbmVUb2tlbik7XG5cbiAgICAgIGRpYWxvZ1NlcnZpY2VDb25uZWN0b3IucHJvcGVydGllcy5zZXRQcm9wZXJ0eShcbiAgICAgICAgUHJvcGVydHlJZC5Db252ZXJzYXRpb25fQWdlbnRfQ29ubmVjdGlvbl9JZCxcbiAgICAgICAgcmVmcmVzaGVkRGlyZWN0TGluZVRva2VuXG4gICAgICApO1xuICAgICAgZGlhbG9nU2VydmljZUNvbm5lY3Rvci5jb25uZWN0KCk7XG4gICAgfSwgRElSRUNUX0xJTkVfVE9LRU5fUkVORVdBTF9JTlRFUlZBTCk7XG4gIH1cblxuICBjb25zdCBkaXJlY3RMaW5lID0gbmV3IERpcmVjdExpbmVTcGVlY2goeyBkaWFsb2dTZXJ2aWNlQ29ubmVjdG9yIH0pO1xuXG4gIGNvbnN0IHdlYlNwZWVjaFBvbnlmaWxsRmFjdG9yeSA9IGNyZWF0ZVdlYlNwZWVjaFBvbnlmaWxsRmFjdG9yeSh7XG4gICAgYXVkaW9Db250ZXh0LFxuICAgIGVuYWJsZVRlbGVtZXRyeSxcbiAgICByZWNvZ25pemVyOiBkaWFsb2dTZXJ2aWNlQ29ubmVjdG9yLFxuICAgIHRleHROb3JtYWxpemF0aW9uXG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgZGlyZWN0TGluZSxcbiAgICB3ZWJTcGVlY2hQb255ZmlsbEZhY3RvcnlcbiAgfTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUVBOztBQU9BOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQWJBO0FBZUEsSUFBTUEsa0NBQWtDLEdBQUcsTUFBM0MsQyxDQUFtRDs7QUFDbkQsSUFBTUMsc0JBQXNCLEdBQUcsTUFBL0IsQyxDQUVBOztTQUM4QkMsTTs7Ozs7b0ZBQWY7SUFBQTs7SUFBQTtNQUFBO1FBQUE7VUFBQTtZQUNiQyxXQURhLFFBQ2JBLFdBRGEsRUFFYkMsWUFGYSxRQUViQSxZQUZhLEVBR2JDLGtCQUhhLFFBR2JBLGtCQUhhLEVBSWJDLHlCQUphLFFBSWJBLHlCQUphLEVBS2JDLGVBTGEsUUFLYkEsZUFMYSxFQU1iQyxnQkFOYSxRQU1iQSxnQkFOYSxFQU9iQywyQkFQYSxRQU9iQSwyQkFQYSwrQkFRYkMseUJBUmEsRUFRYkEseUJBUmEsc0NBUWdCLE9BQU9DLE1BQVAsS0FBa0IsV0FBbEIsSUFDM0IsT0FBT0EsTUFBTSxDQUFDQyxTQUFkLEtBQTRCLFdBREQsSUFFM0JELE1BQU0sQ0FBQ0MsU0FBUCxDQUFpQkMs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