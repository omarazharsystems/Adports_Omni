"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = shareObservable;

/* global Observable */
function shareObservable(observable) {
  var observers = [];
  var subscription;
  return new Observable(function (observer) {
    if (!subscription) {
      subscription = observable.subscribe({
        complete: function complete() {
          observers.forEach(function (observer) {
            return observer.complete();
          });
        },
        error: function error(err) {
          observers.forEach(function (observer) {
            return observer.error(err);
          });
        },
        next: function next(value) {
          observers.forEach(function (observer) {
            return observer.next(value);
          });
        }
      });
    }

    observers.push(observer);
    return function () {
      observers = observers.filter(function (o) {
        return o !== observer;
      });

      if (!observers.length) {
        subscription.unsubscribe();
        subscription = null;
      }
    };
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzaGFyZU9ic2VydmFibGUiLCJvYnNlcnZhYmxlIiwib2JzZXJ2ZXJzIiwic3Vic2NyaXB0aW9uIiwiT2JzZXJ2YWJsZSIsIm9ic2VydmVyIiwic3Vic2NyaWJlIiwiY29tcGxldGUiLCJmb3JFYWNoIiwiZXJyb3IiLCJlcnIiLCJuZXh0IiwidmFsdWUiLCJwdXNoIiwiZmlsdGVyIiwibyIsImxlbmd0aCIsInVuc3Vic2NyaWJlIl0sInNvdXJjZVJvb3QiOiJkaXJlY3RsaW5lc3BlZWNoOi8vLyIsInNvdXJjZXMiOlsiLi4vc3JjL3NoYXJlT2JzZXJ2YWJsZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgT2JzZXJ2YWJsZSAqL1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzaGFyZU9ic2VydmFibGUob2JzZXJ2YWJsZSkge1xuICBsZXQgb2JzZXJ2ZXJzID0gW107XG4gIGxldCBzdWJzY3JpcHRpb247XG5cbiAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcbiAgICBpZiAoIXN1YnNjcmlwdGlvbikge1xuICAgICAgc3Vic2NyaXB0aW9uID0gb2JzZXJ2YWJsZS5zdWJzY3JpYmUoe1xuICAgICAgICBjb21wbGV0ZSgpIHtcbiAgICAgICAgICBvYnNlcnZlcnMuZm9yRWFjaChvYnNlcnZlciA9PiBvYnNlcnZlci5jb21wbGV0ZSgpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlcnJvcihlcnIpIHtcbiAgICAgICAgICBvYnNlcnZlcnMuZm9yRWFjaChvYnNlcnZlciA9PiBvYnNlcnZlci5lcnJvcihlcnIpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBuZXh0KHZhbHVlKSB7XG4gICAgICAgICAgb2JzZXJ2ZXJzLmZvckVhY2gob2JzZXJ2ZXIgPT4gb2JzZXJ2ZXIubmV4dCh2YWx1ZSkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBvYnNlcnZlcnMucHVzaChvYnNlcnZlcik7XG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgb2JzZXJ2ZXJzID0gb2JzZXJ2ZXJzLmZpbHRlcihvID0+IG8gIT09IG9ic2VydmVyKTtcblxuICAgICAgaWYgKCFvYnNlcnZlcnMubGVuZ3RoKSB7XG4gICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICBzdWJzY3JpcHRpb24gPSBudWxsO1xuICAgICAgfVxuICAgIH07XG4gIH0pO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFFZSxTQUFTQSxlQUFULENBQXlCQyxVQUF6QixFQUFxQztFQUNsRCxJQUFJQyxTQUFTLEdBQUcsRUFBaEI7RUFDQSxJQUFJQyxZQUFKO0VBRUEsT0FBTyxJQUFJQyxVQUFKLENBQWUsVUFBQUMsUUFBUSxFQUFJO0lBQ2hDLElBQUksQ0FBQ0YsWUFBTCxFQUFtQjtNQUNqQkEsWUFBWSxHQUFHRixVQUFVLENBQUNLLFNBQVgsQ0FBcUI7UUFDbENDLFFBRGtDLHNCQUN2QjtVQUNUTCxTQUFTLENBQUNNLE9BQVYsQ0FBa0IsVUFBQUgsUUFBUTtZQUFBLE9BQUlBLFFBQVEsQ0FBQ0UsUUFBVCxFQUFKO1VBQUEsQ0FBMUI7UUFDRCxDQUhpQztRQUtsQ0UsS0FMa0MsaUJBSzVCQyxHQUw0QixFQUt2QjtVQUNUUixTQUFTLENBQUNNLE9BQVYsQ0FBa0IsVUFBQUgsUUFBUTtZQUFBLE9BQUlBLFFBQVEsQ0FBQ0ksS0FBVCxDQUFlQyxHQUFmLENBQUo7VUFBQSxDQUExQjtRQUNELENBUGlDO1FBU2xDQyxJQVRrQyxnQkFTN0JDLEtBVDZCLEVBU3RCO1VBQ1ZWLFNBQVMsQ0FBQ00sT0FBVixDQUFrQixVQUFBSCxRQUFRO1lBQUEsT0FBSUEsUUFBUSxDQUFDTSxJQUFULENBQWNDLEtBQWQsQ0FBSjtVQUFBLENBQTFCO1FBQ0Q7TUFYaUMsQ0FBckIsQ0FBZjtJQWFEOztJQUVEVixTQUFTLENBQUNXLElBQVYsQ0FBZVIsUUFBZjtJQUVBLE9BQU8sWUFBTTtNQUNYSCxTQUFTLEdBQUdBLFNBQVMsQ0FBQ1ksTUFBVixDQUFpQixVQUFBQyxDQUFDO1FBQUEsT0FBSUEsQ0FBQyxLQUFLVixRQUFWO01BQUEsQ0FBbEIsQ0FBWjs7TUFFQSxJQUFJLENBQUNILFNBQVMsQ0FBQ2MsTUFBZixFQUF1QjtRQUNyQmIsWUFBWSxDQUFDYyxXQUFiO1FBQ0FkLFlBQVksR0FBRyxJQUFmO01BQ0Q7SUFDRixDQVBEO0VBUUQsQ0EzQk0sQ0FBUDtBQTRCRCJ9