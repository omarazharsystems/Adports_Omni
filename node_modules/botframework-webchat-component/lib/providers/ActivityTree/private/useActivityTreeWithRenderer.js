"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _botframeworkWebchatApi = require("botframework-webchat-api");

var _react = require("react");

var _intersectionOf = _interopRequireDefault(require("../../../Utils/intersectionOf"));

var _removeInline = _interopRequireDefault(require("../../../Utils/removeInline"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var useGroupActivities = _botframeworkWebchatApi.hooks.useGroupActivities;

function validateAllEntriesTagged(entries, bins) {
  return entries.every(function (entry) {
    return bins.some(function (bin) {
      return bin.includes(entry);
    });
  });
} // Activity tree is a multidimensional array, while activities is a 1D array.
// - The first dimension of the array contains activities with same sender;
// - The second dimension of the array contains activities with same status.
// [
//   [
//     // Both messages are from bot and is sent as a batch, we will group them as an array.
//     'Bot: Hello!'
//     'Bot: What can I help today?'
//   ],
//   [
//     'User: What is the weather?'
//   ],
//   [
//     'Bot: Let me look it up... hold on.'
//   ],
//   [
//     // This message is in a different group because it is more than a few seconds apart from the previous message.
//     'Bot: Here is the weather forecast.'
//   ]
// ]


function useActivityTreeWithRenderer(entries) {
  var groupActivities = useGroupActivities(); // We bin activities in 2 different ways:
  // - `activitiesBySender` is a 2D array containing activities with same sender
  // - `activitiesByStatus` is a 2D array containing activities with same status
  // Both arrays should contains all activities.

  var _useMemo = (0, _react.useMemo)(function () {
    var visibleActivities = entries.map(function (_ref) {
      var activity = _ref.activity;
      return activity;
    });
    var groupActivitiesResult = groupActivities({
      activities: visibleActivities
    });
    var activitiesBySender = (groupActivitiesResult === null || groupActivitiesResult === void 0 ? void 0 : groupActivitiesResult.sender) || [];
    var activitiesByStatus = (groupActivitiesResult === null || groupActivitiesResult === void 0 ? void 0 : groupActivitiesResult.status) || [];

    var _map = [activitiesBySender, activitiesByStatus].map(function (bins) {
      return bins.map(function (bin) {
        return bin.map(function (activity) {
          return entries.find(function (entry) {
            return entry.activity === activity;
          });
        });
      });
    }),
        _map2 = _slicedToArray(_map, 2),
        entriesBySender = _map2[0],
        entriesByStatus = _map2[1];

    if (!validateAllEntriesTagged(visibleActivities, activitiesBySender)) {
      console.warn('botframework-webchat: Not every activities are grouped in the "sender" property. Please fix "groupActivitiesMiddleware" and group every activities.');
    }

    if (!validateAllEntriesTagged(visibleActivities, activitiesByStatus)) {
      console.warn('botframework-webchat: Not every activities are grouped in the "status" property. Please fix "groupActivitiesMiddleware" and group every activities.');
    }

    return {
      entriesBySender: entriesBySender,
      entriesByStatus: entriesByStatus
    };
  }, [entries, groupActivities]),
      entriesBySender = _useMemo.entriesBySender,
      entriesByStatus = _useMemo.entriesByStatus; // Create a tree of activities with 2 dimensions: sender, followed by status.


  var activityTree = (0, _react.useMemo)(function () {
    var entriesPendingGrouping = _toConsumableArray(entries);

    var activityTree = [];

    var _loop = function _loop() {
      var found = void 0;
      var entriesWithSameSender = entriesBySender.find(function (bin) {
        return bin.includes(entriesPendingGrouping[0]);
      });
      var senderTree = [];
      entriesWithSameSender === null || entriesWithSameSender === void 0 ? void 0 : entriesWithSameSender.forEach(function (entry) {
        var entriesWithSameStatus = entriesByStatus.find(function (bin) {
          return bin.includes(entry);
        });
        var entriesWithSameSenderAndStatus = (0, _intersectionOf.default)(entriesPendingGrouping, entriesWithSameSender, entriesWithSameStatus);

        if (entriesWithSameSenderAndStatus.length) {
          senderTree.push(Object.freeze(entriesWithSameSenderAndStatus));

          _removeInline.default.apply(void 0, [entriesPendingGrouping].concat(_toConsumableArray(entriesWithSameSenderAndStatus)));

          found = true;
        }
      }); // If the entry is not grouped by the middleware, just put the entry in its own bin.

      found || senderTree.push(Object.freeze([entriesPendingGrouping.shift()]));
      activityTree.push(Object.freeze(senderTree));
    };

    while (entriesPendingGrouping.length) {
      _loop();
    } // Assertion: All entries must be assigned to the activityTree.


    if (!entries.every(function (activity) {
      return activityTree.some(function (activitiesWithSameSender) {
        return activitiesWithSameSender.some(function (activitiesWithSameSenderAndStatus) {
          return activitiesWithSameSenderAndStatus.includes(activity);
        });
      });
    })) {
      console.warn('botframework-webchat internal: Not all visible activities are grouped in the activityTree.', {
        entries: entries,
        activityTree: activityTree
      });
    }

    return Object.freeze(activityTree);
  }, [entriesBySender, entriesByStatus, entries]);
  return activityTree;
}

var _default = useActivityTreeWithRenderer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ1c2VHcm91cEFjdGl2aXRpZXMiLCJob29rcyIsInZhbGlkYXRlQWxsRW50cmllc1RhZ2dlZCIsImVudHJpZXMiLCJiaW5zIiwiZXZlcnkiLCJlbnRyeSIsInNvbWUiLCJiaW4iLCJpbmNsdWRlcyIsInVzZUFjdGl2aXR5VHJlZVdpdGhSZW5kZXJlciIsImdyb3VwQWN0aXZpdGllcyIsInVzZU1lbW8iLCJ2aXNpYmxlQWN0aXZpdGllcyIsIm1hcCIsImFjdGl2aXR5IiwiZ3JvdXBBY3Rpdml0aWVzUmVzdWx0IiwiYWN0aXZpdGllcyIsImFjdGl2aXRpZXNCeVNlbmRlciIsInNlbmRlciIsImFjdGl2aXRpZXNCeVN0YXR1cyIsInN0YXR1cyIsImZpbmQiLCJlbnRyaWVzQnlTZW5kZXIiLCJlbnRyaWVzQnlTdGF0dXMiLCJjb25zb2xlIiwid2FybiIsImFjdGl2aXR5VHJlZSIsImVudHJpZXNQZW5kaW5nR3JvdXBpbmciLCJmb3VuZCIsImVudHJpZXNXaXRoU2FtZVNlbmRlciIsInNlbmRlclRyZWUiLCJmb3JFYWNoIiwiZW50cmllc1dpdGhTYW1lU3RhdHVzIiwiZW50cmllc1dpdGhTYW1lU2VuZGVyQW5kU3RhdHVzIiwiaW50ZXJzZWN0aW9uT2YiLCJsZW5ndGgiLCJwdXNoIiwiT2JqZWN0IiwiZnJlZXplIiwicmVtb3ZlSW5saW5lIiwic2hpZnQiLCJhY3Rpdml0aWVzV2l0aFNhbWVTZW5kZXIiLCJhY3Rpdml0aWVzV2l0aFNhbWVTZW5kZXJBbmRTdGF0dXMiXSwic291cmNlUm9vdCI6ImNvbXBvbmVudDovLy8iLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9wcm92aWRlcnMvQWN0aXZpdHlUcmVlL3ByaXZhdGUvdXNlQWN0aXZpdHlUcmVlV2l0aFJlbmRlcmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGhvb2tzIH0gZnJvbSAnYm90ZnJhbWV3b3JrLXdlYmNoYXQtYXBpJztcbmltcG9ydCB7IHVzZU1lbW8gfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCBpbnRlcnNlY3Rpb25PZiBmcm9tICcuLi8uLi8uLi9VdGlscy9pbnRlcnNlY3Rpb25PZic7XG5pbXBvcnQgcmVtb3ZlSW5saW5lIGZyb20gJy4uLy4uLy4uL1V0aWxzL3JlbW92ZUlubGluZSc7XG5pbXBvcnQgdHlwZSB7IEFjdGl2aXR5V2l0aFJlbmRlcmVyLCBSZWFkb25seUFjdGl2aXR5VHJlZSB9IGZyb20gJy4vdHlwZXMnO1xuXG5jb25zdCB7IHVzZUdyb3VwQWN0aXZpdGllcyB9ID0gaG9va3M7XG5cbmZ1bmN0aW9uIHZhbGlkYXRlQWxsRW50cmllc1RhZ2dlZDxUPihlbnRyaWVzOiByZWFkb25seSBUW10sIGJpbnM6IHJlYWRvbmx5IChyZWFkb25seSBUW10pW10pOiBib29sZWFuIHtcbiAgcmV0dXJuIGVudHJpZXMuZXZlcnkoZW50cnkgPT4gYmlucy5zb21lKGJpbiA9PiBiaW4uaW5jbHVkZXMoZW50cnkpKSk7XG59XG5cbi8vIEFjdGl2aXR5IHRyZWUgaXMgYSBtdWx0aWRpbWVuc2lvbmFsIGFycmF5LCB3aGlsZSBhY3Rpdml0aWVzIGlzIGEgMUQgYXJyYXkuXG4vLyAtIFRoZSBmaXJzdCBkaW1lbnNpb24gb2YgdGhlIGFycmF5IGNvbnRhaW5zIGFjdGl2aXRpZXMgd2l0aCBzYW1lIHNlbmRlcjtcbi8vIC0gVGhlIHNlY29uZCBkaW1lbnNpb24gb2YgdGhlIGFycmF5IGNvbnRhaW5zIGFjdGl2aXRpZXMgd2l0aCBzYW1lIHN0YXR1cy5cblxuLy8gW1xuLy8gICBbXG4vLyAgICAgLy8gQm90aCBtZXNzYWdlcyBhcmUgZnJvbSBib3QgYW5kIGlzIHNlbnQgYXMgYSBiYXRjaCwgd2Ugd2lsbCBncm91cCB0aGVtIGFzIGFuIGFycmF5LlxuLy8gICAgICdCb3Q6IEhlbGxvISdcbi8vICAgICAnQm90OiBXaGF0IGNhbiBJIGhlbHAgdG9kYXk/J1xuLy8gICBdLFxuLy8gICBbXG4vLyAgICAgJ1VzZXI6IFdoYXQgaXMgdGhlIHdlYXRoZXI/J1xuLy8gICBdLFxuLy8gICBbXG4vLyAgICAgJ0JvdDogTGV0IG1lIGxvb2sgaXQgdXAuLi4gaG9sZCBvbi4nXG4vLyAgIF0sXG4vLyAgIFtcbi8vICAgICAvLyBUaGlzIG1lc3NhZ2UgaXMgaW4gYSBkaWZmZXJlbnQgZ3JvdXAgYmVjYXVzZSBpdCBpcyBtb3JlIHRoYW4gYSBmZXcgc2Vjb25kcyBhcGFydCBmcm9tIHRoZSBwcmV2aW91cyBtZXNzYWdlLlxuLy8gICAgICdCb3Q6IEhlcmUgaXMgdGhlIHdlYXRoZXIgZm9yZWNhc3QuJ1xuLy8gICBdXG4vLyBdXG5cbmZ1bmN0aW9uIHVzZUFjdGl2aXR5VHJlZVdpdGhSZW5kZXJlcihlbnRyaWVzOiByZWFkb25seSBBY3Rpdml0eVdpdGhSZW5kZXJlcltdKTogUmVhZG9ubHlBY3Rpdml0eVRyZWUge1xuICBjb25zdCBncm91cEFjdGl2aXRpZXMgPSB1c2VHcm91cEFjdGl2aXRpZXMoKTtcblxuICAvLyBXZSBiaW4gYWN0aXZpdGllcyBpbiAyIGRpZmZlcmVudCB3YXlzOlxuICAvLyAtIGBhY3Rpdml0aWVzQnlTZW5kZXJgIGlzIGEgMkQgYXJyYXkgY29udGFpbmluZyBhY3Rpdml0aWVzIHdpdGggc2FtZSBzZW5kZXJcbiAgLy8gLSBgYWN0aXZpdGllc0J5U3RhdHVzYCBpcyBhIDJEIGFycmF5IGNvbnRhaW5pbmcgYWN0aXZpdGllcyB3aXRoIHNhbWUgc3RhdHVzXG4gIC8vIEJvdGggYXJyYXlzIHNob3VsZCBjb250YWlucyBhbGwgYWN0aXZpdGllcy5cblxuICBjb25zdCB7IGVudHJpZXNCeVNlbmRlciwgZW50cmllc0J5U3RhdHVzIH0gPSB1c2VNZW1vPHtcbiAgICBlbnRyaWVzQnlTZW5kZXI6IHJlYWRvbmx5IChyZWFkb25seSBBY3Rpdml0eVdpdGhSZW5kZXJlcltdKVtdO1xuICAgIGVudHJpZXNCeVN0YXR1czogcmVhZG9ubHkgKHJlYWRvbmx5IEFjdGl2aXR5V2l0aFJlbmRlcmVyW10pW107XG4gIH0+KCgpID0+IHtcbiAgICBjb25zdCB2aXNpYmxlQWN0aXZpdGllcyA9IGVudHJpZXMubWFwKCh7IGFjdGl2aXR5IH0pID0+IGFjdGl2aXR5KTtcblxuICAgIGNvbnN0IGdyb3VwQWN0aXZpdGllc1Jlc3VsdCA9IGdyb3VwQWN0aXZpdGllcyh7IGFjdGl2aXRpZXM6IHZpc2libGVBY3Rpdml0aWVzIH0pO1xuXG4gICAgY29uc3QgYWN0aXZpdGllc0J5U2VuZGVyID0gZ3JvdXBBY3Rpdml0aWVzUmVzdWx0Py5zZW5kZXIgfHwgW107XG4gICAgY29uc3QgYWN0aXZpdGllc0J5U3RhdHVzID0gZ3JvdXBBY3Rpdml0aWVzUmVzdWx0Py5zdGF0dXMgfHwgW107XG5cbiAgICBjb25zdCBbZW50cmllc0J5U2VuZGVyLCBlbnRyaWVzQnlTdGF0dXNdID0gW2FjdGl2aXRpZXNCeVNlbmRlciwgYWN0aXZpdGllc0J5U3RhdHVzXS5tYXAoYmlucyA9PlxuICAgICAgYmlucy5tYXAoYmluID0+IGJpbi5tYXAoYWN0aXZpdHkgPT4gZW50cmllcy5maW5kKGVudHJ5ID0+IGVudHJ5LmFjdGl2aXR5ID09PSBhY3Rpdml0eSkpKVxuICAgICk7XG5cbiAgICBpZiAoIXZhbGlkYXRlQWxsRW50cmllc1RhZ2dlZCh2aXNpYmxlQWN0aXZpdGllcywgYWN0aXZpdGllc0J5U2VuZGVyKSkge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAnYm90ZnJhbWV3b3JrLXdlYmNoYXQ6IE5vdCBldmVyeSBhY3Rpdml0aWVzIGFyZSBncm91cGVkIGluIHRoZSBcInNlbmRlclwiIHByb3BlcnR5LiBQbGVhc2UgZml4IFwiZ3JvdXBBY3Rpdml0aWVzTWlkZGxld2FyZVwiIGFuZCBncm91cCBldmVyeSBhY3Rpdml0aWVzLidcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKCF2YWxpZGF0ZUFsbEVudHJpZXNUYWdnZWQodmlzaWJsZUFjdGl2aXRpZXMsIGFjdGl2aXRpZXNCeVN0YXR1cykpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ2JvdGZyYW1ld29yay13ZWJjaGF0OiBOb3QgZXZlcnkgYWN0aXZpdGllcyBhcmUgZ3JvdXBlZCBpbiB0aGUgXCJzdGF0dXNcIiBwcm9wZXJ0eS4gUGxlYXNlIGZpeCBcImdyb3VwQWN0aXZpdGllc01pZGRsZXdhcmVcIiBhbmQgZ3JvdXAgZXZlcnkgYWN0aXZpdGllcy4nXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBlbnRyaWVzQnlTZW5kZXIsXG4gICAgICBlbnRyaWVzQnlTdGF0dXNcbiAgICB9O1xuICB9LCBbZW50cmllcywgZ3JvdXBBY3Rpdml0aWVzXSk7XG5cbiAgLy8gQ3JlYXRlIGEgdHJlZSBvZiBhY3Rpdml0aWVzIHdpdGggMiBkaW1lbnNpb25zOiBzZW5kZXIsIGZvbGxvd2VkIGJ5IHN0YXR1cy5cblxuICBjb25zdCBhY3Rpdml0eVRyZWU6IFJlYWRvbmx5QWN0aXZpdHlUcmVlID0gdXNlTWVtbygoKSA9PiB7XG4gICAgY29uc3QgZW50cmllc1BlbmRpbmdHcm91cGluZyA9IFsuLi5lbnRyaWVzXTtcbiAgICBjb25zdCBhY3Rpdml0eVRyZWU6IChyZWFkb25seSAocmVhZG9ubHkgQWN0aXZpdHlXaXRoUmVuZGVyZXJbXSlbXSlbXSA9IFtdO1xuXG4gICAgd2hpbGUgKGVudHJpZXNQZW5kaW5nR3JvdXBpbmcubGVuZ3RoKSB7XG4gICAgICBsZXQgZm91bmQ6IGJvb2xlYW47XG4gICAgICBjb25zdCBlbnRyaWVzV2l0aFNhbWVTZW5kZXIgPSBlbnRyaWVzQnlTZW5kZXIuZmluZChiaW4gPT4gYmluLmluY2x1ZGVzKGVudHJpZXNQZW5kaW5nR3JvdXBpbmdbMF0pKTtcbiAgICAgIGNvbnN0IHNlbmRlclRyZWU6IChyZWFkb25seSBBY3Rpdml0eVdpdGhSZW5kZXJlcltdKVtdID0gW107XG5cbiAgICAgIGVudHJpZXNXaXRoU2FtZVNlbmRlcj8uZm9yRWFjaChlbnRyeSA9PiB7XG4gICAgICAgIGNvbnN0IGVudHJpZXNXaXRoU2FtZVN0YXR1cyA9IGVudHJpZXNCeVN0YXR1cy5maW5kKGJpbiA9PiBiaW4uaW5jbHVkZXMoZW50cnkpKTtcblxuICAgICAgICBjb25zdCBlbnRyaWVzV2l0aFNhbWVTZW5kZXJBbmRTdGF0dXMgPSBpbnRlcnNlY3Rpb25PZjxBY3Rpdml0eVdpdGhSZW5kZXJlcj4oXG4gICAgICAgICAgZW50cmllc1BlbmRpbmdHcm91cGluZyxcbiAgICAgICAgICBlbnRyaWVzV2l0aFNhbWVTZW5kZXIsXG4gICAgICAgICAgZW50cmllc1dpdGhTYW1lU3RhdHVzXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKGVudHJpZXNXaXRoU2FtZVNlbmRlckFuZFN0YXR1cy5sZW5ndGgpIHtcbiAgICAgICAgICBzZW5kZXJUcmVlLnB1c2goT2JqZWN0LmZyZWV6ZShlbnRyaWVzV2l0aFNhbWVTZW5kZXJBbmRTdGF0dXMpKTtcbiAgICAgICAgICByZW1vdmVJbmxpbmUoZW50cmllc1BlbmRpbmdHcm91cGluZywgLi4uZW50cmllc1dpdGhTYW1lU2VuZGVyQW5kU3RhdHVzKTtcblxuICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIElmIHRoZSBlbnRyeSBpcyBub3QgZ3JvdXBlZCBieSB0aGUgbWlkZGxld2FyZSwganVzdCBwdXQgdGhlIGVudHJ5IGluIGl0cyBvd24gYmluLlxuICAgICAgZm91bmQgfHwgc2VuZGVyVHJlZS5wdXNoKE9iamVjdC5mcmVlemUoW2VudHJpZXNQZW5kaW5nR3JvdXBpbmcuc2hpZnQoKV0pKTtcblxuICAgICAgYWN0aXZpdHlUcmVlLnB1c2goT2JqZWN0LmZyZWV6ZShzZW5kZXJUcmVlKSk7XG4gICAgfVxuXG4gICAgLy8gQXNzZXJ0aW9uOiBBbGwgZW50cmllcyBtdXN0IGJlIGFzc2lnbmVkIHRvIHRoZSBhY3Rpdml0eVRyZWUuXG4gICAgaWYgKFxuICAgICAgIWVudHJpZXMuZXZlcnkoYWN0aXZpdHkgPT5cbiAgICAgICAgYWN0aXZpdHlUcmVlLnNvbWUoYWN0aXZpdGllc1dpdGhTYW1lU2VuZGVyID0+XG4gICAgICAgICAgYWN0aXZpdGllc1dpdGhTYW1lU2VuZGVyLnNvbWUoYWN0aXZpdGllc1dpdGhTYW1lU2VuZGVyQW5kU3RhdHVzID0+XG4gICAgICAgICAgICBhY3Rpdml0aWVzV2l0aFNhbWVTZW5kZXJBbmRTdGF0dXMuaW5jbHVkZXMoYWN0aXZpdHkpXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApXG4gICAgKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ2JvdGZyYW1ld29yay13ZWJjaGF0IGludGVybmFsOiBOb3QgYWxsIHZpc2libGUgYWN0aXZpdGllcyBhcmUgZ3JvdXBlZCBpbiB0aGUgYWN0aXZpdHlUcmVlLicsIHtcbiAgICAgICAgZW50cmllcyxcbiAgICAgICAgYWN0aXZpdHlUcmVlXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gT2JqZWN0LmZyZWV6ZShhY3Rpdml0eVRyZWUpO1xuICB9LCBbZW50cmllc0J5U2VuZGVyLCBlbnRyaWVzQnlTdGF0dXMsIGVudHJpZXNdKTtcblxuICByZXR1cm4gYWN0aXZpdHlUcmVlO1xufVxuXG5leHBvcnQgdHlwZSB7IEFjdGl2aXR5V2l0aFJlbmRlcmVyIH07XG5cbmV4cG9ydCBkZWZhdWx0IHVzZUFjdGl2aXR5VHJlZVdpdGhSZW5kZXJlcjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUVBOztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFHQSxJQUFRQSxrQkFBUixHQUErQkMsNkJBQS9CLENBQVFELGtCQUFSOztBQUVBLFNBQVNFLHdCQUFULENBQXFDQyxPQUFyQyxFQUE0REMsSUFBNUQsRUFBc0c7RUFDcEcsT0FBT0QsT0FBTyxDQUFDRSxLQUFSLENBQWMsVUFBQUMsS0FBSztJQUFBLE9BQUlGLElBQUksQ0FBQ0csSUFBTCxDQUFVLFVBQUFDLEdBQUc7TUFBQSxPQUFJQSxHQUFHLENBQUNDLFFBQUosQ0FBYUgsS0FBYixDQUFKO0lBQUEsQ0FBYixDQUFKO0VBQUEsQ0FBbkIsQ0FBUDtBQUNELEMsQ0FFRDtBQUNBO0FBQ0E7QUFFQTtB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