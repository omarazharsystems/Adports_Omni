"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _Context = _interopRequireDefault(require("./private/Context"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint complexity: ["error", 50] */
var RovingTabIndexComposer = function RovingTabIndexComposer(_ref) {
  var children = _ref.children,
      onEscapeKey = _ref.onEscapeKey,
      orientation = _ref.orientation;
  var activeItemIndexRef = (0, _react.useRef)(0);
  var itemRefsRef = (0, _react.useRef)([]);
  var refreshTabIndices = (0, _react.useCallback)(function () {
    var activeItemIndex = activeItemIndexRef.current;
    itemRefsRef.current.forEach(function (_ref2, index) {
      var current = _ref2.current;
      current === null || current === void 0 ? void 0 : current.setAttribute('tabindex', activeItemIndex === index ? '0' : '-1');
    });
  }, [activeItemIndexRef]);
  var setActiveItemIndex = (0, _react.useCallback)(function (valueOrFunction) {
    var _itemRefsRef$current$;

    // All calls to this function is expected to be under event handlers (post-rendering).
    var nextActiveItemIndex;

    if (typeof valueOrFunction === 'number') {
      nextActiveItemIndex = valueOrFunction;
    } else {
      nextActiveItemIndex = valueOrFunction(activeItemIndexRef.current);
    } // If the index points to no item, fallback to the first item.
    // This make sure at least one of the item in the container is selected.


    if (nextActiveItemIndex && !((_itemRefsRef$current$ = itemRefsRef.current[+nextActiveItemIndex]) !== null && _itemRefsRef$current$ !== void 0 && _itemRefsRef$current$.current)) {
      nextActiveItemIndex = 0;
    }

    if (activeItemIndexRef.current !== nextActiveItemIndex) {
      var _itemRefsRef$current$2, _itemRefsRef$current$3;

      activeItemIndexRef.current = nextActiveItemIndex;
      refreshTabIndices();
      (_itemRefsRef$current$2 = itemRefsRef.current[+nextActiveItemIndex]) === null || _itemRefsRef$current$2 === void 0 ? void 0 : (_itemRefsRef$current$3 = _itemRefsRef$current$2.current) === null || _itemRefsRef$current$3 === void 0 ? void 0 : _itemRefsRef$current$3.focus();
    }
  }, [activeItemIndexRef, itemRefsRef, refreshTabIndices]);
  var handleFocus = (0, _react.useCallback)(function (event) {
    var target = event.target;
    var index = itemRefsRef.current.findIndex(function (_ref3) {
      var current = _ref3.current;
      return current === target;
    });
    ~index && setActiveItemIndex(index);
  }, [itemRefsRef, setActiveItemIndex]);
  var handleKeyDown = (0, _react.useCallback)(function (event) {
    var key = event.key;
    var vertical = orientation === 'vertical';

    switch (key) {
      case 'ArrowDown':
      case 'ArrowRight':
      case 'Down': // IE11

      case 'Right':
        // IE11
        if (vertical && key === 'ArrowRight' || !vertical && key === 'ArrowDown') {
          return;
        }

        setActiveItemIndex(function (value) {
          // The `itemRefsRef` array could be a sparse array.
          // Thus, the next item may not be immediately next to the current one.
          var itemIndices = itemRefsRef.current.map(function (_, index) {
            return index;
          });
          var nextIndex = itemIndices.indexOf(value) + 1;

          if (nextIndex >= itemIndices.length) {
            return itemIndices[0];
          }

          return itemIndices[+nextIndex];
        });
        break;

      case 'ArrowLeft':
      case 'ArrowUp':
      case 'Left': // IE11

      case 'Up':
        // IE11
        if (vertical && key === 'ArrowLeft' || !vertical && key === 'ArrowUp') {
          return;
        }

        setActiveItemIndex(function (value) {
          // The `itemRefsRef` array could be a sparse array.
          // Thus, the next item may not be immediately next to the current one.
          var itemIndices = itemRefsRef.current.map(function (_, index) {
            return index;
          });
          var nextIndex = itemIndices.indexOf(value) - 1;

          if (nextIndex < 0) {
            return itemIndices[itemIndices.length - 1];
          }

          return itemIndices[+nextIndex];
        });
        break;

      case 'Home':
        setActiveItemIndex(0);
        break;

      case 'End':
        setActiveItemIndex(Infinity);
        break;

      case 'Escape':
        if (!onEscapeKey) {
          // If the "onEscapeKey" prop is not passed, don't call preventDefault() and stopPropagation().
          return;
        }

        onEscapeKey();
        break;

      default:
        return;
    }

    event.preventDefault();
    event.stopPropagation();
  }, [setActiveItemIndex, onEscapeKey, orientation]);
  var itemEffector = (0, _react.useCallback)(function (ref, index) {
    var current = ref.current;
    itemRefsRef.current[+index] = ref;
    current.addEventListener('focus', handleFocus);
    current.addEventListener('keydown', handleKeyDown);
    current.setAttribute('tabindex', activeItemIndexRef.current === index ? '0' : '-1');
    return function () {
      current.removeEventListener('focus', handleFocus);
      current.removeEventListener('keydown', handleKeyDown);
      delete itemRefsRef.current[+index];
    };
  }, [activeItemIndexRef, handleFocus, handleKeyDown]);
  var contextValue = (0, _react.useMemo)(function () {
    return {
      itemEffector: itemEffector
    };
  }, [itemEffector]); // This hook run on every render to rectify `activeItemIndexRef`.
  // So it will always point to an existing item or first item if available.

  (0, _react.useEffect)(function () {
    setActiveItemIndex(function (value) {
      return value;
    });
  });
  return /*#__PURE__*/_react.default.createElement(_Context.default.Provider, {
    value: contextValue
  }, children);
};

RovingTabIndexComposer.defaultProps = {
  onEscapeKey: undefined,
  orientation: 'horizontal'
};
RovingTabIndexComposer.propTypes = {
  onEscapeKey: _propTypes.default.func,
  orientation: _propTypes.default.oneOf(['horizontal', 'vertical'])
};
var _default = RovingTabIndexComposer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSb3ZpbmdUYWJJbmRleENvbXBvc2VyIiwiY2hpbGRyZW4iLCJvbkVzY2FwZUtleSIsIm9yaWVudGF0aW9uIiwiYWN0aXZlSXRlbUluZGV4UmVmIiwidXNlUmVmIiwiaXRlbVJlZnNSZWYiLCJyZWZyZXNoVGFiSW5kaWNlcyIsInVzZUNhbGxiYWNrIiwiYWN0aXZlSXRlbUluZGV4IiwiY3VycmVudCIsImZvckVhY2giLCJpbmRleCIsInNldEF0dHJpYnV0ZSIsInNldEFjdGl2ZUl0ZW1JbmRleCIsInZhbHVlT3JGdW5jdGlvbiIsIm5leHRBY3RpdmVJdGVtSW5kZXgiLCJmb2N1cyIsImhhbmRsZUZvY3VzIiwiZXZlbnQiLCJ0YXJnZXQiLCJmaW5kSW5kZXgiLCJoYW5kbGVLZXlEb3duIiwia2V5IiwidmVydGljYWwiLCJ2YWx1ZSIsIml0ZW1JbmRpY2VzIiwibWFwIiwiXyIsIm5leHRJbmRleCIsImluZGV4T2YiLCJsZW5ndGgiLCJJbmZpbml0eSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwiaXRlbUVmZmVjdG9yIiwicmVmIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjb250ZXh0VmFsdWUiLCJ1c2VNZW1vIiwidXNlRWZmZWN0IiwiZGVmYXVsdFByb3BzIiwidW5kZWZpbmVkIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwiZnVuYyIsIm9uZU9mIl0sInNvdXJjZVJvb3QiOiJjb21wb25lbnQ6Ly8vIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcHJvdmlkZXJzL1JvdmluZ1RhYkluZGV4L1JvdmluZ1RhYkluZGV4Q29tcG9zZXIudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludCBjb21wbGV4aXR5OiBbXCJlcnJvclwiLCA1MF0gKi9cblxuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VNZW1vLCB1c2VSZWYgfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCBSb3ZpbmdUYWJJbmRleENvbnRleHQgZnJvbSAnLi9wcml2YXRlL0NvbnRleHQnO1xuXG5pbXBvcnQgdHlwZSB7IEZDLCBNdXRhYmxlUmVmT2JqZWN0LCBQcm9wc1dpdGhDaGlsZHJlbiB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB0eXBlIHsgUm92aW5nVGFiSW5kZXhDb250ZXh0VHlwZSB9IGZyb20gJy4vcHJpdmF0ZS9Db250ZXh0JztcblxudHlwZSBJdGVtUmVmID0gTXV0YWJsZVJlZk9iamVjdDxIVE1MRWxlbWVudCB8IHVuZGVmaW5lZD47XG5cbnR5cGUgUm92aW5nVGFiSW5kZXhDb250ZXh0UHJvcHMgPSBQcm9wc1dpdGhDaGlsZHJlbjx7XG4gIG9uRXNjYXBlS2V5PzogKCkgPT4gdm9pZDtcbiAgb3JpZW50YXRpb24/OiAnaG9yaXpvbnRhbCcgfCAndmVydGljYWwnO1xufT47XG5cbmNvbnN0IFJvdmluZ1RhYkluZGV4Q29tcG9zZXI6IEZDPFJvdmluZ1RhYkluZGV4Q29udGV4dFByb3BzPiA9ICh7IGNoaWxkcmVuLCBvbkVzY2FwZUtleSwgb3JpZW50YXRpb24gfSkgPT4ge1xuICBjb25zdCBhY3RpdmVJdGVtSW5kZXhSZWYgPSB1c2VSZWYoMCk7XG4gIGNvbnN0IGl0ZW1SZWZzUmVmID0gdXNlUmVmPEl0ZW1SZWZbXT4oW10pO1xuXG4gIGNvbnN0IHJlZnJlc2hUYWJJbmRpY2VzID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGNvbnN0IHsgY3VycmVudDogYWN0aXZlSXRlbUluZGV4IH0gPSBhY3RpdmVJdGVtSW5kZXhSZWY7XG5cbiAgICBpdGVtUmVmc1JlZi5jdXJyZW50LmZvckVhY2goKHsgY3VycmVudCB9LCBpbmRleCkgPT4ge1xuICAgICAgY3VycmVudD8uc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIGFjdGl2ZUl0ZW1JbmRleCA9PT0gaW5kZXggPyAnMCcgOiAnLTEnKTtcbiAgICB9KTtcbiAgfSwgW2FjdGl2ZUl0ZW1JbmRleFJlZl0pO1xuXG4gIGNvbnN0IHNldEFjdGl2ZUl0ZW1JbmRleCA9IHVzZUNhbGxiYWNrKFxuICAgICh2YWx1ZU9yRnVuY3Rpb246IG51bWJlciB8ICgodmFsdWU6IG51bWJlcikgPT4gbnVtYmVyKSkgPT4ge1xuICAgICAgLy8gQWxsIGNhbGxzIHRvIHRoaXMgZnVuY3Rpb24gaXMgZXhwZWN0ZWQgdG8gYmUgdW5kZXIgZXZlbnQgaGFuZGxlcnMgKHBvc3QtcmVuZGVyaW5nKS5cbiAgICAgIGxldCBuZXh0QWN0aXZlSXRlbUluZGV4O1xuXG4gICAgICBpZiAodHlwZW9mIHZhbHVlT3JGdW5jdGlvbiA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgbmV4dEFjdGl2ZUl0ZW1JbmRleCA9IHZhbHVlT3JGdW5jdGlvbjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5leHRBY3RpdmVJdGVtSW5kZXggPSB2YWx1ZU9yRnVuY3Rpb24oYWN0aXZlSXRlbUluZGV4UmVmLmN1cnJlbnQpO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiB0aGUgaW5kZXggcG9pbnRzIHRvIG5vIGl0ZW0sIGZhbGxiYWNrIHRvIHRoZSBmaXJzdCBpdGVtLlxuICAgICAgLy8gVGhpcyBtYWtlIHN1cmUgYXQgbGVhc3Qgb25lIG9mIHRoZSBpdGVtIGluIHRoZSBjb250YWluZXIgaXMgc2VsZWN0ZWQuXG4gICAgICBpZiAobmV4dEFjdGl2ZUl0ZW1JbmRleCAmJiAhaXRlbVJlZnNSZWYuY3VycmVudFsrbmV4dEFjdGl2ZUl0ZW1JbmRleF0/LmN1cnJlbnQpIHtcbiAgICAgICAgbmV4dEFjdGl2ZUl0ZW1JbmRleCA9IDA7XG4gICAgICB9XG5cbiAgICAgIGlmIChhY3RpdmVJdGVtSW5kZXhSZWYuY3VycmVudCAhPT0gbmV4dEFjdGl2ZUl0ZW1JbmRleCkge1xuICAgICAgICBhY3RpdmVJdGVtSW5kZXhSZWYuY3VycmVudCA9IG5leHRBY3RpdmVJdGVtSW5kZXg7XG5cbiAgICAgICAgcmVmcmVzaFRhYkluZGljZXMoKTtcbiAgICAgICAgaXRlbVJlZnNSZWYuY3VycmVudFsrbmV4dEFjdGl2ZUl0ZW1JbmRleF0/LmN1cnJlbnQ/LmZvY3VzKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBbYWN0aXZlSXRlbUluZGV4UmVmLCBpdGVtUmVmc1JlZiwgcmVmcmVzaFRhYkluZGljZXNdXG4gICk7XG5cbiAgY29uc3QgaGFuZGxlRm9jdXMgPSB1c2VDYWxsYmFjayhcbiAgICBldmVudCA9PiB7XG4gICAgICBjb25zdCB7IHRhcmdldCB9ID0gZXZlbnQ7XG5cbiAgICAgIGNvbnN0IGluZGV4ID0gaXRlbVJlZnNSZWYuY3VycmVudC5maW5kSW5kZXgoKHsgY3VycmVudCB9KSA9PiBjdXJyZW50ID09PSB0YXJnZXQpO1xuXG4gICAgICB+aW5kZXggJiYgc2V0QWN0aXZlSXRlbUluZGV4KGluZGV4KTtcbiAgICB9LFxuICAgIFtpdGVtUmVmc1JlZiwgc2V0QWN0aXZlSXRlbUluZGV4XVxuICApO1xuXG4gIGNvbnN0IGhhbmRsZUtleURvd24gPSB1c2VDYWxsYmFjazwoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHZvaWQ+KFxuICAgIGV2ZW50ID0+IHtcbiAgICAgIGNvbnN0IHsga2V5IH0gPSBldmVudDtcbiAgICAgIGNvbnN0IHZlcnRpY2FsID0gb3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCc7XG5cbiAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgIGNhc2UgJ0Fycm93RG93bic6XG4gICAgICAgIGNhc2UgJ0Fycm93UmlnaHQnOlxuICAgICAgICBjYXNlICdEb3duJzogLy8gSUUxMVxuICAgICAgICBjYXNlICdSaWdodCc6IC8vIElFMTFcbiAgICAgICAgICBpZiAoKHZlcnRpY2FsICYmIGtleSA9PT0gJ0Fycm93UmlnaHQnKSB8fCAoIXZlcnRpY2FsICYmIGtleSA9PT0gJ0Fycm93RG93bicpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc2V0QWN0aXZlSXRlbUluZGV4KHZhbHVlID0+IHtcbiAgICAgICAgICAgIC8vIFRoZSBgaXRlbVJlZnNSZWZgIGFycmF5IGNvdWxkIGJlIGEgc3BhcnNlIGFycmF5LlxuICAgICAgICAgICAgLy8gVGh1cywgdGhlIG5leHQgaXRlbSBtYXkgbm90IGJlIGltbWVkaWF0ZWx5IG5leHQgdG8gdGhlIGN1cnJlbnQgb25lLlxuICAgICAgICAgICAgY29uc3QgaXRlbUluZGljZXMgPSBpdGVtUmVmc1JlZi5jdXJyZW50Lm1hcCgoXywgaW5kZXgpID0+IGluZGV4KTtcbiAgICAgICAgICAgIGNvbnN0IG5leHRJbmRleCA9IGl0ZW1JbmRpY2VzLmluZGV4T2YodmFsdWUpICsgMTtcblxuICAgICAgICAgICAgaWYgKG5leHRJbmRleCA+PSBpdGVtSW5kaWNlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1JbmRpY2VzWzBdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gaXRlbUluZGljZXNbK25leHRJbmRleF07XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdBcnJvd0xlZnQnOlxuICAgICAgICBjYXNlICdBcnJvd1VwJzpcbiAgICAgICAgY2FzZSAnTGVmdCc6IC8vIElFMTFcbiAgICAgICAgY2FzZSAnVXAnOiAvLyBJRTExXG4gICAgICAgICAgaWYgKCh2ZXJ0aWNhbCAmJiBrZXkgPT09ICdBcnJvd0xlZnQnKSB8fCAoIXZlcnRpY2FsICYmIGtleSA9PT0gJ0Fycm93VXAnKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHNldEFjdGl2ZUl0ZW1JbmRleCh2YWx1ZSA9PiB7XG4gICAgICAgICAgICAvLyBUaGUgYGl0ZW1SZWZzUmVmYCBhcnJheSBjb3VsZCBiZSBhIHNwYXJzZSBhcnJheS5cbiAgICAgICAgICAgIC8vIFRodXMsIHRoZSBuZXh0IGl0ZW0gbWF5IG5vdCBiZSBpbW1lZGlhdGVseSBuZXh0IHRvIHRoZSBjdXJyZW50IG9uZS5cbiAgICAgICAgICAgIGNvbnN0IGl0ZW1JbmRpY2VzID0gaXRlbVJlZnNSZWYuY3VycmVudC5tYXAoKF8sIGluZGV4KSA9PiBpbmRleCk7XG4gICAgICAgICAgICBjb25zdCBuZXh0SW5kZXggPSBpdGVtSW5kaWNlcy5pbmRleE9mKHZhbHVlKSAtIDE7XG5cbiAgICAgICAgICAgIGlmIChuZXh0SW5kZXggPCAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiBpdGVtSW5kaWNlc1tpdGVtSW5kaWNlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1JbmRpY2VzWytuZXh0SW5kZXhdO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnSG9tZSc6XG4gICAgICAgICAgc2V0QWN0aXZlSXRlbUluZGV4KDApO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ0VuZCc6XG4gICAgICAgICAgc2V0QWN0aXZlSXRlbUluZGV4KEluZmluaXR5KTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdFc2NhcGUnOlxuICAgICAgICAgIGlmICghb25Fc2NhcGVLZXkpIHtcbiAgICAgICAgICAgIC8vIElmIHRoZSBcIm9uRXNjYXBlS2V5XCIgcHJvcCBpcyBub3QgcGFzc2VkLCBkb24ndCBjYWxsIHByZXZlbnREZWZhdWx0KCkgYW5kIHN0b3BQcm9wYWdhdGlvbigpLlxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIG9uRXNjYXBlS2V5KCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9LFxuICAgIFtzZXRBY3RpdmVJdGVtSW5kZXgsIG9uRXNjYXBlS2V5LCBvcmllbnRhdGlvbl1cbiAgKTtcblxuICBjb25zdCBpdGVtRWZmZWN0b3IgPSB1c2VDYWxsYmFjayhcbiAgICAocmVmLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgeyBjdXJyZW50IH0gPSByZWY7XG5cbiAgICAgIGl0ZW1SZWZzUmVmLmN1cnJlbnRbK2luZGV4XSA9IHJlZjtcblxuICAgICAgY3VycmVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIGhhbmRsZUZvY3VzKTtcbiAgICAgIGN1cnJlbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUtleURvd24pO1xuXG4gICAgICBjdXJyZW50LnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCBhY3RpdmVJdGVtSW5kZXhSZWYuY3VycmVudCA9PT0gaW5kZXggPyAnMCcgOiAnLTEnKTtcblxuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgY3VycmVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIGhhbmRsZUZvY3VzKTtcbiAgICAgICAgY3VycmVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgaGFuZGxlS2V5RG93bik7XG5cbiAgICAgICAgZGVsZXRlIGl0ZW1SZWZzUmVmLmN1cnJlbnRbK2luZGV4XTtcbiAgICAgIH07XG4gICAgfSxcbiAgICBbYWN0aXZlSXRlbUluZGV4UmVmLCBoYW5kbGVGb2N1cywgaGFuZGxlS2V5RG93bl1cbiAgKTtcblxuICBjb25zdCBjb250ZXh0VmFsdWUgPSB1c2VNZW1vPFJvdmluZ1RhYkluZGV4Q29udGV4dFR5cGU+KFxuICAgICgpID0+ICh7XG4gICAgICBpdGVtRWZmZWN0b3JcbiAgICB9KSxcbiAgICBbaXRlbUVmZmVjdG9yXVxuICApO1xuXG4gIC8vIFRoaXMgaG9vayBydW4gb24gZXZlcnkgcmVuZGVyIHRvIHJlY3RpZnkgYGFjdGl2ZUl0ZW1JbmRleFJlZmAuXG4gIC8vIFNvIGl0IHdpbGwgYWx3YXlzIHBvaW50IHRvIGFuIGV4aXN0aW5nIGl0ZW0gb3IgZmlyc3QgaXRlbSBpZiBhdmFpbGFibGUuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgc2V0QWN0aXZlSXRlbUluZGV4KHZhbHVlID0+IHZhbHVlKTtcbiAgfSk7XG5cbiAgcmV0dXJuIDxSb3ZpbmdUYWJJbmRleENvbnRleHQuUHJvdmlkZXIgdmFsdWU9e2NvbnRleHRWYWx1ZX0+e2NoaWxkcmVufTwvUm92aW5nVGFiSW5kZXhDb250ZXh0LlByb3ZpZGVyPjtcbn07XG5cblJvdmluZ1RhYkluZGV4Q29tcG9zZXIuZGVmYXVsdFByb3BzID0ge1xuICBvbkVzY2FwZUtleTogdW5kZWZpbmVkLFxuICBvcmllbnRhdGlvbjogJ2hvcml6b250YWwnXG59O1xuXG5Sb3ZpbmdUYWJJbmRleENvbXBvc2VyLnByb3BUeXBlcyA9IHtcbiAgb25Fc2NhcGVLZXk6IFByb3BUeXBlcy5mdW5jLFxuICBvcmllbnRhdGlvbjogUHJvcFR5cGVzLm9uZU9mKFsnaG9yaXpvbnRhbCcsICd2ZXJ0aWNhbCddKVxufTtcblxuZXhwb3J0IGRlZmF1bHQgUm92aW5nVGFiSW5kZXhDb21wb3NlcjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBRUE7Ozs7Ozs7O0FBTEE7QUFpQkEsSUFBTUEsc0JBQXNELEdBQUcsU0FBekRBLHNCQUF5RCxPQUE0QztFQUFBLElBQXpDQyxRQUF5QyxRQUF6Q0EsUUFBeUM7RUFBQSxJQUEvQkMsV0FBK0IsUUFBL0JBLFdBQStCO0VBQUEsSUFBbEJDLFdBQWtCLFFBQWxCQSxXQUFrQjtFQUN6RyxJQUFNQyxrQkFBa0IsR0FBRyxJQUFBQyxhQUFBLEVBQU8sQ0FBUCxDQUEzQjtFQUNBLElBQU1DLFdBQVcsR0FBRyxJQUFBRCxhQUFBLEVBQWtCLEVBQWxCLENBQXBCO0VBRUEsSUFBTUUsaUJBQWlCLEdBQUcsSUFBQUMsa0JBQUEsRUFBWSxZQUFNO0lBQzFDLElBQWlCQyxlQUFqQixHQUFxQ0wsa0JBQXJDLENBQVFNLE9BQVI7SUFFQUosV0FBVyxDQUFDSSxPQUFaLENBQW9CQyxP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