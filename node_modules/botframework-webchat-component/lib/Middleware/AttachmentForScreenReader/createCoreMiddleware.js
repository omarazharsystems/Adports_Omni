"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createCoreMiddleware;

var _react = _interopRequireDefault(require("react"));

var _AudioAttachment = _interopRequireDefault(require("./AudioAttachment"));

var _FileAttachment = _interopRequireDefault(require("./FileAttachment"));

var _ImageAttachment = _interopRequireDefault(require("./ImageAttachment"));

var _TextAttachment = _interopRequireDefault(require("./TextAttachment"));

var _VideoAttachment = _interopRequireDefault(require("./VideoAttachment"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function createCoreMiddleware() {
  return [function () {
    return function (next) {
      return function () {
        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        var _args$ = args[0],
            _args$$activity = _args$.activity;
        _args$$activity = _args$$activity === void 0 ? {} : _args$$activity;
        var _args$$activity$from = _args$$activity.from;
        _args$$activity$from = _args$$activity$from === void 0 ? {} : _args$$activity$from;
        var _args$$activity$from$ = _args$$activity$from.role,
            role = _args$$activity$from$ === void 0 ? undefined : _args$$activity$from$,
            attachment = _args$.attachment,
            _args$$attachment = _args$.attachment;
        _args$$attachment = _args$$attachment === void 0 ? {} : _args$$attachment;
        var _args$$attachment$con = _args$$attachment.contentType,
            contentType = _args$$attachment$con === void 0 ? undefined : _args$$attachment$con,
            _args$$attachment$con2 = _args$$attachment.contentUrl,
            contentUrl = _args$$attachment$con2 === void 0 ? undefined : _args$$attachment$con2,
            _args$$attachment$thu = _args$$attachment.thumbnailUrl,
            thumbnailUrl = _args$$attachment$thu === void 0 ? undefined : _args$$attachment$thu;
        var isText = /^text\//.test(contentType);
        return (isText ? !attachment.content : role === 'user' && !thumbnailUrl) ? function () {
          return /*#__PURE__*/_react.default.createElement(_FileAttachment.default, {
            attachment: attachment
          });
        } : /^audio\//.test(contentType) ? function () {
          return /*#__PURE__*/_react.default.createElement(_AudioAttachment.default, null);
        } : /^image\//.test(contentType) ? function () {
          return /*#__PURE__*/_react.default.createElement(_ImageAttachment.default, null);
        } : /^video\//.test(contentType) ? function () {
          return /*#__PURE__*/_react.default.createElement(_VideoAttachment.default, null);
        } : contentUrl || contentType === 'application/octet-stream' ? function () {
          return /*#__PURE__*/_react.default.createElement(_FileAttachment.default, {
            attachment: attachment
          });
        } : isText ? function () {
          return /*#__PURE__*/_react.default.createElement(_TextAttachment.default, {
            attachment: attachment
          });
        } : next.apply(void 0, args);
      };
    };
  }];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVDb3JlTWlkZGxld2FyZSIsIm5leHQiLCJhcmdzIiwiYWN0aXZpdHkiLCJmcm9tIiwicm9sZSIsInVuZGVmaW5lZCIsImF0dGFjaG1lbnQiLCJjb250ZW50VHlwZSIsImNvbnRlbnRVcmwiLCJ0aHVtYm5haWxVcmwiLCJpc1RleHQiLCJ0ZXN0IiwiY29udGVudCJdLCJzb3VyY2VSb290IjoiY29tcG9uZW50Oi8vLyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL01pZGRsZXdhcmUvQXR0YWNobWVudEZvclNjcmVlblJlYWRlci9jcmVhdGVDb3JlTWlkZGxld2FyZS50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXR0YWNobWVudEZvclNjcmVlblJlYWRlck1pZGRsZXdhcmUgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1hcGknO1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IEF1ZGlvQXR0YWNobWVudCBmcm9tICcuL0F1ZGlvQXR0YWNobWVudCc7XG5pbXBvcnQgRmlsZUF0dGFjaG1lbnQgZnJvbSAnLi9GaWxlQXR0YWNobWVudCc7XG5pbXBvcnQgSW1hZ2VBdHRhY2htZW50IGZyb20gJy4vSW1hZ2VBdHRhY2htZW50JztcbmltcG9ydCBUZXh0QXR0YWNobWVudCBmcm9tICcuL1RleHRBdHRhY2htZW50JztcbmltcG9ydCBWaWRlb0F0dGFjaG1lbnQgZnJvbSAnLi9WaWRlb0F0dGFjaG1lbnQnO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVDb3JlTWlkZGxld2FyZSgpOiBBdHRhY2htZW50Rm9yU2NyZWVuUmVhZGVyTWlkZGxld2FyZVtdIHtcbiAgcmV0dXJuIFtcbiAgICAoKSA9PlxuICAgICAgbmV4dCA9PlxuICAgICAgKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgY29uc3QgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGFjdGl2aXR5OiB7IGZyb206IHsgcm9sZSA9IHVuZGVmaW5lZCB9ID0ge30gfSA9IHt9LFxuICAgICAgICAgICAgYXR0YWNobWVudCxcbiAgICAgICAgICAgIGF0dGFjaG1lbnQ6IHsgY29udGVudFR5cGUgPSB1bmRlZmluZWQsIGNvbnRlbnRVcmwgPSB1bmRlZmluZWQsIHRodW1ibmFpbFVybCA9IHVuZGVmaW5lZCB9ID0ge31cbiAgICAgICAgICB9XG4gICAgICAgIF0gPSBhcmdzO1xuXG4gICAgICAgIGNvbnN0IGlzVGV4dCA9IC9edGV4dFxcLy91LnRlc3QoY29udGVudFR5cGUpO1xuXG4gICAgICAgIHJldHVybiAoaXNUZXh0ID8gIWF0dGFjaG1lbnQuY29udGVudCA6IHJvbGUgPT09ICd1c2VyJyAmJiAhdGh1bWJuYWlsVXJsKVxuICAgICAgICAgID8gKCkgPT4gPEZpbGVBdHRhY2htZW50IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICAgICAgOiAvXmF1ZGlvXFwvL3UudGVzdChjb250ZW50VHlwZSlcbiAgICAgICAgICA/ICgpID0+IDxBdWRpb0F0dGFjaG1lbnQgLz5cbiAgICAgICAgICA6IC9eaW1hZ2VcXC8vdS50ZXN0KGNvbnRlbnRUeXBlKVxuICAgICAgICAgID8gKCkgPT4gPEltYWdlQXR0YWNobWVudCAvPlxuICAgICAgICAgIDogL152aWRlb1xcLy91LnRlc3QoY29udGVudFR5cGUpXG4gICAgICAgICAgPyAoKSA9PiA8VmlkZW9BdHRhY2htZW50IC8+XG4gICAgICAgICAgOiBjb250ZW50VXJsIHx8IGNvbnRlbnRUeXBlID09PSAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJ1xuICAgICAgICAgID8gKCkgPT4gPEZpbGVBdHRhY2htZW50IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICAgICAgOiBpc1RleHRcbiAgICAgICAgICA/ICgpID0+IDxUZXh0QXR0YWNobWVudCBhdHRhY2htZW50PXthdHRhY2htZW50fSAvPlxuICAgICAgICAgIDogbmV4dCguLi5hcmdzKTtcbiAgICAgIH1cbiAgXTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRWUsU0FBU0Esb0JBQVQsR0FBdUU7RUFDcEYsT0FBTyxDQUNMO0lBQUEsT0FDRSxVQUFBQyxJQUFJO01BQUEsT0FDSixZQUFhO1FBQUEsa0NBQVRDLElBQVM7VUFBVEEsSUFBUztRQUFBOztRQUNYLGFBTUlBLElBTko7UUFBQSw2QkFFSUMsUUFGSjtRQUFBLCtDQUVvRCxFQUZwRDtRQUFBLDJDQUVnQkMsSUFGaEI7UUFBQSx5REFFNkMsRUFGN0M7UUFBQSxpREFFd0JDLElBRnhCO1FBQUEsSUFFd0JBLElBRnhCLHNDQUUrQkMsU0FGL0I7UUFBQSxJQUdJQyxVQUhKLFVBR0lBLFVBSEo7UUFBQSwrQkFJSUEsVUFKSjtRQUFBLG1EQUlnRyxFQUpoRztRQUFBLDhDQUlrQkMsV0FKbEI7UUFBQSxJQUlrQkEsV0FKbEIsc0NBSWdDRixTQUpoQztRQUFBLCtDQUkyQ0csVUFKM0M7UUFBQSxJQUkyQ0EsVUFKM0MsdUNBSXdESCxTQUp4RDtRQUFBLDhDQUltRUksWUFKbkU7UUFBQSxJQUltRUEsWUFKbkUsc0NBSWtGSixTQUpsRjtRQVFBLElBQU1LLE1BQU0sR0FBRyxVQUFXQyxJQUFYLENBQWdCSixXQUFoQixDQUFmO1FBRUEsT0FBTyxDQUFDRyxNQUFNLEdBQUcsQ0FBQ0osVUFBVSxDQUFDTSxPQUFmLEdBQXlCUixJQUFJLEtBQUssTUFBVCxJQUFtQixDQUFDSyxZQUFwRCxJQUNIO1VBQUEsb0JBQU0sNkJBQUMsdUJBQUQ7WUFBZ0IsVUFBVSxFQUFFSDtVQUE1QixFQUFOO1FBQUEsQ0FERyxHQUVILFdBQVlLLElBQVosQ0FBaUJKLFdBQWpCLElBQ0E7VUFBQSxvQkFBTSw2QkFBQyx3QkFBRCxPQUFOO1FBQUEsQ0FEQSxHQUVBLFdBQVlJLElBQVosQ0FBaUJKLFdBQWpCLElBQ0E7VUFBQSxvQkFBTSw2QkFBQyx3QkFBRCxPQUFOO1FBQUEsQ0FEQSxHQUVBLFdBQVlJLElBQVosQ0FBaUJKLFdBQWpCLElBQ0E7VUFBQSxvQkFBTSw2QkFBQyx3QkFBRCxPQUFOO1FBQUEsQ0FEQSxHQUVBQyxVQUFVLElBQUlELFdBQVcsS0FBSywwQkFBOUIsR0FDQTtVQUFBLG9CQUFNLDZCQUFDLHVCQUFEO1lBQWdCLFVBQVUsRUFBRUQ7VUFBNUIsRUFBTjtRQUFBLENBREEsR0FFQUksTUFBTSxHQUNOO1VBQUEsb0JBQU0sNkJBQUMsdUJBQUQ7WUFBZ0IsVUFBVSxFQUFFSjtVQUE1QixFQUFOO1FBQUEsQ0FETSxHQUVOTixJQUFJLE1BQUosU0FBUUMsSUFBUixDQVpKO01BYUQsQ0F6Qkc7SUFBQSxDQUROO0VBQUEsQ0FESyxDQUFQO0FBNkJEIn0=