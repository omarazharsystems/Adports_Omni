"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createCoreMiddleware;

var _react = _interopRequireDefault(require("react"));

var _AudioAttachment = _interopRequireDefault(require("../../Attachment/AudioAttachment"));

var _FileAttachment = _interopRequireDefault(require("../../Attachment/FileAttachment"));

var _ImageAttachment = _interopRequireDefault(require("../../Attachment/ImageAttachment"));

var _TextAttachment = _interopRequireDefault(require("../../Attachment/TextAttachment"));

var _VideoAttachment = _interopRequireDefault(require("../../Attachment/VideoAttachment"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// TODO: [P4] Rename this file or the whole middleware, it looks either too simple or too comprehensive now
function createCoreMiddleware() {
  return [function () {
    return function (next) {
      return function () {
        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        var _args$ = args[0],
            _args$$activity = _args$.activity,
            activity = _args$$activity === void 0 ? {} : _args$$activity,
            _args$$activity2 = _args$.activity;
        _args$$activity2 = _args$$activity2 === void 0 ? {} : _args$$activity2;
        var _args$$activity2$from = _args$$activity2.from;
        _args$$activity2$from = _args$$activity2$from === void 0 ? {} : _args$$activity2$from;
        var _args$$activity2$from2 = _args$$activity2$from.role,
            role = _args$$activity2$from2 === void 0 ? undefined : _args$$activity2$from2,
            attachment = _args$.attachment,
            _args$$attachment = _args$.attachment;
        _args$$attachment = _args$$attachment === void 0 ? {} : _args$$attachment;
        var _args$$attachment$con = _args$$attachment.contentType,
            contentType = _args$$attachment$con === void 0 ? undefined : _args$$attachment$con,
            _args$$attachment$con2 = _args$$attachment.contentUrl,
            contentUrl = _args$$attachment$con2 === void 0 ? undefined : _args$$attachment$con2,
            _args$$attachment$thu = _args$$attachment.thumbnailUrl,
            thumbnailUrl = _args$$attachment$thu === void 0 ? undefined : _args$$attachment$thu;
        var isText = /^text\//.test(contentType);
        return (isText ? !attachment.content : role === 'user' && !thumbnailUrl) ? /*#__PURE__*/_react.default.createElement(_FileAttachment.default, {
          activity: activity,
          attachment: attachment
        }) : /^audio\//.test(contentType) ? /*#__PURE__*/_react.default.createElement(_AudioAttachment.default, {
          attachment: attachment
        }) : /^image\//.test(contentType) ? /*#__PURE__*/_react.default.createElement(_ImageAttachment.default, {
          attachment: attachment
        }) : /^video\//.test(contentType) ? /*#__PURE__*/_react.default.createElement(_VideoAttachment.default, {
          attachment: attachment
        }) : contentUrl || contentType === 'application/octet-stream' ? /*#__PURE__*/_react.default.createElement(_FileAttachment.default, {
          activity: activity,
          attachment: attachment
        }) : isText ? /*#__PURE__*/_react.default.createElement(_TextAttachment.default, {
          attachment: attachment
        }) : next.apply(void 0, args);
      };
    };
  }];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVDb3JlTWlkZGxld2FyZSIsIm5leHQiLCJhcmdzIiwiYWN0aXZpdHkiLCJmcm9tIiwicm9sZSIsInVuZGVmaW5lZCIsImF0dGFjaG1lbnQiLCJjb250ZW50VHlwZSIsImNvbnRlbnRVcmwiLCJ0aHVtYm5haWxVcmwiLCJpc1RleHQiLCJ0ZXN0IiwiY29udGVudCJdLCJzb3VyY2VSb290IjoiY29tcG9uZW50Oi8vLyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL01pZGRsZXdhcmUvQXR0YWNobWVudC9jcmVhdGVDb3JlTWlkZGxld2FyZS50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXR0YWNobWVudE1pZGRsZXdhcmUgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1hcGknO1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IEF1ZGlvQXR0YWNobWVudCBmcm9tICcuLi8uLi9BdHRhY2htZW50L0F1ZGlvQXR0YWNobWVudCc7XG5pbXBvcnQgRmlsZUF0dGFjaG1lbnQgZnJvbSAnLi4vLi4vQXR0YWNobWVudC9GaWxlQXR0YWNobWVudCc7XG5pbXBvcnQgSW1hZ2VBdHRhY2htZW50IGZyb20gJy4uLy4uL0F0dGFjaG1lbnQvSW1hZ2VBdHRhY2htZW50JztcbmltcG9ydCBUZXh0QXR0YWNobWVudCBmcm9tICcuLi8uLi9BdHRhY2htZW50L1RleHRBdHRhY2htZW50JztcbmltcG9ydCBWaWRlb0F0dGFjaG1lbnQgZnJvbSAnLi4vLi4vQXR0YWNobWVudC9WaWRlb0F0dGFjaG1lbnQnO1xuXG4vLyBUT0RPOiBbUDRdIFJlbmFtZSB0aGlzIGZpbGUgb3IgdGhlIHdob2xlIG1pZGRsZXdhcmUsIGl0IGxvb2tzIGVpdGhlciB0b28gc2ltcGxlIG9yIHRvbyBjb21wcmVoZW5zaXZlIG5vd1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY3JlYXRlQ29yZU1pZGRsZXdhcmUoKTogQXR0YWNobWVudE1pZGRsZXdhcmVbXSB7XG4gIHJldHVybiBbXG4gICAgKCkgPT5cbiAgICAgIG5leHQgPT5cbiAgICAgICguLi5hcmdzKSA9PiB7XG4gICAgICAgIGNvbnN0IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBhY3Rpdml0eSA9IHt9LFxuICAgICAgICAgICAgYWN0aXZpdHk6IHsgZnJvbTogeyByb2xlID0gdW5kZWZpbmVkIH0gPSB7fSB9ID0ge30sXG4gICAgICAgICAgICBhdHRhY2htZW50LFxuICAgICAgICAgICAgYXR0YWNobWVudDogeyBjb250ZW50VHlwZSA9IHVuZGVmaW5lZCwgY29udGVudFVybCA9IHVuZGVmaW5lZCwgdGh1bWJuYWlsVXJsID0gdW5kZWZpbmVkIH0gPSB7fVxuICAgICAgICAgIH1cbiAgICAgICAgXSA9IGFyZ3M7XG5cbiAgICAgICAgY29uc3QgaXNUZXh0ID0gL150ZXh0XFwvL3UudGVzdChjb250ZW50VHlwZSk7XG5cbiAgICAgICAgcmV0dXJuIChpc1RleHQgPyAhYXR0YWNobWVudC5jb250ZW50IDogcm9sZSA9PT0gJ3VzZXInICYmICF0aHVtYm5haWxVcmwpID8gKFxuICAgICAgICAgIDxGaWxlQXR0YWNobWVudCBhY3Rpdml0eT17YWN0aXZpdHl9IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICAgICkgOiAvXmF1ZGlvXFwvL3UudGVzdChjb250ZW50VHlwZSkgPyAoXG4gICAgICAgICAgPEF1ZGlvQXR0YWNobWVudCBhdHRhY2htZW50PXthdHRhY2htZW50fSAvPlxuICAgICAgICApIDogL15pbWFnZVxcLy91LnRlc3QoY29udGVudFR5cGUpID8gKFxuICAgICAgICAgIDxJbWFnZUF0dGFjaG1lbnQgYXR0YWNobWVudD17YXR0YWNobWVudH0gLz5cbiAgICAgICAgKSA6IC9edmlkZW9cXC8vdS50ZXN0KGNvbnRlbnRUeXBlKSA/IChcbiAgICAgICAgICA8VmlkZW9BdHRhY2htZW50IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICAgICkgOiBjb250ZW50VXJsIHx8IGNvbnRlbnRUeXBlID09PSAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyA/IChcbiAgICAgICAgICA8RmlsZUF0dGFjaG1lbnQgYWN0aXZpdHk9e2FjdGl2aXR5fSBhdHRhY2htZW50PXthdHRhY2htZW50fSAvPlxuICAgICAgICApIDogaXNUZXh0ID8gKFxuICAgICAgICAgIDxUZXh0QXR0YWNobWVudCBhdHRhY2htZW50PXthdHRhY2htZW50fSAvPlxuICAgICAgICApIDogKFxuICAgICAgICAgIG5leHQoLi4uYXJncylcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgXTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUE7QUFDZSxTQUFTQSxvQkFBVCxHQUF3RDtFQUNyRSxPQUFPLENBQ0w7SUFBQSxPQUNFLFVBQUFDLElBQUk7TUFBQSxPQUNKLFlBQWE7UUFBQSxrQ0FBVEMsSUFBUztVQUFUQSxJQUFTO1FBQUE7O1FBQ1gsYUFPSUEsSUFQSjtRQUFBLDZCQUVJQyxRQUZKO1FBQUEsSUFFSUEsUUFGSixnQ0FFZSxFQUZmO1FBQUEsOEJBR0lBLFFBSEo7UUFBQSxpREFHb0QsRUFIcEQ7UUFBQSw2Q0FHZ0JDLElBSGhCO1FBQUEsMkRBRzZDLEVBSDdDO1FBQUEsbURBR3dCQyxJQUh4QjtRQUFBLElBR3dCQSxJQUh4Qix1Q0FHK0JDLFNBSC9CO1FBQUEsSUFJSUMsVUFKSixVQUlJQSxVQUpKO1FBQUEsK0JBS0lBLFVBTEo7UUFBQSxtREFLZ0csRUFMaEc7UUFBQSw4Q0FLa0JDLFdBTGxCO1FBQUEsSUFLa0JBLFdBTGxCLHNDQUtnQ0YsU0FMaEM7UUFBQSwrQ0FLMkNHLFVBTDNDO1FBQUEsSUFLMkNBLFVBTDNDLHVDQUt3REgsU0FMeEQ7UUFBQSw4Q0FLbUVJLFlBTG5FO1FBQUEsSUFLbUVBLFlBTG5FLHNDQUtrRkosU0FMbEY7UUFTQSxJQUFNSyxNQUFNLEdBQUcsVUFBV0MsSUFBWCxDQUFnQkosV0FBaEIsQ0FBZjtRQUVBLE9BQU8sQ0FBQ0csTUFBTSxHQUFHLENBQUNKLFVBQVUsQ0FBQ00sT0FBZixHQUF5QlIsSUFBSSxLQUFLLE1BQVQsSUFBbUIsQ0FBQ0ssWUFBcEQsaUJBQ0wsNkJBQUMsdUJBQUQ7VUFBZ0IsUUFBUSxFQUFFUCxRQUExQjtVQUFvQyxVQUFVLEVBQUVJO1FBQWhELEVBREssR0FFSCxXQUFZSyxJQUFaLENBQWlCSixXQUFqQixpQkFDRiw2QkFBQyx3QkFBRDtVQUFpQixVQUFVLEVBQUVEO1FBQTdCLEVBREUsR0FFQSxXQUFZSyxJQUFaLENBQWlCSixXQUFqQixpQkFDRiw2QkFBQyx3QkFBRDtVQUFpQixVQUFVLEVBQUVEO1FBQTdCLEVBREUsR0FFQSxXQUFZSyxJQUFaLENBQWlCSixXQUFqQixpQkFDRiw2QkFBQyx3QkFBRDtVQUFpQixVQUFVLEVBQUVEO1FBQTdCLEVBREUsR0FFQUUsVUFBVSxJQUFJRCxXQUFXLEtBQUssMEJBQTlCLGdCQUNGLDZCQUFDLHVCQUFEO1VBQWdCLFFBQVEsRUFBRUwsUUFBMUI7VUFBb0MsVUFBVSxFQUFFSTtRQUFoRCxFQURFLEdBRUFJLE1BQU0sZ0JBQ1IsNkJBQUMsdUJBQUQ7VUFBZ0IsVUFBVSxFQUFFSjtRQUE1QixFQURRLEdBR1JOLElBQUksTUFBSixTQUFRQyxJQUFSLENBYkY7TUFlRCxDQTVCRztJQUFBLENBRE47RUFBQSxDQURLLENBQVA7QUFnQ0QifQ==