"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.connectSuggestedAction = void 0;

var _botframeworkWebchatApi = require("botframework-webchat-api");

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _AccessibleButton = _interopRequireDefault(require("../Utils/AccessibleButton"));

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _useFocus = _interopRequireDefault(require("../hooks/useFocus"));

var _useFocusAccessKeyEffect = _interopRequireDefault(require("../Utils/AccessKeySink/useFocusAccessKeyEffect"));

var _useFocusVisible3 = _interopRequireDefault(require("../hooks/internal/useFocusVisible"));

var _useItemRef = _interopRequireDefault(require("../providers/RovingTabIndex/useItemRef"));

var _useLocalizeAccessKey = _interopRequireDefault(require("../hooks/internal/useLocalizeAccessKey"));

var _useScrollToEnd = _interopRequireDefault(require("../hooks/useScrollToEnd"));

var _useStyleSet3 = _interopRequireDefault(require("../hooks/useStyleSet"));

var _useStyleToEmotionObject = _interopRequireDefault(require("../hooks/internal/useStyleToEmotionObject"));

var _useSuggestedActionsAccessKey = _interopRequireDefault(require("../hooks/internal/useSuggestedActionsAccessKey"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var useDirection = _botframeworkWebchatApi.hooks.useDirection,
    useDisabled = _botframeworkWebchatApi.hooks.useDisabled,
    usePerformCardAction = _botframeworkWebchatApi.hooks.usePerformCardAction,
    useStyleOptions = _botframeworkWebchatApi.hooks.useStyleOptions,
    useSuggestedActions = _botframeworkWebchatApi.hooks.useSuggestedActions;
var ROOT_STYLE = {
  '&.webchat__suggested-action': {
    display: 'flex',
    overflow: 'hidden' // Prevent image from leaking; object-fit does not work with IE11

  }
};

var connectSuggestedAction = function connectSuggestedAction() {
  for (var _len = arguments.length, selectors = new Array(_len), _key = 0; _key < _len; _key++) {
    selectors[_key] = arguments[_key];
  }

  return _connectToWebChat.default.apply(void 0, [function (_ref, _ref2) {
    var clearSuggestedActions = _ref.clearSuggestedActions,
        disabled = _ref.disabled,
        language = _ref.language,
        onCardAction = _ref.onCardAction;
    var displayText = _ref2.displayText,
        text = _ref2.text,
        type = _ref2.type,
        value = _ref2.value;
    return {
      click: function click() {
        onCardAction({
          displayText: displayText,
          text: text,
          type: type,
          value: value
        });
        type === 'openUrl' && clearSuggestedActions();
      },
      disabled: disabled,
      language: language
    };
  }].concat(selectors));
};

exports.connectSuggestedAction = connectSuggestedAction;

var SuggestedAction = function SuggestedAction(_ref3) {
  var buttonText = _ref3.buttonText,
      className = _ref3.className,
      displayText = _ref3.displayText,
      image = _ref3.image,
      imageAlt = _ref3.imageAlt,
      itemIndex = _ref3.itemIndex,
      text = _ref3.text,
      textClassName = _ref3.textClassName,
      type = _ref3.type,
      value = _ref3.value;

  var _useSuggestedActions = useSuggestedActions(),
      _useSuggestedActions2 = _slicedToArray(_useSuggestedActions, 2),
      _ = _useSuggestedActions2[0],
      setSuggestedActions = _useSuggestedActions2[1];

  var _useStyleOptions = useStyleOptions(),
      _useStyleOptions2 = _slicedToArray(_useStyleOptions, 1),
      suggestedActionsStackedLayoutButtonTextWrap = _useStyleOptions2[0].suggestedActionsStackedLayoutButtonTextWrap;

  var _useStyleSet = (0, _useStyleSet3.default)(),
      _useStyleSet2 = _slicedToArray(_useStyleSet, 1),
      suggestedActionStyleSet = _useStyleSet2[0].suggestedAction;

  var _useSuggestedActionsA = (0, _useSuggestedActionsAccessKey.default)(),
      _useSuggestedActionsA2 = _slicedToArray(_useSuggestedActionsA, 1),
      accessKey = _useSuggestedActionsA2[0];

  var _useDirection = useDirection(),
      _useDirection2 = _slicedToArray(_useDirection, 1),
      direction = _useDirection2[0];

  var _useDisabled = useDisabled(),
      _useDisabled2 = _slicedToArray(_useDisabled, 1),
      disabled = _useDisabled2[0];

  var focus = (0, _useFocus.default)();
  var focusRef = (0, _useItemRef.default)(itemIndex);
  var localizeAccessKeyAsAriaKeyShortcuts = (0, _useLocalizeAccessKey.default)('aria-keyshortcuts');
  var performCardAction = usePerformCardAction();
  var rootClassName = (0, _useStyleToEmotionObject.default)()(ROOT_STYLE) + '';
  var scrollToEnd = (0, _useScrollToEnd.default)();

  var _useFocusVisible = (0, _useFocusVisible3.default)(focusRef),
      _useFocusVisible2 = _slicedToArray(_useFocusVisible, 1),
      focusVisible = _useFocusVisible2[0];

  var handleClick = (0, _react.useCallback)(function (_ref4) {
    var target = _ref4.target;
    // TODO: [P3] #XXX We should not destruct DirectLineCardAction into React props and pass them in. It makes typings difficult.
    //       Instead, we should pass a "cardAction" props.
    performCardAction({
      displayText: displayText,
      text: text,
      type: type,
      value: value
    }, {
      target: target
    }); // Since "openUrl" action do not submit, the suggested action buttons do not hide after click.

    type === 'openUrl' && setSuggestedActions([]);
    focus('sendBoxWithoutKeyboard');
    scrollToEnd();
  }, [displayText, focus, performCardAction, scrollToEnd, setSuggestedActions, text, type, value]);
  (0, _useFocusAccessKeyEffect.default)(accessKey, focusRef);
  return /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, _extends({}, accessKey ? {
    'aria-keyshortcuts': localizeAccessKeyAsAriaKeyShortcuts(accessKey)
  } : {}, {
    className: (0, _classnames.default)('webchat__suggested-action', {
      'webchat__suggested-action--focus-visible': focusVisible,
      'webchat__suggested-action--rtl': direction === 'rtl',
      'webchat__suggested-action--wrapping': suggestedActionsStackedLayoutButtonTextWrap
    }, rootClassName, suggestedActionStyleSet + '', (className || '') + ''),
    disabled: disabled,
    onClick: handleClick,
    ref: focusRef,
    type: "button"
  }), image && /*#__PURE__*/_react.default.createElement("img", {
    alt: imageAlt,
    className: (0, _classnames.default)('webchat__suggested-action__image', direction === 'rtl' && 'webchat__suggested-action__image--rtl'),
    src: image
  }), /*#__PURE__*/_react.default.createElement("span", {
    className: (0, _classnames.default)('webchat__suggested-action__text', (textClassName || '') + '')
  }, buttonText), /*#__PURE__*/_react.default.createElement("div", {
    className: "webchat__suggested-action__keyboard-focus-indicator"
  }));
};

SuggestedAction.defaultProps = {
  className: '',
  displayText: '',
  image: '',
  imageAlt: undefined,
  text: '',
  textClassName: '',
  type: undefined,
  value: undefined
};
SuggestedAction.propTypes = {
  buttonText: _propTypes.default.string.isRequired,
  className: _propTypes.default.string,
  displayText: _propTypes.default.string,
  image: _propTypes.default.string,
  imageAlt: _propTypes.default.string,
  itemIndex: _propTypes.default.number.isRequired,
  text: _propTypes.default.string,
  textClassName: _propTypes.default.string,
  // TypeScript class is not mappable to PropTypes.
  // @ts-ignore
  type: _propTypes.default.string,
  value: _propTypes.default.any
};
var _default = SuggestedAction;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ1c2VEaXJlY3Rpb24iLCJob29rcyIsInVzZURpc2FibGVkIiwidXNlUGVyZm9ybUNhcmRBY3Rpb24iLCJ1c2VTdHlsZU9wdGlvbnMiLCJ1c2VTdWdnZXN0ZWRBY3Rpb25zIiwiUk9PVF9TVFlMRSIsImRpc3BsYXkiLCJvdmVyZmxvdyIsImNvbm5lY3RTdWdnZXN0ZWRBY3Rpb24iLCJzZWxlY3RvcnMiLCJjb25uZWN0VG9XZWJDaGF0IiwiY2xlYXJTdWdnZXN0ZWRBY3Rpb25zIiwiZGlzYWJsZWQiLCJsYW5ndWFnZSIsIm9uQ2FyZEFjdGlvbiIsImRpc3BsYXlUZXh0IiwidGV4dCIsInR5cGUiLCJ2YWx1ZSIsImNsaWNrIiwiU3VnZ2VzdGVkQWN0aW9uIiwiYnV0dG9uVGV4dCIsImNsYXNzTmFtZSIsImltYWdlIiwiaW1hZ2VBbHQiLCJpdGVtSW5kZXgiLCJ0ZXh0Q2xhc3NOYW1lIiwiXyIsInNldFN1Z2dlc3RlZEFjdGlvbnMiLCJzdWdnZXN0ZWRBY3Rpb25zU3RhY2tlZExheW91dEJ1dHRvblRleHRXcmFwIiwidXNlU3R5bGVTZXQiLCJzdWdnZXN0ZWRBY3Rpb25TdHlsZVNldCIsInN1Z2dlc3RlZEFjdGlvbiIsInVzZVN1Z2dlc3RlZEFjdGlvbnNBY2Nlc3NLZXkiLCJhY2Nlc3NLZXkiLCJkaXJlY3Rpb24iLCJmb2N1cyIsInVzZUZvY3VzIiwiZm9jdXNSZWYiLCJ1c2VJdGVtUmVmIiwibG9jYWxpemVBY2Nlc3NLZXlBc0FyaWFLZXlTaG9ydGN1dHMiLCJ1c2VMb2NhbGl6ZUFjY2Vzc0tleSIsInBlcmZvcm1DYXJkQWN0aW9uIiwicm9vdENsYXNzTmFtZSIsInVzZVN0eWxlVG9FbW90aW9uT2JqZWN0Iiwic2Nyb2xsVG9FbmQiLCJ1c2VTY3JvbGxUb0VuZCIsInVzZUZvY3VzVmlzaWJsZSIsImZvY3VzVmlzaWJsZSIsImhhbmRsZUNsaWNrIiwidXNlQ2FsbGJhY2siLCJ0YXJnZXQiLCJ1c2VGb2N1c0FjY2Vzc0tleUVmZmVjdCIsImNsYXNzTmFtZXMiLCJkZWZhdWx0UHJvcHMiLCJ1bmRlZmluZWQiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJzdHJpbmciLCJpc1JlcXVpcmVkIiwibnVtYmVyIiwiYW55Il0sInNvdXJjZVJvb3QiOiJjb21wb25lbnQ6Ly8vIiwic291cmNlcyI6WyIuLi8uLi9zcmMvU2VuZEJveC9TdWdnZXN0ZWRBY3Rpb24udHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGhvb2tzIH0gZnJvbSAnYm90ZnJhbWV3b3JrLXdlYmNoYXQtYXBpJztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBSZWFjdCwgeyBNb3VzZUV2ZW50SGFuZGxlciwgdXNlQ2FsbGJhY2ssIFZGQyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB0eXBlIHsgRGlyZWN0TGluZUNhcmRBY3Rpb24gfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1jb3JlJztcblxuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSAnLi4vVXRpbHMvQWNjZXNzaWJsZUJ1dHRvbic7XG5pbXBvcnQgY29ubmVjdFRvV2ViQ2hhdCBmcm9tICcuLi9jb25uZWN0VG9XZWJDaGF0JztcbmltcG9ydCB1c2VGb2N1cyBmcm9tICcuLi9ob29rcy91c2VGb2N1cyc7XG5pbXBvcnQgdXNlRm9jdXNBY2Nlc3NLZXlFZmZlY3QgZnJvbSAnLi4vVXRpbHMvQWNjZXNzS2V5U2luay91c2VGb2N1c0FjY2Vzc0tleUVmZmVjdCc7XG5pbXBvcnQgdXNlRm9jdXNWaXNpYmxlIGZyb20gJy4uL2hvb2tzL2ludGVybmFsL3VzZUZvY3VzVmlzaWJsZSc7XG5pbXBvcnQgdXNlSXRlbVJlZiBmcm9tICcuLi9wcm92aWRlcnMvUm92aW5nVGFiSW5kZXgvdXNlSXRlbVJlZic7XG5pbXBvcnQgdXNlTG9jYWxpemVBY2Nlc3NLZXkgZnJvbSAnLi4vaG9va3MvaW50ZXJuYWwvdXNlTG9jYWxpemVBY2Nlc3NLZXknO1xuaW1wb3J0IHVzZVNjcm9sbFRvRW5kIGZyb20gJy4uL2hvb2tzL3VzZVNjcm9sbFRvRW5kJztcbmltcG9ydCB1c2VTdHlsZVNldCBmcm9tICcuLi9ob29rcy91c2VTdHlsZVNldCc7XG5pbXBvcnQgdXNlU3R5bGVUb0Vtb3Rpb25PYmplY3QgZnJvbSAnLi4vaG9va3MvaW50ZXJuYWwvdXNlU3R5bGVUb0Vtb3Rpb25PYmplY3QnO1xuaW1wb3J0IHVzZVN1Z2dlc3RlZEFjdGlvbnNBY2Nlc3NLZXkgZnJvbSAnLi4vaG9va3MvaW50ZXJuYWwvdXNlU3VnZ2VzdGVkQWN0aW9uc0FjY2Vzc0tleSc7XG5cbmNvbnN0IHsgdXNlRGlyZWN0aW9uLCB1c2VEaXNhYmxlZCwgdXNlUGVyZm9ybUNhcmRBY3Rpb24sIHVzZVN0eWxlT3B0aW9ucywgdXNlU3VnZ2VzdGVkQWN0aW9ucyB9ID0gaG9va3M7XG5cbmNvbnN0IFJPT1RfU1RZTEUgPSB7XG4gICcmLndlYmNoYXRfX3N1Z2dlc3RlZC1hY3Rpb24nOiB7XG4gICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgIG92ZXJmbG93OiAnaGlkZGVuJyAvLyBQcmV2ZW50IGltYWdlIGZyb20gbGVha2luZzsgb2JqZWN0LWZpdCBkb2VzIG5vdCB3b3JrIHdpdGggSUUxMVxuICB9XG59O1xuXG5jb25zdCBjb25uZWN0U3VnZ2VzdGVkQWN0aW9uID0gKC4uLnNlbGVjdG9ycykgPT5cbiAgY29ubmVjdFRvV2ViQ2hhdChcbiAgICAoeyBjbGVhclN1Z2dlc3RlZEFjdGlvbnMsIGRpc2FibGVkLCBsYW5ndWFnZSwgb25DYXJkQWN0aW9uIH0sIHsgZGlzcGxheVRleHQsIHRleHQsIHR5cGUsIHZhbHVlIH0pID0+ICh7XG4gICAgICBjbGljazogKCkgPT4ge1xuICAgICAgICBvbkNhcmRBY3Rpb24oeyBkaXNwbGF5VGV4dCwgdGV4dCwgdHlwZSwgdmFsdWUgfSk7XG4gICAgICAgIHR5cGUgPT09ICdvcGVuVXJsJyAmJiBjbGVhclN1Z2dlc3RlZEFjdGlvbnMoKTtcbiAgICAgIH0sXG4gICAgICBkaXNhYmxlZCxcbiAgICAgIGxhbmd1YWdlXG4gICAgfSksXG4gICAgLi4uc2VsZWN0b3JzXG4gICk7XG5cbnR5cGUgU3VnZ2VzdGVkQWN0aW9uUHJvcHMgPSB7XG4gIGJ1dHRvblRleHQ6IHN0cmluZztcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICBkaXNwbGF5VGV4dD86IHN0cmluZztcbiAgaW1hZ2U/OiBzdHJpbmc7XG4gIGltYWdlQWx0Pzogc3RyaW5nO1xuICBpdGVtSW5kZXg6IG51bWJlcjtcbiAgdGV4dD86IHN0cmluZztcbiAgdGV4dENsYXNzTmFtZT86IHN0cmluZztcbiAgdHlwZT86XG4gICAgfCAnY2FsbCdcbiAgICB8ICdkb3dubG9hZEZpbGUnXG4gICAgfCAnaW1CYWNrJ1xuICAgIHwgJ21lc3NhZ2VCYWNrJ1xuICAgIHwgJ29wZW5VcmwnXG4gICAgfCAncGxheUF1ZGlvJ1xuICAgIHwgJ3BsYXlWaWRlbydcbiAgICB8ICdwb3N0QmFjaydcbiAgICB8ICdzaG93SW1hZ2UnXG4gICAgfCAnc2lnbmluJztcbiAgdmFsdWU/OiBhbnk7XG59O1xuXG5jb25zdCBTdWdnZXN0ZWRBY3Rpb246IFZGQzxTdWdnZXN0ZWRBY3Rpb25Qcm9wcz4gPSAoe1xuICBidXR0b25UZXh0LFxuICBjbGFzc05hbWUsXG4gIGRpc3BsYXlUZXh0LFxuICBpbWFnZSxcbiAgaW1hZ2VBbHQsXG4gIGl0ZW1JbmRleCxcbiAgdGV4dCxcbiAgdGV4dENsYXNzTmFtZSxcbiAgdHlwZSxcbiAgdmFsdWVcbn0pID0+IHtcbiAgY29uc3QgW18sIHNldFN1Z2dlc3RlZEFjdGlvbnNdID0gdXNlU3VnZ2VzdGVkQWN0aW9ucygpO1xuICBjb25zdCBbeyBzdWdnZXN0ZWRBY3Rpb25zU3RhY2tlZExheW91dEJ1dHRvblRleHRXcmFwIH1dID0gdXNlU3R5bGVPcHRpb25zKCk7XG4gIGNvbnN0IFt7IHN1Z2dlc3RlZEFjdGlvbjogc3VnZ2VzdGVkQWN0aW9uU3R5bGVTZXQgfV0gPSB1c2VTdHlsZVNldCgpO1xuICBjb25zdCBbYWNjZXNzS2V5XSA9IHVzZVN1Z2dlc3RlZEFjdGlvbnNBY2Nlc3NLZXkoKTtcbiAgY29uc3QgW2RpcmVjdGlvbl0gPSB1c2VEaXJlY3Rpb24oKTtcbiAgY29uc3QgW2Rpc2FibGVkXSA9IHVzZURpc2FibGVkKCk7XG4gIGNvbnN0IGZvY3VzID0gdXNlRm9jdXMoKTtcbiAgY29uc3QgZm9jdXNSZWYgPSB1c2VJdGVtUmVmPEhUTUxCdXR0b25FbGVtZW50PihpdGVtSW5kZXgpO1xuICBjb25zdCBsb2NhbGl6ZUFjY2Vzc0tleUFzQXJpYUtleVNob3J0Y3V0cyA9IHVzZUxvY2FsaXplQWNjZXNzS2V5KCdhcmlhLWtleXNob3J0Y3V0cycpO1xuICBjb25zdCBwZXJmb3JtQ2FyZEFjdGlvbiA9IHVzZVBlcmZvcm1DYXJkQWN0aW9uKCk7XG4gIGNvbnN0IHJvb3RDbGFzc05hbWUgPSB1c2VTdHlsZVRvRW1vdGlvbk9iamVjdCgpKFJPT1RfU1RZTEUpICsgJyc7XG4gIGNvbnN0IHNjcm9sbFRvRW5kID0gdXNlU2Nyb2xsVG9FbmQoKTtcblxuICBjb25zdCBbZm9jdXNWaXNpYmxlXSA9IHVzZUZvY3VzVmlzaWJsZShmb2N1c1JlZik7XG5cbiAgY29uc3QgaGFuZGxlQ2xpY2sgPSB1c2VDYWxsYmFjazxNb3VzZUV2ZW50SGFuZGxlcjxIVE1MQnV0dG9uRWxlbWVudD4+KFxuICAgICh7IHRhcmdldCB9KSA9PiB7XG4gICAgICAvLyBUT0RPOiBbUDNdICNYWFggV2Ugc2hvdWxkIG5vdCBkZXN0cnVjdCBEaXJlY3RMaW5lQ2FyZEFjdGlvbiBpbnRvIFJlYWN0IHByb3BzIGFuZCBwYXNzIHRoZW0gaW4uIEl0IG1ha2VzIHR5cGluZ3MgZGlmZmljdWx0LlxuICAgICAgLy8gICAgICAgSW5zdGVhZCwgd2Ugc2hvdWxkIHBhc3MgYSBcImNhcmRBY3Rpb25cIiBwcm9wcy5cbiAgICAgIHBlcmZvcm1DYXJkQWN0aW9uKHsgZGlzcGxheVRleHQsIHRleHQsIHR5cGUsIHZhbHVlIH0gYXMgRGlyZWN0TGluZUNhcmRBY3Rpb24sIHsgdGFyZ2V0IH0pO1xuXG4gICAgICAvLyBTaW5jZSBcIm9wZW5VcmxcIiBhY3Rpb24gZG8gbm90IHN1Ym1pdCwgdGhlIHN1Z2dlc3RlZCBhY3Rpb24gYnV0dG9ucyBkbyBub3QgaGlkZSBhZnRlciBjbGljay5cbiAgICAgIHR5cGUgPT09ICdvcGVuVXJsJyAmJiBzZXRTdWdnZXN0ZWRBY3Rpb25zKFtdKTtcblxuICAgICAgZm9jdXMoJ3NlbmRCb3hXaXRob3V0S2V5Ym9hcmQnKTtcbiAgICAgIHNjcm9sbFRvRW5kKCk7XG4gICAgfSxcbiAgICBbZGlzcGxheVRleHQsIGZvY3VzLCBwZXJmb3JtQ2FyZEFjdGlvbiwgc2Nyb2xsVG9FbmQsIHNldFN1Z2dlc3RlZEFjdGlvbnMsIHRleHQsIHR5cGUsIHZhbHVlXVxuICApO1xuXG4gIHVzZUZvY3VzQWNjZXNzS2V5RWZmZWN0KGFjY2Vzc0tleSwgZm9jdXNSZWYpO1xuXG4gIHJldHVybiAoXG4gICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgIHsuLi4oYWNjZXNzS2V5ID8geyAnYXJpYS1rZXlzaG9ydGN1dHMnOiBsb2NhbGl6ZUFjY2Vzc0tleUFzQXJpYUtleVNob3J0Y3V0cyhhY2Nlc3NLZXkpIH0gOiB7fSl9XG4gICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXG4gICAgICAgICd3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uJyxcbiAgICAgICAge1xuICAgICAgICAgICd3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uLS1mb2N1cy12aXNpYmxlJzogZm9jdXNWaXNpYmxlLFxuICAgICAgICAgICd3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uLS1ydGwnOiBkaXJlY3Rpb24gPT09ICdydGwnLFxuICAgICAgICAgICd3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uLS13cmFwcGluZyc6IHN1Z2dlc3RlZEFjdGlvbnNTdGFja2VkTGF5b3V0QnV0dG9uVGV4dFdyYXBcbiAgICAgICAgfSxcbiAgICAgICAgcm9vdENsYXNzTmFtZSxcbiAgICAgICAgc3VnZ2VzdGVkQWN0aW9uU3R5bGVTZXQgKyAnJyxcbiAgICAgICAgKGNsYXNzTmFtZSB8fCAnJykgKyAnJ1xuICAgICAgKX1cbiAgICAgIGRpc2FibGVkPXtkaXNhYmxlZH1cbiAgICAgIG9uQ2xpY2s9e2hhbmRsZUNsaWNrfVxuICAgICAgcmVmPXtmb2N1c1JlZn1cbiAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgID5cbiAgICAgIHtpbWFnZSAmJiAoXG4gICAgICAgIDxpbWdcbiAgICAgICAgICBhbHQ9e2ltYWdlQWx0fVxuICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcbiAgICAgICAgICAgICd3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uX19pbWFnZScsXG4gICAgICAgICAgICBkaXJlY3Rpb24gPT09ICdydGwnICYmICd3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uX19pbWFnZS0tcnRsJ1xuICAgICAgICAgICl9XG4gICAgICAgICAgc3JjPXtpbWFnZX1cbiAgICAgICAgLz5cbiAgICAgICl9XG4gICAgICA8c3BhbiBjbGFzc05hbWU9e2NsYXNzTmFtZXMoJ3dlYmNoYXRfX3N1Z2dlc3RlZC1hY3Rpb25fX3RleHQnLCAodGV4dENsYXNzTmFtZSB8fCAnJykgKyAnJyl9PntidXR0b25UZXh0fTwvc3Bhbj5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwid2ViY2hhdF9fc3VnZ2VzdGVkLWFjdGlvbl9fa2V5Ym9hcmQtZm9jdXMtaW5kaWNhdG9yXCIgLz5cbiAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICk7XG59O1xuXG5TdWdnZXN0ZWRBY3Rpb24uZGVmYXVsdFByb3BzID0ge1xuICBjbGFzc05hbWU6ICcnLFxuICBkaXNwbGF5VGV4dDogJycsXG4gIGltYWdlOiAnJyxcbiAgaW1hZ2VBbHQ6IHVuZGVmaW5lZCxcbiAgdGV4dDogJycsXG4gIHRleHRDbGFzc05hbWU6ICcnLFxuICB0eXBlOiB1bmRlZmluZWQsXG4gIHZhbHVlOiB1bmRlZmluZWRcbn07XG5cblN1Z2dlc3RlZEFjdGlvbi5wcm9wVHlwZXMgPSB7XG4gIGJ1dHRvblRleHQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBkaXNwbGF5VGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgaW1hZ2U6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGltYWdlQWx0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICBpdGVtSW5kZXg6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgdGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgdGV4dENsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgLy8gVHlwZVNjcmlwdCBjbGFzcyBpcyBub3QgbWFwcGFibGUgdG8gUHJvcFR5cGVzLlxuICAvLyBAdHMtaWdub3JlXG4gIHR5cGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHZhbHVlOiBQcm9wVHlwZXMuYW55XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTdWdnZXN0ZWRBY3Rpb247XG5cbmV4cG9ydCB7IGNvbm5lY3RTdWdnZXN0ZWRBY3Rpb24gfTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxJQUFRQSxZQUFSLEdBQWtHQyw2QkFBbEcsQ0FBUUQsWUFBUjtBQUFBLElBQXNCRSxXQUF0QixHQUFrR0QsNkJBQWxHLENBQXNCQyxXQUF0QjtBQUFBLElBQW1DQyxvQkFBbkMsR0FBa0dGLDZCQUFsRyxDQUFtQ0Usb0JBQW5DO0FBQUEsSUFBeURDLGVBQXpELEdBQWtHSCw2QkFBbEcsQ0FBeURHLGVBQXpEO0FBQUEsSUFBMEVDLG1CQUExRSxHQUFrR0osNkJBQWxHLENBQTBFSSxtQkFBMUU7QUFFQSxJQUFNQyxVQUFVLEdBQUc7RUFDakIsK0JBQStCO0lBQzdCQyxPQUFPLEVBQUUs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