"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _botframeworkWebchatApi = require("botframework-webchat-api");

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _simpleUpdateIn = _interopRequireDefault(require("simple-update-in"));

var _createCustomEvent = _interopRequireDefault(require("./createCustomEvent"));

var _randomId = _interopRequireDefault(require("./randomId"));

var _useInternalMarkdownIt = _interopRequireDefault(require("../hooks/internal/useInternalMarkdownIt"));

var _useStyleToEmotionObject = _interopRequireDefault(require("../hooks/internal/useStyleToEmotionObject"));

var _walkMarkdownTokens = _interopRequireDefault(require("./walkMarkdownTokens"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var useStyleOptions = _botframeworkWebchatApi.hooks.useStyleOptions;

function replaceAnchorWithButton(markdownTokens) {
  return (0, _walkMarkdownTokens.default)(markdownTokens, function (markdownToken) {
    markdownToken = _objectSpread({}, markdownToken);

    switch (markdownToken.type) {
      case 'link_open':
        markdownToken.tag = 'button';
        markdownToken.attrs = [].concat(_toConsumableArray((0, _simpleUpdateIn.default)(markdownToken.attrs, [function (_ref) {
          var _ref2 = _slicedToArray(_ref, 2),
              name = _ref2[0],
              value = _ref2[1];

          return name === 'href' && value.startsWith('#');
        }], function (_ref3) {
          var _ref4 = _slicedToArray(_ref3, 2),
              value = _ref4[1];

          return ['data-markdown-href', value.substr(1)];
        })), [['type', 'button']]);
        break;

      case 'link_close':
        markdownToken.tag = 'button';
        break;

      default:
        break;
    }

    return markdownToken;
  });
}

var InlineMarkdown = function InlineMarkdown(_ref5) {
  var children = _ref5.children,
      onReference = _ref5.onReference,
      references = _ref5.references;

  if (typeof children !== 'string') {
    console.warn('botframework-webchat: "children" prop passed to <InlineMarkdown> must be of type string.');
    children = '';
  }

  var _useInternalMarkdownI = (0, _useInternalMarkdownIt.default)(),
      _useInternalMarkdownI2 = _slicedToArray(_useInternalMarkdownI, 1),
      markdownIt = _useInternalMarkdownI2[0];

  var _useStyleOptions = useStyleOptions(),
      _useStyleOptions2 = _slicedToArray(_useStyleOptions, 1),
      accent = _useStyleOptions2[0].accent;

  var styleToClassName = (0, _useStyleToEmotionObject.default)(); // We inlined the style here because this style is:
  // 1. Internal to Web Chat
  // 2. Not customizable from developers (other than setting `styleOptions.accent`)

  var className = (0, _react.useMemo)(function () {
    return styleToClassName({
      '& button[data-markdown-href]': {
        appearance: 'none',
        backgroundColor: 'transparent',
        border: 0,
        color: accent,
        cursor: 'pointer',
        fontFamily: 'inherit',
        fontSize: 'inherit',
        padding: 0
      },
      '@media screen and (forced-colors: active)': {
        '& button[data-markdown-href]': {
          color: 'LinkText',
          textDecoration: 'underline'
        }
      }
    }) + '';
  }, [accent, styleToClassName]); // Markdown-It only support references in uppercase.

  references = references.map(function (reference) {
    return reference.toUpperCase();
  });

  var _references$reduce = references.reduce(function (_ref6, ref) {
    var hrefToRef = _ref6.hrefToRef,
        refToHref = _ref6.refToHref;
    var href = (0, _randomId.default)();
    return {
      hrefToRef: _objectSpread(_objectSpread({}, hrefToRef), {}, _defineProperty({}, href, ref)),
      refToHref: _objectSpread(_objectSpread({}, refToHref), {}, _defineProperty({}, ref, href))
    };
  }, {
    hrefToRef: {},
    refToHref: {}
  }),
      hrefToRef = _references$reduce.hrefToRef,
      refToHref = _references$reduce.refToHref;

  var html = (0, _react.useMemo)(function () {
    var tree = markdownIt.parseInline(children, {
      references: references.reduce(function (references, key) {
        return (// Mitigated through denylisting.
          // eslint-disable-next-line security/detect-object-injection
          (0, _botframeworkWebchatCore.isForbiddenPropertyName)(key) ? references : _objectSpread(_objectSpread({}, references), {}, _defineProperty({}, key, {
            href: "#".concat(refToHref[key])
          }))
        );
      }, {})
    }); // Turn "<a href="#retry">Retry</a>" into "<button data-ref="retry" type="button">Retry</button>"

    var updatedTree = replaceAnchorWithButton(tree);
    return {
      __html: markdownIt.renderer.render(updatedTree)
    };
  }, [children, refToHref, markdownIt, references]);
  var handleClick = (0, _react.useCallback)(function (event) {
    event.stopPropagation();
    var href = event.target.getAttribute('data-markdown-href');
    href && onReference && onReference((0, _createCustomEvent.default)('reference', // Mitigated through denylisting.
    // eslint-disable-next-line security/detect-object-injection
    (0, _botframeworkWebchatCore.isForbiddenPropertyName)(href) ? {} : {
      data: hrefToRef[href]
    }));
  }, [hrefToRef, onReference]);
  return /*#__PURE__*/_react.default.createElement("span", {
    className: className,
    dangerouslySetInnerHTML: html,
    onClick: handleClick
  });
};

InlineMarkdown.defaultProps = {
  children: '',
  onReference: undefined,
  references: []
};
InlineMarkdown.propTypes = {
  children: _propTypes.default.string,
  onReference: _propTypes.default.func,
  references: _propTypes.default.arrayOf(_propTypes.default.string)
};
var _default = InlineMarkdown;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ1c2VTdHlsZU9wdGlvbnMiLCJob29rcyIsInJlcGxhY2VBbmNob3JXaXRoQnV0dG9uIiwibWFya2Rvd25Ub2tlbnMiLCJ3YWxrTWFya2Rvd25Ub2tlbnMiLCJtYXJrZG93blRva2VuIiwidHlwZSIsInRhZyIsImF0dHJzIiwidXBkYXRlSW4iLCJuYW1lIiwidmFsdWUiLCJzdGFydHNXaXRoIiwic3Vic3RyIiwiSW5saW5lTWFya2Rvd24iLCJjaGlsZHJlbiIsIm9uUmVmZXJlbmNlIiwicmVmZXJlbmNlcyIsImNvbnNvbGUiLCJ3YXJuIiwidXNlSW50ZXJuYWxNYXJrZG93bkl0IiwibWFya2Rvd25JdCIsImFjY2VudCIsInN0eWxlVG9DbGFzc05hbWUiLCJ1c2VTdHlsZVRvRW1vdGlvbk9iamVjdCIsImNsYXNzTmFtZSIsInVzZU1lbW8iLCJhcHBlYXJhbmNlIiwiYmFja2dyb3VuZENvbG9yIiwiYm9yZGVyIiwiY29sb3IiLCJjdXJzb3IiLCJmb250RmFtaWx5IiwiZm9udFNpemUiLCJwYWRkaW5nIiwidGV4dERlY29yYXRpb24iLCJtYXAiLCJyZWZlcmVuY2UiLCJ0b1VwcGVyQ2FzZSIsInJlZHVjZSIsInJlZiIsImhyZWZUb1JlZiIsInJlZlRvSHJlZiIsImhyZWYiLCJyYW5kb21JZCIsImh0bWwiLCJ0cmVlIiwicGFyc2VJbmxpbmUiLCJrZXkiLCJpc0ZvcmJpZGRlblByb3BlcnR5TmFtZSIsInVwZGF0ZWRUcmVlIiwiX19odG1sIiwicmVuZGVyZXIiLCJyZW5kZXIiLCJoYW5kbGVDbGljayIsInVzZUNhbGxiYWNrIiwiZXZlbnQiLCJzdG9wUHJvcGFnYXRpb24iLCJ0YXJnZXQiLCJnZXRBdHRyaWJ1dGUiLCJjcmVhdGVDdXN0b21FdmVudCIsImRhdGEiLCJkZWZhdWx0UHJvcHMiLCJ1bmRlZmluZWQiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJzdHJpbmciLCJmdW5jIiwiYXJyYXlPZiJdLCJzb3VyY2VSb290IjoiY29tcG9uZW50Oi8vLyIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL1V0aWxzL0lubGluZU1hcmtkb3duLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludCByZWFjdC9uby1kYW5nZXI6IFwib2ZmXCIgKi9cblxuaW1wb3J0IHsgaG9va3MgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1hcGknO1xuaW1wb3J0IHsgaXNGb3JiaWRkZW5Qcm9wZXJ0eU5hbWUgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1jb3JlJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2ssIHVzZU1lbW8gfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgdXBkYXRlSW4gZnJvbSAnc2ltcGxlLXVwZGF0ZS1pbic7XG5cbmltcG9ydCBjcmVhdGVDdXN0b21FdmVudCBmcm9tICcuL2NyZWF0ZUN1c3RvbUV2ZW50JztcbmltcG9ydCByYW5kb21JZCBmcm9tICcuL3JhbmRvbUlkJztcbmltcG9ydCB1c2VJbnRlcm5hbE1hcmtkb3duSXQgZnJvbSAnLi4vaG9va3MvaW50ZXJuYWwvdXNlSW50ZXJuYWxNYXJrZG93bkl0JztcbmltcG9ydCB1c2VTdHlsZVRvRW1vdGlvbk9iamVjdCBmcm9tICcuLi9ob29rcy9pbnRlcm5hbC91c2VTdHlsZVRvRW1vdGlvbk9iamVjdCc7XG5pbXBvcnQgd2Fsa01hcmtkb3duVG9rZW5zIGZyb20gJy4vd2Fsa01hcmtkb3duVG9rZW5zJztcblxuY29uc3QgeyB1c2VTdHlsZU9wdGlvbnMgfSA9IGhvb2tzO1xuXG5mdW5jdGlvbiByZXBsYWNlQW5jaG9yV2l0aEJ1dHRvbihtYXJrZG93blRva2Vucykge1xuICByZXR1cm4gd2Fsa01hcmtkb3duVG9rZW5zKG1hcmtkb3duVG9rZW5zLCBtYXJrZG93blRva2VuID0+IHtcbiAgICBtYXJrZG93blRva2VuID0geyAuLi5tYXJrZG93blRva2VuIH07XG5cbiAgICBzd2l0Y2ggKG1hcmtkb3duVG9rZW4udHlwZSkge1xuICAgICAgY2FzZSAnbGlua19vcGVuJzpcbiAgICAgICAgbWFya2Rvd25Ub2tlbi50YWcgPSAnYnV0dG9uJztcbiAgICAgICAgbWFya2Rvd25Ub2tlbi5hdHRycyA9IFtcbiAgICAgICAgICAuLi51cGRhdGVJbihcbiAgICAgICAgICAgIG1hcmtkb3duVG9rZW4uYXR0cnMsXG4gICAgICAgICAgICBbKFtuYW1lLCB2YWx1ZV0pID0+IG5hbWUgPT09ICdocmVmJyAmJiB2YWx1ZS5zdGFydHNXaXRoKCcjJyldLFxuICAgICAgICAgICAgKFssIHZhbHVlXSkgPT4gWydkYXRhLW1hcmtkb3duLWhyZWYnLCB2YWx1ZS5zdWJzdHIoMSldXG4gICAgICAgICAgKSxcbiAgICAgICAgICBbJ3R5cGUnLCAnYnV0dG9uJ11cbiAgICAgICAgXTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ2xpbmtfY2xvc2UnOlxuICAgICAgICBtYXJrZG93blRva2VuLnRhZyA9ICdidXR0b24nO1xuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1hcmtkb3duVG9rZW47XG4gIH0pO1xufVxuXG5jb25zdCBJbmxpbmVNYXJrZG93biA9ICh7IGNoaWxkcmVuLCBvblJlZmVyZW5jZSwgcmVmZXJlbmNlcyB9KSA9PiB7XG4gIGlmICh0eXBlb2YgY2hpbGRyZW4gIT09ICdzdHJpbmcnKSB7XG4gICAgY29uc29sZS53YXJuKCdib3RmcmFtZXdvcmstd2ViY2hhdDogXCJjaGlsZHJlblwiIHByb3AgcGFzc2VkIHRvIDxJbmxpbmVNYXJrZG93bj4gbXVzdCBiZSBvZiB0eXBlIHN0cmluZy4nKTtcbiAgICBjaGlsZHJlbiA9ICcnO1xuICB9XG5cbiAgY29uc3QgW21hcmtkb3duSXRdID0gdXNlSW50ZXJuYWxNYXJrZG93bkl0KCk7XG4gIGNvbnN0IFt7IGFjY2VudCB9XSA9IHVzZVN0eWxlT3B0aW9ucygpO1xuICBjb25zdCBzdHlsZVRvQ2xhc3NOYW1lID0gdXNlU3R5bGVUb0Vtb3Rpb25PYmplY3QoKTtcblxuICAvLyBXZSBpbmxpbmVkIHRoZSBzdHlsZSBoZXJlIGJlY2F1c2UgdGhpcyBzdHlsZSBpczpcbiAgLy8gMS4gSW50ZXJuYWwgdG8gV2ViIENoYXRcbiAgLy8gMi4gTm90IGN1c3RvbWl6YWJsZSBmcm9tIGRldmVsb3BlcnMgKG90aGVyIHRoYW4gc2V0dGluZyBgc3R5bGVPcHRpb25zLmFjY2VudGApXG4gIGNvbnN0IGNsYXNzTmFtZSA9IHVzZU1lbW8oXG4gICAgKCkgPT5cbiAgICAgIHN0eWxlVG9DbGFzc05hbWUoe1xuICAgICAgICAnJiBidXR0b25bZGF0YS1tYXJrZG93bi1ocmVmXSc6IHtcbiAgICAgICAgICBhcHBlYXJhbmNlOiAnbm9uZScsXG4gICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICAgIGJvcmRlcjogMCxcbiAgICAgICAgICBjb2xvcjogYWNjZW50LFxuICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLFxuICAgICAgICAgIGZvbnRGYW1pbHk6ICdpbmhlcml0JyxcbiAgICAgICAgICBmb250U2l6ZTogJ2luaGVyaXQnLFxuICAgICAgICAgIHBhZGRpbmc6IDBcbiAgICAgICAgfSxcbiAgICAgICAgJ0BtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpJzoge1xuICAgICAgICAgICcmIGJ1dHRvbltkYXRhLW1hcmtkb3duLWhyZWZdJzoge1xuICAgICAgICAgICAgY29sb3I6ICdMaW5rVGV4dCcsXG4gICAgICAgICAgICB0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZSdcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pICsgJycsXG4gICAgW2FjY2VudCwgc3R5bGVUb0NsYXNzTmFtZV1cbiAgKTtcblxuICAvLyBNYXJrZG93bi1JdCBvbmx5IHN1cHBvcnQgcmVmZXJlbmNlcyBpbiB1cHBlcmNhc2UuXG4gIHJlZmVyZW5jZXMgPSByZWZlcmVuY2VzLm1hcChyZWZlcmVuY2UgPT4gcmVmZXJlbmNlLnRvVXBwZXJDYXNlKCkpO1xuXG4gIGNvbnN0IHsgaHJlZlRvUmVmLCByZWZUb0hyZWYgfSA9IHJlZmVyZW5jZXMucmVkdWNlKFxuICAgICh7IGhyZWZUb1JlZiwgcmVmVG9IcmVmIH0sIHJlZikgPT4ge1xuICAgICAgY29uc3QgaHJlZiA9IHJhbmRvbUlkKCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGhyZWZUb1JlZjogeyAuLi5ocmVmVG9SZWYsIFtocmVmXTogcmVmIH0sXG4gICAgICAgIHJlZlRvSHJlZjogeyAuLi5yZWZUb0hyZWYsIFtyZWZdOiBocmVmIH1cbiAgICAgIH07XG4gICAgfSxcbiAgICB7IGhyZWZUb1JlZjoge30sIHJlZlRvSHJlZjoge30gfVxuICApO1xuXG4gIGNvbnN0IGh0bWwgPSB1c2VNZW1vKCgpID0+IHtcbiAgICBjb25zdCB0cmVlID0gbWFya2Rvd25JdC5wYXJzZUlubGluZShjaGlsZHJlbiwge1xuICAgICAgcmVmZXJlbmNlczogcmVmZXJlbmNlcy5yZWR1Y2UoXG4gICAgICAgIChyZWZlcmVuY2VzLCBrZXkpID0+XG4gICAgICAgICAgLy8gTWl0aWdhdGVkIHRocm91Z2ggZGVueWxpc3RpbmcuXG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHNlY3VyaXR5L2RldGVjdC1vYmplY3QtaW5qZWN0aW9uXG4gICAgICAgICAgaXNGb3JiaWRkZW5Qcm9wZXJ0eU5hbWUoa2V5KSA/IHJlZmVyZW5jZXMgOiB7IC4uLnJlZmVyZW5jZXMsIFtrZXldOiB7IGhyZWY6IGAjJHtyZWZUb0hyZWZba2V5XX1gIH0gfSxcbiAgICAgICAge31cbiAgICAgIClcbiAgICB9KTtcblxuICAgIC8vIFR1cm4gXCI8YSBocmVmPVwiI3JldHJ5XCI+UmV0cnk8L2E+XCIgaW50byBcIjxidXR0b24gZGF0YS1yZWY9XCJyZXRyeVwiIHR5cGU9XCJidXR0b25cIj5SZXRyeTwvYnV0dG9uPlwiXG4gICAgY29uc3QgdXBkYXRlZFRyZWUgPSByZXBsYWNlQW5jaG9yV2l0aEJ1dHRvbih0cmVlKTtcblxuICAgIHJldHVybiB7IF9faHRtbDogbWFya2Rvd25JdC5yZW5kZXJlci5yZW5kZXIodXBkYXRlZFRyZWUpIH07XG4gIH0sIFtjaGlsZHJlbiwgcmVmVG9IcmVmLCBtYXJrZG93bkl0LCByZWZlcmVuY2VzXSk7XG5cbiAgY29uc3QgaGFuZGxlQ2xpY2sgPSB1c2VDYWxsYmFjayhcbiAgICBldmVudCA9PiB7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgY29uc3QgaHJlZiA9IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWFya2Rvd24taHJlZicpO1xuXG4gICAgICBocmVmICYmXG4gICAgICAgIG9uUmVmZXJlbmNlICYmXG4gICAgICAgIG9uUmVmZXJlbmNlKFxuICAgICAgICAgIGNyZWF0ZUN1c3RvbUV2ZW50KFxuICAgICAgICAgICAgJ3JlZmVyZW5jZScsXG4gICAgICAgICAgICAvLyBNaXRpZ2F0ZWQgdGhyb3VnaCBkZW55bGlzdGluZy5cbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBzZWN1cml0eS9kZXRlY3Qtb2JqZWN0LWluamVjdGlvblxuICAgICAgICAgICAgaXNGb3JiaWRkZW5Qcm9wZXJ0eU5hbWUoaHJlZikgPyB7fSA6IHsgZGF0YTogaHJlZlRvUmVmW2hyZWZdIH1cbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfSxcbiAgICBbaHJlZlRvUmVmLCBvblJlZmVyZW5jZV1cbiAgKTtcblxuICByZXR1cm4gPHNwYW4gY2xhc3NOYW1lPXtjbGFzc05hbWV9IGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MPXtodG1sfSBvbkNsaWNrPXtoYW5kbGVDbGlja30gLz47XG59O1xuXG5JbmxpbmVNYXJrZG93bi5kZWZhdWx0UHJvcHMgPSB7XG4gIGNoaWxkcmVuOiAnJyxcbiAgb25SZWZlcmVuY2U6IHVuZGVmaW5lZCxcbiAgcmVmZXJlbmNlczogW11cbn07XG5cbklubGluZU1hcmtkb3duLnByb3BUeXBlcyA9IHtcbiAgY2hpbGRyZW46IFByb3BUeXBlcy5zdHJpbmcsXG4gIG9uUmVmZXJlbmNlOiBQcm9wVHlwZXMuZnVuYyxcbiAgcmVmZXJlbmNlczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnN0cmluZylcbn07XG5cbmV4cG9ydCBkZWZhdWx0IElubGluZU1hcmtkb3duO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQVFBLGVBQVIsR0FBNEJDLDZCQUE1QixDQUFRRCxlQUFSOztBQUVBLFNBQVNFLHVCQUFULENBQWlDQyxjQUFqQyxFQUFpRDtFQUMvQyxPQUFPLElBQUFDLDJCQUFBLEVBQW1CRCxjQUFuQixFQUFtQyxVQUFBRSxhQUFhLEVBQUk7SUFDekRBLGFBQWEscUJBQVFBLGFBQVIsQ0FBYjs7SUFFQSxRQUFRQSxhQUFhLENBQUNDLElBQXRCO01BQ0UsS0FBSyxXQUFMO1FBQ0VELGFBQWEsQ0FBQ0UsR0FBZCxHQUFvQixRQUFwQjtRQUNBRixhQUFhLENBQUNHLEtBQWQsZ0NBQ0ssSUFBQUMsdUJBQUEsRUFDREosYUFBYSxDQUFDRyxLQURiLEVBRUQsQ0FBQztVQUFBO1VBQUEsSUFBRUUsSUFBRjtVQUFBLElBQVFDLEtBQVI7O1VBQUEsT0FBbUJELElBQUksS0FBSyxNQUFULElBQW1CQyxLQUFLLENBQUNDLFVBQU4sQ0FBaUIsR0FBakIsQ0FBdEM7UUFBQSxDQUFELENBRkMsRUFHRDtVQUFBO1VBQUEsSUFBSUQsS0FBSjs7VUFBQSxPQUFlLENBQUMsb0JBQUQsRUFBdUJBLEtBQUssQ0FBQ0UsTUFBTixDQUFhLENBQWIsQ0FBdkIsQ0FBZjtRQUFBLENBSEMsQ0FETCxJQU1FLENBQUMsTUFBRCxFQUFTLFFBQVQsQ0FORjtRQVFBOztNQUVGLEtBQUssWUFB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