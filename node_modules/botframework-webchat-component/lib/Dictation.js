"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _reactDictateButton = require("react-dictate-button");

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _botframeworkWebchatApi = require("botframework-webchat-api");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _useResumeAudioContext = _interopRequireDefault(require("./hooks/internal/useResumeAudioContext"));

var _useSettableDictateAbortable = _interopRequireDefault(require("./hooks/internal/useSettableDictateAbortable"));

var _useWebSpeechPonyfill4 = _interopRequireDefault(require("./hooks/useWebSpeechPonyfill"));

var _useSetDictateState = _interopRequireDefault(require("botframework-webchat-api/lib/hooks/internal/useSetDictateState"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var useActivities = _botframeworkWebchatApi.hooks.useActivities,
    useDictateInterims = _botframeworkWebchatApi.hooks.useDictateInterims,
    useDictateState = _botframeworkWebchatApi.hooks.useDictateState,
    useDisabled = _botframeworkWebchatApi.hooks.useDisabled,
    useEmitTypingIndicator = _botframeworkWebchatApi.hooks.useEmitTypingIndicator,
    useLanguage = _botframeworkWebchatApi.hooks.useLanguage,
    useSendBoxValue = _botframeworkWebchatApi.hooks.useSendBoxValue,
    useSendTypingIndicator = _botframeworkWebchatApi.hooks.useSendTypingIndicator,
    useShouldSpeakIncomingActivity = _botframeworkWebchatApi.hooks.useShouldSpeakIncomingActivity,
    useStopDictate = _botframeworkWebchatApi.hooks.useStopDictate,
    useSubmitSendBox = _botframeworkWebchatApi.hooks.useSubmitSendBox;
var _Constants$DictateSta = _botframeworkWebchatCore.Constants.DictateState,
    DICTATING = _Constants$DictateSta.DICTATING,
    IDLE = _Constants$DictateSta.IDLE,
    STARTING = _Constants$DictateSta.STARTING;

var Dictation = function Dictation(_ref) {
  var onError = _ref.onError;

  var _useSettableDictateAb = (0, _useSettableDictateAbortable.default)(),
      _useSettableDictateAb2 = _slicedToArray(_useSettableDictateAb, 2),
      setDictateAbortable = _useSettableDictateAb2[1];

  var _useDictateInterims = useDictateInterims(),
      _useDictateInterims2 = _slicedToArray(_useDictateInterims, 2),
      setDictateInterims = _useDictateInterims2[1];

  var _useSendBoxValue = useSendBoxValue(),
      _useSendBoxValue2 = _slicedToArray(_useSendBoxValue, 2),
      setSendBox = _useSendBoxValue2[1];

  var _useShouldSpeakIncomi = useShouldSpeakIncomingActivity(),
      _useShouldSpeakIncomi2 = _slicedToArray(_useShouldSpeakIncomi, 2),
      setShouldSpeakIncomingActivity = _useShouldSpeakIncomi2[1];

  var _useWebSpeechPonyfill = (0, _useWebSpeechPonyfill4.default)(),
      _useWebSpeechPonyfill2 = _slicedToArray(_useWebSpeechPonyfill, 1),
      _useWebSpeechPonyfill3 = _useWebSpeechPonyfill2[0];

  _useWebSpeechPonyfill3 = _useWebSpeechPonyfill3 === void 0 ? {} : _useWebSpeechPonyfill3;
  var SpeechGrammarList = _useWebSpeechPonyfill3.SpeechGrammarList,
      SpeechRecognition = _useWebSpeechPonyfill3.SpeechRecognition;

  var _useActivities = useActivities(),
      _useActivities2 = _slicedToArray(_useActivities, 1),
      activities = _useActivities2[0];

  var _useDictateState = useDictateState(),
      _useDictateState2 = _slicedToArray(_useDictateState, 1),
      dictateState = _useDictateState2[0];

  var _useDisabled = useDisabled(),
      _useDisabled2 = _slicedToArray(_useDisabled, 1),
      disabled = _useDisabled2[0];

  var _useSendTypingIndicat = useSendTypingIndicator(),
      _useSendTypingIndicat2 = _slicedToArray(_useSendTypingIndicat, 1),
      sendTypingIndicator = _useSendTypingIndicat2[0];

  var _useLanguage = useLanguage('speech'),
      _useLanguage2 = _slicedToArray(_useLanguage, 1),
      speechLanguage = _useLanguage2[0];

  var emitTypingIndicator = useEmitTypingIndicator();
  var resumeAudioContext = (0, _useResumeAudioContext.default)();
  var setDictateState = (0, _useSetDictateState.default)();
  var stopDictate = useStopDictate();
  var submitSendBox = useSubmitSendBox();
  var numSpeakingActivities = (0, _react.useMemo)(function () {
    return activities.filter(function (_ref2) {
      var _ref2$channelData = _ref2.channelData;
      _ref2$channelData = _ref2$channelData === void 0 ? {} : _ref2$channelData;
      var speak = _ref2$channelData.speak;
      return speak;
    }).length;
  }, [activities]);
  var handleDictate = (0, _react.useCallback)(function (_ref3) {
    var _ref3$result = _ref3.result;
    _ref3$result = _ref3$result === void 0 ? {} : _ref3$result;
    var confidence = _ref3$result.confidence,
        transcript = _ref3$result.transcript;

    if (dictateState === DICTATING || dictateState === STARTING) {
      setDictateInterims([]);
      setDictateState(IDLE);
      stopDictate();

      if (transcript) {
        setSendBox(transcript);
        submitSendBox('speech', {
          channelData: {
            speech: {
              alternatives: [{
                confidence: confidence,
                transcript: transcript
              }]
            }
          }
        });
        setShouldSpeakIncomingActivity(true);
      }
    }
  }, [dictateState, setDictateInterims, setDictateState, stopDictate, setSendBox, submitSendBox, setShouldSpeakIncomingActivity]);
  var handleDictating = (0, _react.useCallback)(function (_ref4) {
    var abortable = _ref4.abortable,
        _ref4$results = _ref4.results,
        results = _ref4$results === void 0 ? [] : _ref4$results;

    if (dictateState === DICTATING || dictateState === STARTING) {
      var interims = results.map(function (_ref5) {
        var transcript = _ref5.transcript;
        return transcript;
      });
      setDictateAbortable(abortable);
      setDictateInterims(interims);
      setDictateState(DICTATING);
      sendTypingIndicator && emitTypingIndicator();
    }
  }, [dictateState, emitTypingIndicator, sendTypingIndicator, setDictateAbortable, setDictateInterims, setDictateState]);
  var handleError = (0, _react.useCallback)(function (event) {
    dictateState !== IDLE && setDictateState(IDLE);
    (dictateState === DICTATING || dictateState === STARTING) && stopDictate();
    onError && onError(event);
  }, [dictateState, onError, setDictateState, stopDictate]);
  (0, _react.useEffect)(function () {
    window.addEventListener('pointerdown', resumeAudioContext);
    return function () {
      return window.removeEventListener('pointerdown', resumeAudioContext);
    };
  }, [resumeAudioContext]);
  return /*#__PURE__*/_react.default.createElement(_reactDictateButton.Composer, {
    lang: speechLanguage,
    onDictate: handleDictate,
    onError: handleError,
    onProgress: handleDictating,
    speechGrammarList: SpeechGrammarList,
    speechRecognition: SpeechRecognition,
    started: !disabled && (dictateState === STARTING || dictateState === DICTATING) && !numSpeakingActivities
  });
};

Dictation.defaultProps = {
  onError: undefined
};
Dictation.propTypes = {
  onError: _propTypes.default.func
};
var _default = Dictation;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ1c2VBY3Rpdml0aWVzIiwiaG9va3MiLCJ1c2VEaWN0YXRlSW50ZXJpbXMiLCJ1c2VEaWN0YXRlU3RhdGUiLCJ1c2VEaXNhYmxlZCIsInVzZUVtaXRUeXBpbmdJbmRpY2F0b3IiLCJ1c2VMYW5ndWFnZSIsInVzZVNlbmRCb3hWYWx1ZSIsInVzZVNlbmRUeXBpbmdJbmRpY2F0b3IiLCJ1c2VTaG91bGRTcGVha0luY29taW5nQWN0aXZpdHkiLCJ1c2VTdG9wRGljdGF0ZSIsInVzZVN1Ym1pdFNlbmRCb3giLCJDb25zdGFudHMiLCJEaWN0YXRlU3RhdGUiLCJESUNUQVRJTkciLCJJRExFIiwiU1RBUlRJTkciLCJEaWN0YXRpb24iLCJvbkVycm9yIiwidXNlU2V0dGFibGVEaWN0YXRlQWJvcnRhYmxlIiwic2V0RGljdGF0ZUFib3J0YWJsZSIsInNldERpY3RhdGVJbnRlcmltcyIsInNldFNlbmRCb3giLCJzZXRTaG91bGRTcGVha0luY29taW5nQWN0aXZpdHkiLCJ1c2VXZWJTcGVlY2hQb255ZmlsbCIsIlNwZWVjaEdyYW1tYXJMaXN0IiwiU3BlZWNoUmVjb2duaXRpb24iLCJhY3Rpdml0aWVzIiwiZGljdGF0ZVN0YXRlIiwiZGlzYWJsZWQiLCJzZW5kVHlwaW5nSW5kaWNhdG9yIiwic3BlZWNoTGFuZ3VhZ2UiLCJlbWl0VHlwaW5nSW5kaWNhdG9yIiwicmVzdW1lQXVkaW9Db250ZXh0IiwidXNlUmVzdW1lQXVkaW9Db250ZXh0Iiwic2V0RGljdGF0ZVN0YXRlIiwidXNlU2V0RGljdGF0ZVN0YXRlIiwic3RvcERpY3RhdGUiLCJzdWJtaXRTZW5kQm94IiwibnVtU3BlYWtpbmdBY3Rpdml0aWVzIiwidXNlTWVtbyIsImZpbHRlciIsImNoYW5uZWxEYXRhIiwic3BlYWsiLCJsZW5ndGgiLCJoYW5kbGVEaWN0YXRlIiwidXNlQ2FsbGJhY2siLCJyZXN1bHQiLCJjb25maWRlbmNlIiwidHJhbnNjcmlwdCIsInNwZWVjaCIsImFsdGVybmF0aXZlcyIsImhhbmRsZURpY3RhdGluZyIsImFib3J0YWJsZSIsInJlc3VsdHMiLCJpbnRlcmltcyIsIm1hcCIsImhhbmRsZUVycm9yIiwiZXZlbnQiLCJ1c2VFZmZlY3QiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImRlZmF1bHRQcm9wcyIsInVuZGVmaW5lZCIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsImZ1bmMiXSwic291cmNlUm9vdCI6ImNvbXBvbmVudDovLy8iLCJzb3VyY2VzIjpbIi4uL3NyYy9EaWN0YXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9zZXIgYXMgRGljdGF0ZUNvbXBvc2VyIH0gZnJvbSAncmVhY3QtZGljdGF0ZS1idXR0b24nO1xuaW1wb3J0IHsgQ29uc3RhbnRzIH0gZnJvbSAnYm90ZnJhbWV3b3JrLXdlYmNoYXQtY29yZSc7XG5pbXBvcnQgeyBob29rcyB9IGZyb20gJ2JvdGZyYW1ld29yay13ZWJjaGF0LWFwaSc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IFJlYWN0LCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZU1lbW8gfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCB1c2VSZXN1bWVBdWRpb0NvbnRleHQgZnJvbSAnLi9ob29rcy9pbnRlcm5hbC91c2VSZXN1bWVBdWRpb0NvbnRleHQnO1xuaW1wb3J0IHVzZVNldHRhYmxlRGljdGF0ZUFib3J0YWJsZSBmcm9tICcuL2hvb2tzL2ludGVybmFsL3VzZVNldHRhYmxlRGljdGF0ZUFib3J0YWJsZSc7XG5pbXBvcnQgdXNlV2ViU3BlZWNoUG9ueWZpbGwgZnJvbSAnLi9ob29rcy91c2VXZWJTcGVlY2hQb255ZmlsbCc7XG5cbi8vIFRPRE86IFtQMV0gIzMzNTAgTm8gL2xpYi8sIHdlIG5lZWQgdG8gbW92ZSBzZXREaWN0YXRlU3RhdGUgZnJvbSBiZi13Yy1jb3JlIChSZWR1eCkgdG8gUmVhY3QgQ29udGV4dC5cbmltcG9ydCB1c2VTZXREaWN0YXRlU3RhdGUgZnJvbSAnYm90ZnJhbWV3b3JrLXdlYmNoYXQtYXBpL2xpYi9ob29rcy9pbnRlcm5hbC91c2VTZXREaWN0YXRlU3RhdGUnO1xuXG5jb25zdCB7XG4gIHVzZUFjdGl2aXRpZXMsXG4gIHVzZURpY3RhdGVJbnRlcmltcyxcbiAgdXNlRGljdGF0ZVN0YXRlLFxuICB1c2VEaXNhYmxlZCxcbiAgdXNlRW1pdFR5cGluZ0luZGljYXRvcixcbiAgdXNlTGFuZ3VhZ2UsXG4gIHVzZVNlbmRCb3hWYWx1ZSxcbiAgdXNlU2VuZFR5cGluZ0luZGljYXRvcixcbiAgdXNlU2hvdWxkU3BlYWtJbmNvbWluZ0FjdGl2aXR5LFxuICB1c2VTdG9wRGljdGF0ZSxcbiAgdXNlU3VibWl0U2VuZEJveFxufSA9IGhvb2tzO1xuXG5jb25zdCB7XG4gIERpY3RhdGVTdGF0ZTogeyBESUNUQVRJTkcsIElETEUsIFNUQVJUSU5HIH1cbn0gPSBDb25zdGFudHM7XG5cbmNvbnN0IERpY3RhdGlvbiA9ICh7IG9uRXJyb3IgfSkgPT4ge1xuICBjb25zdCBbLCBzZXREaWN0YXRlQWJvcnRhYmxlXSA9IHVzZVNldHRhYmxlRGljdGF0ZUFib3J0YWJsZSgpO1xuICBjb25zdCBbLCBzZXREaWN0YXRlSW50ZXJpbXNdID0gdXNlRGljdGF0ZUludGVyaW1zKCk7XG4gIGNvbnN0IFssIHNldFNlbmRCb3hdID0gdXNlU2VuZEJveFZhbHVlKCk7XG4gIGNvbnN0IFssIHNldFNob3VsZFNwZWFrSW5jb21pbmdBY3Rpdml0eV0gPSB1c2VTaG91bGRTcGVha0luY29taW5nQWN0aXZpdHkoKTtcbiAgY29uc3QgW3sgU3BlZWNoR3JhbW1hckxpc3QsIFNwZWVjaFJlY29nbml0aW9uIH0gPSB7fV0gPSB1c2VXZWJTcGVlY2hQb255ZmlsbCgpO1xuICBjb25zdCBbYWN0aXZpdGllc10gPSB1c2VBY3Rpdml0aWVzKCk7XG4gIGNvbnN0IFtkaWN0YXRlU3RhdGVdID0gdXNlRGljdGF0ZVN0YXRlKCk7XG4gIGNvbnN0IFtkaXNhYmxlZF0gPSB1c2VEaXNhYmxlZCgpO1xuICBjb25zdCBbc2VuZFR5cGluZ0luZGljYXRvcl0gPSB1c2VTZW5kVHlwaW5nSW5kaWNhdG9yKCk7XG4gIGNvbnN0IFtzcGVlY2hMYW5ndWFnZV0gPSB1c2VMYW5ndWFnZSgnc3BlZWNoJyk7XG4gIGNvbnN0IGVtaXRUeXBpbmdJbmRpY2F0b3IgPSB1c2VFbWl0VHlwaW5nSW5kaWNhdG9yKCk7XG4gIGNvbnN0IHJlc3VtZUF1ZGlvQ29udGV4dCA9IHVzZVJlc3VtZUF1ZGlvQ29udGV4dCgpO1xuICBjb25zdCBzZXREaWN0YXRlU3RhdGUgPSB1c2VTZXREaWN0YXRlU3RhdGUoKTtcbiAgY29uc3Qgc3RvcERpY3RhdGUgPSB1c2VTdG9wRGljdGF0ZSgpO1xuICBjb25zdCBzdWJtaXRTZW5kQm94ID0gdXNlU3VibWl0U2VuZEJveCgpO1xuXG4gIGNvbnN0IG51bVNwZWFraW5nQWN0aXZpdGllcyA9IHVzZU1lbW8oXG4gICAgKCkgPT4gYWN0aXZpdGllcy5maWx0ZXIoKHsgY2hhbm5lbERhdGE6IHsgc3BlYWsgfSA9IHt9IH0pID0+IHNwZWFrKS5sZW5ndGgsXG4gICAgW2FjdGl2aXRpZXNdXG4gICk7XG5cbiAgY29uc3QgaGFuZGxlRGljdGF0ZSA9IHVzZUNhbGxiYWNrKFxuICAgICh7IHJlc3VsdDogeyBjb25maWRlbmNlLCB0cmFuc2NyaXB0IH0gPSB7fSB9KSA9PiB7XG4gICAgICBpZiAoZGljdGF0ZVN0YXRlID09PSBESUNUQVRJTkcgfHwgZGljdGF0ZVN0YXRlID09PSBTVEFSVElORykge1xuICAgICAgICBzZXREaWN0YXRlSW50ZXJpbXMoW10pO1xuICAgICAgICBzZXREaWN0YXRlU3RhdGUoSURMRSk7XG4gICAgICAgIHN0b3BEaWN0YXRlKCk7XG5cbiAgICAgICAgaWYgKHRyYW5zY3JpcHQpIHtcbiAgICAgICAgICBzZXRTZW5kQm94KHRyYW5zY3JpcHQpO1xuICAgICAgICAgIHN1Ym1pdFNlbmRCb3goJ3NwZWVjaCcsIHsgY2hhbm5lbERhdGE6IHsgc3BlZWNoOiB7IGFsdGVybmF0aXZlczogW3sgY29uZmlkZW5jZSwgdHJhbnNjcmlwdCB9XSB9IH0gfSk7XG4gICAgICAgICAgc2V0U2hvdWxkU3BlYWtJbmNvbWluZ0FjdGl2aXR5KHRydWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBbXG4gICAgICBkaWN0YXRlU3RhdGUsXG4gICAgICBzZXREaWN0YXRlSW50ZXJpbXMsXG4gICAgICBzZXREaWN0YXRlU3RhdGUsXG4gICAgICBzdG9wRGljdGF0ZSxcbiAgICAgIHNldFNlbmRCb3gsXG4gICAgICBzdWJtaXRTZW5kQm94LFxuICAgICAgc2V0U2hvdWxkU3BlYWtJbmNvbWluZ0FjdGl2aXR5XG4gICAgXVxuICApO1xuXG4gIGNvbnN0IGhhbmRsZURpY3RhdGluZyA9IHVzZUNhbGxiYWNrKFxuICAgICh7IGFib3J0YWJsZSwgcmVzdWx0cyA9IFtdIH0pID0+IHtcbiAgICAgIGlmIChkaWN0YXRlU3RhdGUgPT09IERJQ1RBVElORyB8fCBkaWN0YXRlU3RhdGUgPT09IFNUQVJUSU5HKSB7XG4gICAgICAgIGNvbnN0IGludGVyaW1zID0gcmVzdWx0cy5tYXAoKHsgdHJhbnNjcmlwdCB9KSA9PiB0cmFuc2NyaXB0KTtcblxuICAgICAgICBzZXREaWN0YXRlQWJvcnRhYmxlKGFib3J0YWJsZSk7XG4gICAgICAgIHNldERpY3RhdGVJbnRlcmltcyhpbnRlcmltcyk7XG4gICAgICAgIHNldERpY3RhdGVTdGF0ZShESUNUQVRJTkcpO1xuICAgICAgICBzZW5kVHlwaW5nSW5kaWNhdG9yICYmIGVtaXRUeXBpbmdJbmRpY2F0b3IoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFtkaWN0YXRlU3RhdGUsIGVtaXRUeXBpbmdJbmRpY2F0b3IsIHNlbmRUeXBpbmdJbmRpY2F0b3IsIHNldERpY3RhdGVBYm9ydGFibGUsIHNldERpY3RhdGVJbnRlcmltcywgc2V0RGljdGF0ZVN0YXRlXVxuICApO1xuXG4gIGNvbnN0IGhhbmRsZUVycm9yID0gdXNlQ2FsbGJhY2soXG4gICAgZXZlbnQgPT4ge1xuICAgICAgZGljdGF0ZVN0YXRlICE9PSBJRExFICYmIHNldERpY3RhdGVTdGF0ZShJRExFKTtcbiAgICAgIChkaWN0YXRlU3RhdGUgPT09IERJQ1RBVElORyB8fCBkaWN0YXRlU3RhdGUgPT09IFNUQVJUSU5HKSAmJiBzdG9wRGljdGF0ZSgpO1xuXG4gICAgICBvbkVycm9yICYmIG9uRXJyb3IoZXZlbnQpO1xuICAgIH0sXG4gICAgW2RpY3RhdGVTdGF0ZSwgb25FcnJvciwgc2V0RGljdGF0ZVN0YXRlLCBzdG9wRGljdGF0ZV1cbiAgKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyZG93bicsIHJlc3VtZUF1ZGlvQ29udGV4dCk7XG5cbiAgICByZXR1cm4gKCkgPT4gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJkb3duJywgcmVzdW1lQXVkaW9Db250ZXh0KTtcbiAgfSwgW3Jlc3VtZUF1ZGlvQ29udGV4dF0pO1xuXG4gIHJldHVybiAoXG4gICAgPERpY3RhdGVDb21wb3NlclxuICAgICAgbGFuZz17c3BlZWNoTGFuZ3VhZ2V9XG4gICAgICBvbkRpY3RhdGU9e2hhbmRsZURpY3RhdGV9XG4gICAgICBvbkVycm9yPXtoYW5kbGVFcnJvcn1cbiAgICAgIG9uUHJvZ3Jlc3M9e2hhbmRsZURpY3RhdGluZ31cbiAgICAgIHNwZWVjaEdyYW1tYXJMaXN0PXtTcGVlY2hHcmFtbWFyTGlzdH1cbiAgICAgIHNwZWVjaFJlY29nbml0aW9uPXtTcGVlY2hSZWNvZ25pdGlvbn1cbiAgICAgIHN0YXJ0ZWQ9eyFkaXNhYmxlZCAmJiAoZGljdGF0ZVN0YXRlID09PSBTVEFSVElORyB8fCBkaWN0YXRlU3RhdGUgPT09IERJQ1RBVElORykgJiYgIW51bVNwZWFraW5nQWN0aXZpdGllc31cbiAgICAvPlxuICApO1xufTtcblxuRGljdGF0aW9uLmRlZmF1bHRQcm9wcyA9IHtcbiAgb25FcnJvcjogdW5kZWZpbmVkXG59O1xuXG5EaWN0YXRpb24ucHJvcFR5cGVzID0ge1xuICBvbkVycm9yOiBQcm9wVHlwZXMuZnVuY1xufTtcblxuZXhwb3J0IGRlZmF1bHQgRGljdGF0aW9uO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFHQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxJQUNFQSxhQURGLEdBWUlDLDZCQVpKLENBQ0VELGFBREY7QUFBQSxJQUVFRSxrQkFGRixHQVlJRCw2QkFaSixDQUVFQyxrQkFGRjtBQUFBLElBR0VDLGVBSEYsR0FZSUYsNkJBWkosQ0FHRUUsZUFIRjtBQUFBLElBSUVDLFdBSkYsR0FZSUgsNkJBWkosQ0FJRUcsV0FKRjtBQUFBLElBS0VDLHNCQUxGLEdBWUlKLDZCQVpKLENBS0VJLHNCQUxGO0FBQUEsSUFNRUMsV0FORixHQVlJTCw2QkFaSixDQU1FSyxXQU5GO0FBQUEsSUFPRUMsZUFQRixHQVlJTiw2QkFaSixDQU9FTSxlQVBGO0FBQUEsSUFRRUMsc0JBUkYsR0FZSVAsNkJBWkosQ0FRRU8sc0JBUkY7QUFBQSxJQVNFQyw4QkFURixHQVlJUiw2QkFaSixDQVNFUSw4QkFURjtBQUFBLElBVUVDLGNBVkYsR0FZSVQsNkJBWkosQ0FVRVMsY0FWRjtBQUFBLElBV0VDLGdCQVhGLEdBWUlWLDZCQVpKLENBV0VVLGdCQVhGO0FBY0EsNEJBRUlDLGtDQUZKLENBQ0VDLFlBREY7QUFBQSxJQUNrQkMsU0FEbEIseUJBQ2tCQSxTQURsQjtBQUFBLElBQzZCQyxJQUQ3Qix5QkFDNkJBLElBRDdCO0FBQUEsSUFDbUNDLFFBRG5DLHlCQUNtQ0EsUUFEbkM7O0FBSUEsSUFBTUMsU0FBUyxHQUFHLFNBQVpBLFNBQVksT0FBaUI7RUFBQSxJQUFkQyxPQUFjLFFBQWRBLE9BQWM7O0VBQ2pDLDRCQUFnQyxJQUFBQyxvQ0FBQSxHQUFoQztFQUFBO0VBQUEsSUFBU0MsbUJBQVQ7O0VBQ0EsMEJBQStCbEIsa0JBQWtCLEVBQWpE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